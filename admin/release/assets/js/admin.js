Ext.ns("App");App.config=App.config||{debug:false};App.API=Ext.extend(Ext.util.Observable,{$allEventReceived:false,constructor:function(){App.API.superclass.constructor.apply(this,arguments);this.Version={MAJOR:1,MINOR:0,MICRO:0};this.ResponseStatus={SUCCESS:0,INVALID:1,UNAUTHORIZED:2,ERROR:3,__names__:["SUCCESS","INVALID","UNAUTHORIZED","ERROR"]};this.NodeStatus={DISCONNECTED:0,LOGGED:1,WAITING:2,UPDATING:3,VALIDATING:4,TESTING:5,READY:6,EXECUTING:7,PAUSED:8,__names__:["DISCONNECTED","LOGGED","WAITING","UPDATING","VALIDATING","TESTING","READY","EXECUTING","PAUSED"]};this.NodePermission={remove:0,get:1,set:2,getSystemInfo:3,getRuntimeInfo:4,getLog:5,pause:6,resume:7,stop:8,wake:9,reboot:10,shutdown:11,execProcess:12,killProcess:13,cancelJobs:14,usePrimary:15,useSecondary:16,__names__:["remove","get","set","getSystemInfo","getRuntimeInfo","getLog","pause","resume","stop","wake","reboot","shutdown","execProcess","killProcess","cancelJobs","usePrimary","useSecondary"]};this.OsName={AIX:0,Darwin:1,FreeBSD:2,HPUX:3,Linux:4,NetBSD:5,OpenBSD:6,SunOS:7,Windows:8,__names__:["AIX","Darwin","FreeBSD","HPUX","Linux","NetBSD","OpenBSD","SunOS","Windows"]};this.ProcessState={SLEEP:0,RUN:1,STOP:2,ZOMBIE:3,IDLE:4,__names__:["SLEEP","RUN","STOP","ZOMBIE","IDLE"]};this.PoolPermission={remove:0,get:1,set:2,moveNodes:3,pauseNodes:4,resumeNodes:5,stopNodes:6,wakeNodes:7,rebootNodes:8,shutdownNodes:9,cancelJobs:10,usePrimary:11,useSecondary:12,__names__:["remove","get","set","moveNodes","pauseNodes","resumeNodes","stopNodes","wakeNodes","rebootNodes","shutdownNodes","cancelJobs","usePrimary","useSecondary"]};this.JobStatus={DISABLED:0,ENABLED:1,EXECUTED:2,ERROR:3,RETRY:4,TIMEOUT:5,EXECUTING:6,PAUSED:7,__names__:["DISABLED","ENABLED","EXECUTED","ERROR","RETRY","TIMEOUT","EXECUTING","PAUSED"]};this.JobPermission={remove:0,get:1,set:2,__names__:["remove","get","set"]};this.UserRole={SUPERADMINISTRATOR:0,ADMINISTRATOR:1,USER_MANAGER:2,OPERATOR:3,__names__:["SUPERADMINISTRATOR","ADMINISTRATOR","USER_MANAGER","OPERATOR"]};this.UserPermission={remove:0,get:1,set:2,__names__:["remove","get","set"]};this.UserGroupPermission={remove:0,get:1,set:2,job:3,__names__:["remove","get","set","job"]};this.UserGroupPoolPermission={VIEW:0,USE_SECONDARY:1,USE_PRIMARY:2,MODIFY:3,__names__:["VIEW","USE_SECONDARY","USE_PRIMARY","MODIFY"]};this.PresetPermission={remove:0,get:1,set:2,execute:3,__names__:["remove","get","set","execute"]};this.CronPermission={remove:0,get:1,set:2,__names__:["remove","get","set"]};this.ModificationType={all:0,plugin$list:1,node$list:2,node$add:3,node$remove:4,node$set:5,node$setPermanent:6,node$setEnabled:7,node$setStatus:8,node$setBasicSystemInfo:9,node$setBasicRuntimeInfo:10,node$setJobPlugins:11,node$addPool:12,node$removePool:13,node$addJob:14,node$removeJob:15,pool$list:16,pool$add:17,pool$remove:18,pool$set:19,pool$setEnabled:20,pool$addNode:21,pool$removeNode:22,job$list:23,job$add:24,job$remove:25,job$set:26,job$setPriority:27,job$setStatus:28,job$setNode:29,job$setUser:30,job$setUserGroup:31,job$removePrimaryNode:32,job$removeSecondaryNode:33,job$removePrimaryPool:34,job$removeSecondaryPool:35,user$list:36,user$add:37,user$remove:38,user$set:39,user$addGroup:40,user$removeGroup:41,userGroup$list:42,userGroup$add:43,userGroup$remove:44,userGroup$set:45,userGroup$addUser:46,userGroup$removeUser:47,userGroup$removePool:48,userGroup$removeGroup:49,preset$add:50,preset$remove:51,preset$set:52,cron$add:53,cron$remove:54,cron$set:55,__names__:["all","plugin$list","node$list","node$add","node$remove","node$set","node$setPermanent","node$setEnabled","node$setStatus","node$setBasicSystemInfo","node$setBasicRuntimeInfo","node$setJobPlugins","node$addPool","node$removePool","node$addJob","node$removeJob","pool$list","pool$add","pool$remove","pool$set","pool$setEnabled","pool$addNode","pool$removeNode","job$list","job$add","job$remove","job$set","job$setPriority","job$setStatus","job$setNode","job$setUser","job$setUserGroup","job$removePrimaryNode","job$removeSecondaryNode","job$removePrimaryPool","job$removeSecondaryPool","user$list","user$add","user$remove","user$set","user$addGroup","user$removeGroup","userGroup$list","userGroup$add","userGroup$remove","userGroup$set","userGroup$addUser","userGroup$removeUser","userGroup$removePool","userGroup$removeGroup","preset$add","preset$remove","preset$set","cron$add","cron$remove","cron$set"]};this.ModificationDataAllPermission={pool$add:0,user$add:1,userGroup$add:2,preset$add:3,cron$add:4,__names__:["pool$add","user$add","userGroup$add","preset$add","cron$add"]};this.api=new function(){this.cron$add=function(m,u,p,o,t,r,s,n,x,w,q,v,y){return c("cron/add",{name:m,description:u,hour:p,minute:o,day:t,month:r,year:s,dayOfWeek:n,timeZone:x,preset:w,enabled:q},v,y)};this.cron$get=function(o,n,m){return c("cron/get",{id:o},n,m)};this.cron$ids=function(n,o,m){return c("cron/ids",{filter:JSON.stringify(n)},o,m)};this.cron$list=function(n,o,m){return c("cron/list",{filter:JSON.stringify(n)},o,m)};this.cron$remove=function(n,o,m){return c("cron/remove",{ids:JSON.stringify(n)},o,m)};this.cron$set=function(n,m,v,q,p,u,s,t,o,y,x,r,w,z){return c("cron/set",{id:n,name:m,description:v,hour:q,minute:p,day:u,month:s,year:t,dayOfWeek:o,timeZone:y,preset:x,enabled:r},w,z)};this.job$add=function(o,z,s,u,x,v,w,r,t,q,m,p,y,B,n,A,D){return c("job/add",{name:o,description:z,plugin:s,properties:JSON.stringify(u),priority:x,retries:v,timeout:w,userGroup:r,enabled:t,os:JSON.stringify(q),primaryNodes:JSON.stringify(m),secondaryNodes:JSON.stringify(p),primaryPools:JSON.stringify(y),secondaryPools:JSON.stringify(B),postJobs:JSON.stringify(n)},A,D)};this.job$get=function(o,n,m){return c("job/get",{id:o},n,m)};this.job$getLog=function(p,m,o,n){return c("job/getLog",{id:p,part:m},o,n)};this.job$getProperties=function(o,n,m){return c("job/getProperties",{id:o},n,m)};this.job$ids=function(n,o,m){return c("job/ids",{filter:JSON.stringify(n)},o,m)};this.job$list=function(n,o,m){return c("job/list",{filter:JSON.stringify(n)},o,m)};this.job$pause=function(n,o,p,m){return c("job/pause",{ids:JSON.stringify(n),cancel:o},p,m)};this.job$remove=function(o,m,p,n){return c("job/remove",{ids:JSON.stringify(o),permanently:m},p,n)};this.job$resume=function(n,o,m){return c("job/resume",{ids:JSON.stringify(n)},o,m)};this.job$retry=function(n,o,m){return c("job/retry",{ids:JSON.stringify(n)},o,m)};this.job$set=function(p,n,v,t,r,s,q,m,o,u,x,w,y){return c("job/set",{id:p,name:n,description:v,priority:t,retries:r,timeout:s,os:JSON.stringify(q),primaryNodes:JSON.stringify(m),secondaryNodes:JSON.stringify(o),primaryPools:JSON.stringify(u),secondaryPools:JSON.stringify(x)},w,y)};this.job$setEnabled=function(o,m,p,n){return c("job/setEnabled",{ids:JSON.stringify(o),enabled:m},p,n)};this.job$setPriority=function(o,m,p,n){return c("job/setPriority",{ids:JSON.stringify(o),priority:m},p,n)};this.node$cancelJobs=function(n,o,m){return c("node/cancelJobs",{ids:JSON.stringify(n)},o,m)};this.node$execProcess=function(q,o,n,p,m){return c("node/execProcess",{id:q,command:o,arguments:n},p,m)};this.node$get=function(o,n,m){return c("node/get",{id:o},n,m)};this.node$getEnabled=function(o,n,m){return c("node/getEnabled",{id:o},n,m)};this.node$getJobPlugins=function(o,n,m){return c("node/getJobPlugins",{id:o},n,m)};this.node$getLog=function(o,n,m){return c("node/getLog",{id:o},n,m)};this.node$getPermanent=function(o,n,m){return c("node/getPermanent",{id:o},n,m)};this.node$getRuntimeInfo=function(o,n,m){return c("node/getRuntimeInfo",{id:o},n,m)};this.node$getSession=function(o,n,m){return c("node/getSession",{id:o},n,m)};this.node$getSystemInfo=function(o,n,m){return c("node/getSystemInfo",{id:o},n,m)};this.node$ids=function(n,o,m){return c("node/ids",{filter:JSON.stringify(n)},o,m)};this.node$killProcess=function(p,m,o,n){return c("node/killProcess",{id:p,pid:m},o,n)};this.node$list=function(n,o,m){return c("node/list",{filter:JSON.stringify(n)},o,m)};this.node$pause=function(n,o,p,m){return c("node/pause",{ids:JSON.stringify(n),cancelJobs:o},p,m)};this.node$reboot=function(n,o,m){return c("node/reboot",{ids:JSON.stringify(n)},o,m)};this.node$remove=function(n,o,m){return c("node/remove",{ids:JSON.stringify(n)},o,m)};this.node$resume=function(n,o,m){return c("node/resume",{ids:JSON.stringify(n)},o,m)};this.node$set=function(t,q,p,n,m,s,r,o){return c("node/set",{id:t,permanent:q,plugin:p,properties:JSON.stringify(n),enabled:m,jobPluginsEnabled:JSON.stringify(s)},r,o)};this.node$setEnabled=function(o,m,p,n){return c("node/setEnabled",{ids:JSON.stringify(o),enabled:m},p,n)};this.node$setPermanent=function(n,o,p,m){return c("node/setPermanent",{ids:JSON.stringify(n),permanent:o},p,m)};this.node$shutdown=function(n,o,m){return c("node/shutdown",{ids:JSON.stringify(n)},o,m)};this.node$stop=function(n,o,m){return c("node/stop",{ids:JSON.stringify(n)},o,m)};this.node$wake=function(n,o,m){return c("node/wake",{ids:JSON.stringify(n)},o,m)};this.plugin$getData=function(o,n,m){return c("plugin/getData",{id:o},n,m)};this.plugin$list=function(n,m){return c("plugin/list",{},n,m)};this.plugin$listJob=function(n,m){return c("plugin/listJob",{},n,m)};this.plugin$listNode=function(n,m){return c("plugin/listNode",{},n,m)};this.plugin$listPostJob=function(n,m){return c("plugin/listPostJob",{},n,m)};this.pool$add=function(o,q,n,m,r,p){return c("pool/add",{name:o,description:q,enabled:n,nodes:JSON.stringify(m)},r,p)};this.pool$addNodes=function(p,m,o,n){return c("pool/addNodes",{id:p,nodes:JSON.stringify(m)},o,n)};this.pool$cancelJobs=function(n,o,m){return c("pool/cancelJobs",{ids:JSON.stringify(n)},o,m)};this.pool$get=function(o,n,m){return c("pool/get",{id:o},n,m)};this.pool$getEnabled=function(o,n,m){return c("pool/getEnabled",{id:o},n,m)};this.pool$getNodes=function(o,n,m){return c("pool/getNodes",{id:o},n,m)};this.pool$ids=function(n,o,m){return c("pool/ids",{filter:JSON.stringify(n)},o,m)};this.pool$list=function(n,o,m){return c("pool/list",{filter:JSON.stringify(n)},o,m)};this.pool$moveNodes=function(q,p,m,o,n){return c("pool/moveNodes",{from:q,to:p,nodes:JSON.stringify(m)},o,n)};this.pool$pauseNodes=function(n,o,p,m){return c("pool/pauseNodes",{ids:JSON.stringify(n),cancelJobs:o},p,m)};this.pool$rebootNodes=function(n,o,m){return c("pool/rebootNodes",{ids:JSON.stringify(n)},o,m)};this.pool$remove=function(n,o,m){return c("pool/remove",{ids:JSON.stringify(n)},o,m)};this.pool$removeNodes=function(p,m,o,n){return c("pool/removeNodes",{id:p,nodes:JSON.stringify(m)},o,n)};this.pool$resumeNodes=function(n,o,m){return c("pool/resumeNodes",{ids:JSON.stringify(n)},o,m)};this.pool$set=function(s,o,q,n,m,r,p){return c("pool/set",{id:s,name:o,description:q,enabled:n,nodes:JSON.stringify(m)},r,p)};this.pool$setEnabled=function(o,m,p,n){return c("pool/setEnabled",{ids:JSON.stringify(o),enabled:m},p,n)};this.pool$setNodes=function(p,m,o,n){return c("pool/setNodes",{id:p,nodes:JSON.stringify(m)},o,n)};this.pool$shutdownNodes=function(n,o,m){return c("pool/shutdownNodes",{ids:JSON.stringify(n)},o,m)};this.pool$stopNodes=function(n,o,m){return c("pool/stopNodes",{ids:JSON.stringify(n)},o,m)};this.pool$wakeNodes=function(n,o,m){return c("pool/wakeNodes",{ids:JSON.stringify(n)},o,m)};this.preset$add=function(m,o,p,q,n){return c("preset/add",{name:m,description:o,actions:JSON.stringify(p)},q,n)};this.preset$execute=function(o,n,m){return c("preset/execute",{id:o},n,m)};this.preset$get=function(o,n,m){return c("preset/get",{id:o},n,m)};this.preset$ids=function(n,o,m){return c("preset/ids",{filter:JSON.stringify(n)},o,m)};this.preset$list=function(n,o,m){return c("preset/list",{filter:JSON.stringify(n)},o,m)};this.preset$remove=function(n,o,m){return c("preset/remove",{ids:JSON.stringify(n)},o,m)};this.preset$set=function(r,m,o,p,q,n){return c("preset/set",{id:r,name:m,description:o,actions:JSON.stringify(p)},q,n)};this.server$getLog=function(n,m){return c("server/getLog",{},n,m)};this.server$getRuntimeInfo=function(n,m){return c("server/getRuntimeInfo",{},n,m)};this.server$getSystemInfo=function(n,m){return c("server/getSystemInfo",{},n,m)};this.server$stop=function(n,m){return c("server/stop",{},n,m)};this.user$add=function(r,s,m,p,o,n,q,t,u){return c("user/add",{email:r,password:s,name:m,surname:p,alias:o,role:n,enabled:q},t,u)};this.user$addGroups=function(p,m,o,n){return c("user/addGroups",{id:p,groups:JSON.stringify(m)},o,n)};this.user$get=function(o,n,m){return c("user/get",{id:o},n,m)};this.user$ids=function(n,o,m){return c("user/ids",{filter:JSON.stringify(n)},o,m)};this.user$list=function(n,o,m){return c("user/list",{filter:JSON.stringify(n)},o,m)};this.user$remove=function(n,o,m){return c("user/remove",{ids:JSON.stringify(n)},o,m)};this.user$removeGroups=function(p,m,o,n){return c("user/removeGroups",{id:p,groups:JSON.stringify(m)},o,n)};this.user$set=function(n,s,m,q,p,o,r,t,u){return c("user/set",{id:n,email:s,name:m,surname:q,alias:p,role:o,enabled:r},t,u)};this.user$setClient=function(m,o,p,n){return c("user/setClient",{client:m,data:o},p,n)};this.user$setGroups=function(p,m,o,n){return c("user/setGroups",{id:p,groups:JSON.stringify(m)},o,n)};this.user$setPassword=function(p,m,o,n){return c("user/setPassword",{id:p,password:m},o,n)};this.userGroup$add=function(m,q,n,p,r,o,u,s,t){return c("userGroup/add",{name:m,description:q,users:JSON.stringify(n),plugins:JSON.stringify(p),pools:JSON.stringify(r),groups:JSON.stringify(o),permission:u},s,t)};this.userGroup$addUsers=function(p,o,n,m){return c("userGroup/addUsers",{id:p,users:JSON.stringify(o)},n,m)};this.userGroup$get=function(o,n,m){return c("userGroup/get",{id:o},n,m)};this.userGroup$ids=function(n,o,m){return c("userGroup/ids",{filter:JSON.stringify(n)},o,m)};this.userGroup$list=function(n,o,m){return c("userGroup/list",{filter:JSON.stringify(n)},o,m)};this.userGroup$remove=function(n,o,m){return c("userGroup/remove",{ids:JSON.stringify(n)},o,m)};this.userGroup$removeUsers=function(p,o,n,m){return c("userGroup/removeUsers",{id:p,users:JSON.stringify(o)},n,m)};this.userGroup$set=function(n,m,r,o,q,s,p,t,u){return c("userGroup/set",{id:n,name:m,description:r,users:JSON.stringify(o),plugins:JSON.stringify(q),pools:JSON.stringify(s),groups:JSON.stringify(p)},t,u)};this.userGroup$setUsers=function(p,o,n,m){return c("userGroup/setUsers",{id:p,users:JSON.stringify(o)},n,m)}};this.addEvents(this.ModificationType.__names__);this.UserGroupUserGroupPermission={VIEW:0,MODIFY:1,__names__:["VIEW","MODIFY"]};var g=this;this.on(this.ModificationType.__names__[this.ModificationType.all],function(){g.$allEventReceived=true});function l(m,q,r,o){var n=(r!=null);var p=$.ajax({url:"api/"+m,method:"POST",headers:{"croupier-user":(croupier.user!=null?croupier.user.id:0),"croupier-session":(croupier.user!=null?croupier.user.session:"login"),"croupier-format":"json"},data:q,async:n,dataType:"json",timeout:10000,complete:(n?function(){r.call(o?o:this,p.responseJSON)}:null)});return(!n?p.responseJSON:null)}function c(n,o,p){if(App.config.debug&&log4javascript&&log4javascript.isEnabled()&&log4javascript.getRootLogger().isDebugEnabled()){log4javascript.getRootLogger().debug("croupier.api.request: "+n+" "+JSON.stringify(o));console.dir(o)}if(croupier.data.disposed()){return l(n,o,p)}else{croupier.data.stop();if(p!=null){return l(n,o,function(q){if(App.config.debug&&log4javascript&&log4javascript.isEnabled()&&log4javascript.getRootLogger().isDebugEnabled()){log4javascript.getRootLogger().debug("croupier.api.response: "+JSON.stringify(q))}croupier.data.request(function(){p(q)})})}else{var m=l(n,o);if(App.config.debug&&log4javascript&&log4javascript.isEnabled()&&log4javascript.getRootLogger().isDebugEnabled()){log4javascript.getRootLogger().debug("croupier.api.response: "+JSON.stringify(m))}croupier.data.request(null);return m}}}this.user=null;this.login=function(o,n,m,r,p){this.logout();var q={};q.email=o;q.password=n;q.client=m;if(r!=null){return l("auth/login",q,function(s){r.call(p,d(s))})}else{return d(l("auth/login",q))}};var d=function(m){if(m.status==croupier.ResponseStatus.SUCCESS){croupier.user=m.value}return m};this.logout=function(){if(this.user!=null){this.data.dispose();l("auth/logout",{},null);this.user=null}};function a(r,o,t,u){function s(z,B,A){this.key=z;this.value=B;this.next=A}var y=0.75;var m=r;var v=new Array(m);var p=Math.floor(m*y);var x=m-1;var w=0;var n=o;var q=t;this.get=function(A){var z=A&x;for(var B=v[z];B!=null;B=B.next){if(B.key==A){return B.value}}return null};this.add=function(F){if(q!=null){q(F)}var E=F[n];var B=E&x;for(var G=v[B];G!=null;G=G.next){if(G.key==E){G.value=F;return false}}if(w>=p){var H=m;var A=v;m=H<<1;v=new Array(m);p=Math.floor(m*y);x=m-1;for(var D=H-1;D>=0;D--){for(var z=A[D];z!=null;){G=z;z=z.next;B=G.key&x;G.next=v[B];v[B]=G}}B=E&x}v[B]=new s(E,F,v[B]);w++;return true};this.addAll=function(A){for(var B=0,z=A.length;B<z;B++){this.add(A[B])}};this.setAll=function(z){this.clear();this.addAll(z)};this.remove=function(A){var z=A&x;for(var D=v[z],B=null;D!=null;B=D,D=D.next){if(D.key==A){if(B!=null){B.next=D.next}else{v[z]=D.next}w--;return true}}return false};this.clear=function(){for(var z=m-1;z>=0;z--){v[z]=null}w=0};this.size=function(){return w};this.keys=function(A){if(!A||this.filtered==null){var D=new Array(w);var z=0;for(var B=m-1;B>=0;B--){for(var E=v[B];E!=null;E=E.next){D[z++]=E.key}}return D}else{return this.filtered}};this.values=function(B){var z=null;var A=0;if(!B||this.filtered==null){z=new Array(w);for(var D=m-1;D>=0;D--){for(var E=v[D];E!=null;E=E.next){z[A++]=E.value}}}else{z=new Array(this.filtered.length);for(A=z.length-1;A>=0;A--){z[A]=this.get(this.filtered[A])}}return z};if(u!=null){this.addAll(u)}}var b=4294967296;var e=22;var h=(1<<e)-1;var f=9;var k=((1<<f)-1)<<e;this.toJobLongId=function(m){return b*m};this.toJobSimpleId=function(m){return m/b};function j(p,n,q,m){a.call(this,p,n,q,m);var o=this.get;this.get=function(s){if(s<b){return o(s)}else{var t=o(Math.floor(s/b));if(t!=null){var u=(s&k)>>e;var r=s&h;if(u==0&&r==0){return t}else{if(u==0){return(t.indexer==null&&t.children!=null&&r>=1&&r<=t.children.length?t.children[r-1]:null)}else{if(t.indexer!=null&&u>=1&&u<=t.indexer.length){t=t.indexer[u-1];return(r==0?t:(t.children!=null&&r>=1&&r<=t.children.length?t.children[r-1]:null))}else{return null}}}}return t}}}j.prototype=new a();j.prototype.constructor=j;this.data=new function(){function o(){this.id=-1;this.refresh=0;this.timeout=null;this.callback=null}var p=null;this.start=function(u,v,t,w){if(this.disposed()){p=new o();this.nodes=new a(1024,"id",function(x){x.registered=m(x.registered)});this.pools=new a(1024,"id");this.jobs=new j(1024,"id",function(y){var x=[];r(y,y,null,0,x);y.root=y;y.longId=croupier.toJobLongId(y.id);if(x.length>0){y.indexer=x}});this.users=new a(1024,"id");this.userGroups=new a(1024,"id",function(x){x.pools=new a(16,"pool",null,x.pools);x.groups=new a(16,"other",null,x.groups)});this.presets=new a(1024,"id");this.crons=new a(1024,"id")}p.refresh=u;this.nodes.filter=(v!=null?JSON.stringify(v):null);this.jobs.filter=(t!=null?JSON.stringify(t):null);p.callback=(w!=null?w:function(){});this.request(p.callback)};this.stop=function(){if(!this.disposed()&&p.timeout!=null){clearTimeout(p.timeout);p.timeout=null}};this.request=function(v){if(App.config.debug&&log4javascript&&log4javascript.isEnabled()&&log4javascript.getRootLogger().isDebugEnabled()){log4javascript.getRootLogger().debug("croupier.data.request")}if(!this.disposed()){var u={id:p.id,nodesFilter:this.nodes.filter,jobsFilter:this.jobs.filter};var t=p.callback;this.stop();if(v!=null){l("modification/list",u,function(w){q(croupier.data,p,w);if(v!=t){v(w)}})}else{return q(croupier.data,p,l("modification/list",u))}}return null};function q(A,y,w){if(!A.disposed()){var u=0;if(App.config.debug&&log4javascript&&log4javascript.isEnabled()&&log4javascript.getRootLogger().isDebugEnabled()){u=new Date().getTime();log4javascript.getRootLogger().debug("croupier.data.response: "+JSON.stringify(w))}var B=y.callback;if(w!=null&&w.status==croupier.ResponseStatus.SUCCESS){y.id=w.value.id;A.nodes.filtered=w.value.nodesFiltered;A.jobs.filtered=w.value.jobsFiltered;var z=w.value.modifications;if(z!=null){for(var x=0,v=z.length;x<v;x++){var t=z[x];n(A,t.type,t.id,t.data)}}y.timeout=setTimeout(function(){croupier.data.request(y.callback)},y.refresh)}else{A.dispose();croupier.user=null}if(App.config.debug&&log4javascript&&log4javascript.isEnabled()&&log4javascript.getRootLogger().isDebugEnabled()){u=new Date().getTime()-u;log4javascript.getRootLogger().debug("croupier.onModified: "+u+" ms")}if(B!=null){B(w)}}return w}function n(t,u,x,v){if(App.config.debug&&log4javascript&&log4javascript.isEnabled()&&log4javascript.getRootLogger().isDebugEnabled()){log4javascript.getRootLogger().debug("croupier.data.processModified: "+croupier.ModificationType.__names__[u]+" - "+(x<b?x:((x/b)+"_"+((x&k)>>e)+"_"+(x&h)))+" - "+JSON.stringify(v))}var w=null;if(u==croupier.ModificationType.all){t.config={job:v.jobConfig};t.plugins={job:v.jobPlugins,postJob:v.postJobPlugins,node:v.nodePlugins};t.nodes.setAll(v.nodes);t.pools.setAll(v.pools);t.jobs.setAll(v.jobs);t.users.setAll(v.users);t.userGroups.setAll(v.userGroups);t.presets.setAll(v.presets);t.crons.setAll(v.crons);t.permissions=v.permissions}else{if(u==croupier.ModificationType.plugin$list){t.plugins.job=v[0];t.plugins.postJob=v[1];t.plugins.node=v[2]}else{if(u==croupier.ModificationType.node$list){t.nodes.setAll(v)}else{if(u==croupier.ModificationType.node$add){if(!t.nodes.add(v)){return}}else{if(u==croupier.ModificationType.node$remove){if(!t.nodes.remove(x)){return}}else{if(u==croupier.ModificationType.node$set){w=t.nodes.get(x);w.permanent=v.permanent;w.plugin=v.plugin;w.properties=v.properties;w.enabled=v.enabled;w.jobPlugins=v.jobPlugins}else{if(u==croupier.ModificationType.node$setPermanent){t.nodes.get(x).permanent=v}else{if(u==croupier.ModificationType.node$setEnabled){t.nodes.get(x).enabled=v}else{if(u==croupier.ModificationType.node$setStatus){w=t.nodes.get(x);w.status=v.status;w.progress=v.progress;w.on=v.on}else{if(u==croupier.ModificationType.node$setBasicSystemInfo){t.nodes.get(x).basicSystemInfo=v}else{if(u==croupier.ModificationType.node$setBasicRuntimeInfo){t.nodes.get(x).basicRuntimeInfo=v}else{if(u==croupier.ModificationType.node$setJobPlugins){t.nodes.get(x).jobPlugins=v}else{if(u==croupier.ModificationType.node$addPool){t.nodes.get(x).pools.push(v)}else{if(u==croupier.ModificationType.node$removePool){if(!s(t.nodes.get(x).pools,v)){return}}else{if(u==croupier.ModificationType.node$addJob){t.nodes.get(x).jobs.push(v)}else{if(u==croupier.ModificationType.node$removeJob){if(!s(t.nodes.get(x).jobs,v)){return}}else{if(u==croupier.ModificationType.pool$list){t.pools.setAll(v)}else{if(u==croupier.ModificationType.pool$add){if(!t.pools.add(v)){return}}else{if(u==croupier.ModificationType.pool$remove){if(!t.pools.remove(x)){return}}else{if(u==croupier.ModificationType.pool$set){w=t.pools.get(x);w.name=v.name;w.description=v.description;w.enabled=v.enabled}else{if(u==croupier.ModificationType.pool$setEnabled){t.pools.get(x).enabled=v}else{if(u==croupier.ModificationType.pool$addNode){t.pools.get(x).nodes.push(v)}else{if(u==croupier.ModificationType.pool$removeNode){if(!s(t.pools.get(x).nodes,v)){return}}else{if(u==croupier.ModificationType.job$list){t.jobs.setAll(v)}else{if(u==croupier.ModificationType.job$add){if(!t.jobs.add(v)){return}}else{if(u==croupier.ModificationType.job$remove){if(!t.jobs.remove(croupier.toJobSimpleId(x))){return}}else{if(u==croupier.ModificationType.job$set){w=t.jobs.get(x);w.name=v.name;w.description=v.description;w.priority=v.priority;w.retries=v.retries;w.timeout=v.timeout;w.primaryNodes=v.primaryNodes;w.secondaryNodes=v.secondaryNodes;w.primaryPools=v.primaryPools;w.secondaryPools=v.secondaryPools}else{if(u==croupier.ModificationType.job$setPriority){t.jobs.get(x).priority=v}else{if(u==croupier.ModificationType.job$setStatus){w=t.jobs.get(x);console.log(w);w.status=v.status;w.progress=v.progress;w.start=(v.start!=null?m(v.start):null);w.finish=(v.finish!=null?m(v.finish):null);w.time=v.time;w.warnings=v.warnings;w.errors=v.errors}else{if(u==croupier.ModificationType.job$setNode){t.jobs.get(x).node=v}else{if(u==croupier.ModificationType.job$setUser){t.jobs.get(x).user=v}else{if(u==croupier.ModificationType.job$setUserGroup){t.jobs.get(x).userGroup=v}else{if(u==croupier.ModificationType.job$removePrimaryNode){if(!s(t.jobs.get(x).primaryNodes,v)){return}}else{if(u==croupier.ModificationType.job$removeSecondaryNode){if(!s(t.jobs.get(x).secondaryNodes,v)){return}}else{if(u==croupier.ModificationType.job$removePrimaryPool){if(!s(t.jobs.get(x).primaryPools,v)){return}}else{if(u==croupier.ModificationType.job$removeSecondaryPool){if(!s(t.jobs.get(x).secondaryPools,v)){return}}else{if(u==croupier.ModificationType.user$list){t.users.setAll(v)}else{if(u==croupier.ModificationType.user$add){if(!t.users.add(v)){return}}else{if(u==croupier.ModificationType.user$remove){if(!t.users.remove(x)){return}}else{if(u==croupier.ModificationType.user$set){w=t.users.get(x);w.email=v.email;w.name=v.name;w.surname=v.surname;w.alias=v.alias;w.role=v.role;w.enabled=v.enabled}else{if(u==croupier.ModificationType.user$addGroup){t.users.get(x).groups.push(v)}else{if(u==croupier.ModificationType.user$removeGroup){if(!s(t.users.get(x).groups,v)){return}}else{if(u==croupier.ModificationType.userGroup$list){t.userGroups.setAll(v)}else{if(u==croupier.ModificationType.userGroup$add){if(!t.userGroups.add(v)){return}}else{if(u==croupier.ModificationType.userGroup$remove){if(!t.userGroups.remove(x)){return}}else{if(u==croupier.ModificationType.userGroup$set){w=t.userGroups.get(x);w.name=v.name;w.description=v.description;w.users=v.users;w.plugins=v.plugins;w.pools.setAll(v.pools);w.groups.setAll(v.groups)}else{if(u==croupier.ModificationType.userGroup$addUser){t.userGroups.get(x).users.push(v)}else{if(u==croupier.ModificationType.userGroup$removeUser){if(!s(t.userGroups.get(x).users,v)){return}}else{if(u==croupier.ModificationType.userGroup$removePool){if(!t.userGroups.get(x).pools.remove(v)){return}}else{if(u==croupier.ModificationType.userGroup$removeGroup){if(!t.userGroups.get(x).groups.remove(v)){return}}else{if(u==croupier.ModificationType.preset$add){if(!t.presets.add(v)){return}}else{if(u==croupier.ModificationType.preset$remove){if(!t.presets.remove(x)){return}}else{if(u==croupier.ModificationType.preset$set){w=t.presets.get(x);w.name=v.name;w.description=v.description;w.actions=v.actions}else{if(u==croupier.ModificationType.cron$add){if(!t.crons.add(v)){return}}else{if(u==croupier.ModificationType.cron$remove){if(!t.crons.remove(x)){return}}else{if(u==croupier.ModificationType.cron$set){w=t.crons.get(x);w.name=v.name;w.description=v.description;w.hour=v.hour;w.minute=v.minute;w.day=v.day;w.month=v.month;w.year=v.year;w.dayOfWeek=v.dayOfWeek;w.timeZone=v.timeZone;w.preset=v.preset;w.enabled=v.enabled}else{console.error("processModified(): type not processed ("+u+")")}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if(App.config.debug){console.info("[App.API] fires event: "+croupier.ModificationType.__names__[u]);console.info("[App.API] ID:"+x)}croupier.fireEvent(croupier.ModificationType.__names__[u],v,x)}this.dispose=function(){if(!this.disposed()){this.stop();this.config=null;this.plugins=null;this.nodes=null;this.pools=null;this.jobs=null;this.users=null;this.userGroups=null;this.presets=null;this.crons=null;p=null}};this.disposed=function(){return(p==null)};function s(v,u){var t=$.inArray(u,v);if(t!=-1){v.splice(t,1);return true}else{return false}}function m(t){return new Date(t).toLocaleString()}function r(y,t,x,u,w){if(x!=null){y.root=t;y.parent=x;if(y.group!=null){y.part=y.group<<e;w.push(y)}else{y.part=x.part|u}y.longId=croupier.toJobLongId(t.id)+y.part;y.id=t.id}if(y.children!=null){u=0;for(var v=0;v<y.children.length;v++){r(y.children[v],t,y,++u,w)}}if(y.created!=null){y.created=m(y.created)}if(y.start!=null){y.start=m(y.start)}if(y.finish!=null){y.finish=m(y.finish)}}}}});App.API.multiAction=function(d,a,e,c,b){croupier.api[a+"$"+d](e.toIds(),function(f){if(f.status==croupier.ResponseStatus.SUCCESS){if($.isFunction(c)){c.call(b||this)}if(App.mainBox){App.mainBox.progress(100);App.mainBox.done()}}})};window.croupier=window.croupier||new App.API();Ext.namespace("App.Croupier");Ext.namespace("App.Panel");App.Croupier.General=Ext.extend(App.AbstractClass,{load_layout:function(){App.Panel.Header=new panel_header();the_panel_tabs=App.tabs=new App.Tabs({html_id:"tabs",scrollBarWidths:40,wrapperClass:"wrapper",listClass:"list",scrollerLeftClass:"scroller-left",scrollerRightClass:"scroller-right"});App.tabs.create_tab(App.config.panels[App.config.initialPanel]);window.the_button_open_new_tabs=new button_open_new_tabs()},init_star:function(){console.info("[Croupier.API] Data start");croupier.data.start(App.config.updateInterval?App.config.updateInterval:5000,App.config.nodesFilter,App.config.jobsFilter,function(a){if(!a){return}})},update_data:function(a){}});function in_array(b,a){if(jQuery.inArray(b,a)!=-1){return true}else{return false}}function existInHTML(a){if($(a).length){return true}else{return false}}function arrayKeys(c){var b=new Array();var a=0;for(i in c){b[a++]=i}return b}function disableButton(b){$(b).removeAttr("href");var a=$(b).find("img").attr("src");a=a.replace("/active/","/desactive/");$(b).find("img").attr("src",a);$(b).off("click")}function enableButton(b,c){$(b).attr("href","#");var a=$(b).find("img").attr("src");a=a.replace("/desactive/","/active/");$(b).find("img").attr("src",a);$(b).click(c)}function buscar_elemento(b,e){if(!jQuery.isArray(b)){log4javascript.getRootLogger().error("La funciï¿½n buscar_elemento necesita un array ");return(false)}else{}var f=false;var a=0;var d=Object.keys(b);var c=d.length;while(f==false&&a<c){f=e(b[d[a]]);a++}if(f===false){return false}else{return d[a-1]}}Number.prototype.padLeft=function(c,b){var a=(String(c||10).length-String(this).length)+1;return a>0?new Array(a).join(b||"0")+this:this};function getHourMinSec(a){if(a==undefined){var a=new Date}return(a.getHours().padLeft()+":"+a.getMinutes().padLeft()+":"+a.getSeconds().padLeft())}function escapeRegExp(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function select_all(c,f,e){if(e==undefined){e=true}else{if(e=="1"){e=true}else{if(e=="0"){e=false}}}log4javascript.getRootLogger().info("select_all: "+e);var a;var g;var d=document.getElementById(c);for(var b=0;b<d.elements.length;b++){poner_a_true=false;if(d.elements[b].type=="checkbox"){if(f!=undefined){g=d.elements[b].name;a=g.substr(0,f.length);if(a==f){poner_a_true=true}}else{poner_a_true=true}if(poner_a_true){d.elements[b].checked=e}}}}function replaceAll(e,a){if(typeof e!="string"){log4javascript.getRootLogger().error("replaceAll() need a string in first parameter");return false}var d=Object.keys(a);for(var b in d){d[b]=escapeRegExp(d[b])}var c=new RegExp(d.join("|"),"gi");return e.replace(c,function(f){return a[f]})}Ext.namespace("App.Croupier");App.Croupier.User=Ext.extend(App.Croupier.General,{login:function(){console.info("Trying to login with name: "+user);croupier.login($("#user").val(),md5($("#password").val()),"croupier-web-admin",this.onLogin,this)},checkLogin:function(a){},logout:function(){croupier.logout();if(Array.isArray(App.tabs.a_tabs)){App.tabs.a_tabs.forEach(function(a){a.close()})}$("#signin_form").fadeIn();location.reload()},constructor:function(){var a=this;this.addEvents("loginsuccess","loginerror");$("#signin_form").submit(function(d){d.preventDefault();d.stopImmediatePropagation();if(typeof LOGANDOSE=="undefined"||LOGANDOSE==false){LOGANDOSE=true;$("#info").hide();var c=md5($("#password").val());var b=$("#user").val();a.login(b,c)}})},onLogin:function(a){console.info("login done");if(a.status==croupier.ResponseStatus.SUCCESS){Ext.apply(this,a.value);$("#info").html("Login Success. Redirecting...").removeClass("alert-danger alert-success").addClass("alert-success").fadeIn("slow");LOGANDOSE=false;App.user.fireEvent("loginsuccess")}else{App.user.fireEvent("loginerror",a);console.warn("Login error: "+JSON.stringify(a))}}});HTML_CODE=new Object();HTML_CODE.Progres='<div class="progress">';HTML_CODE.Progres_bar='<div class="progress"><div class="progress-bar  progress-bar-info" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100" style="width:{WIDTH}%;">{PERCENT}%</div></div>';HTML_CODE.Progres_bar_executed='<div class="progress"><div class="progress-bar  progress-bar-success" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100" style="width:{WIDTH}%;">{PERCENT}%</div></div>';HTML_CODE.Progres_bar_danger='<div class="progress"><div class="progress-bar  progress-bar-danger" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100" style="width:{WIDTH}%;">{PERCENT}%</div></div>';HTML_CODE.Progres_bar_warning='<div class="progress"><div class="progress-bar  progress-bar-warning" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100" style="width:{WIDTH}%;">{PERCENT}%</div></div>';HTML_CODE.tr_pending="pending";HTML_CODE.tr_disabled="disabled";HTML_CODE.tr_finished="finished";HTML_CODE.tr_paused="paused";HTML_CODE.tr_error="with-error";HTML_CODE.tr_progress="in-progress";HTML_CODE.row_node="<td><input type='checkbox' /></td>";HTML_CODE.row_node+="<td>$VAR_OS$</td>";HTML_CODE.row_node+="<td>$VAR_IP$</td>";HTML_CODE.row_node+="<td>$VAR_NAME$</td>";HTML_CODE.row_node+="<td>$VAR_STATUS$</td>";HTML_CODE.row_node+="<td>$VAR_JOB_NAME$</td>";HTML_CODE.row_node+="<td>$VAR_PROGRESS$</td>";HTML_CODE.row_node+="<td>$VAR_TIME$</td>";HTML_CODE.row_node+="<td>$VAR_NODE_POOLS$</td>";HTML_CODE.row_node+="</tr>";HTML_CODE.row_job="<td><input type='checkbox' /></td>";HTML_CODE.row_job+="<td>$VAR_ID$</td>";HTML_CODE.row_job+="<td>$VAR_NAME_JOB$</td>";HTML_CODE.row_job+="<td>$VAR_PLUGIN$</td>";HTML_CODE.row_job+="<td>$VAR_PROGRESS$</td>";HTML_CODE.row_job+="<td>$VAR_CONFIGURATION$</td>";HTML_CODE.row_job+="<td>$VAR_STATUS$</td>";HTML_CODE.row_job+="<td>$VAR_PRIORITY$</td>";HTML_CODE.row_job+="<td>$VAR_ERRORS$</td>";HTML_CODE.row_job+="<td>$VAR_WARNINGS$</td>";HTML_CODE.row_job+="<td>$VAR_PRIMARY_POOLS$</td>";HTML_CODE.row_job+="<td>$VAR_SECUNDARY_POOLS$</td>";HTML_CODE.row_job+="<td>$VAR_PRIMARY_NODES$</td>";HTML_CODE.row_job+="<td>$VAR_SECUNDARY_NODES$</td>";HTML_CODE.row_job+="<td>$VAR_CHANGE_STATE$</td>";HTML_CODE.row_job+="</tr>";HTML_CODE.user_list=[];HTML_CODE.user_list.row_user="<tr>";HTML_CODE.user_list.row_user+="	<td>";HTML_CODE.user_list.row_user+='		<input class="user_check" type="checkbox" id="user_checkbox_$user_id$"/>';HTML_CODE.user_list.row_user+="</td>";HTML_CODE.user_list.row_user+='	<td><a href="#" id="user_nick_$user_id$" id_user="$user_id$">$user_nick$</a></td>';HTML_CODE.user_list.row_user+="	<td>$user_name$</td>";HTML_CODE.user_list.row_user+="	<td>$user_subname$</td>";HTML_CODE.user_list.row_user+="	<td>$user_mail$</td>";HTML_CODE.user_list.row_user+="	<td>$user_role$</td>";HTML_CODE.user_list.row_user+="	<td>$user_groups$</td>";HTML_CODE.user_list.row_user+="</tr>";HTML_CODE.user_data=[];HTML_CODE.user_data.row_group="<tr>";HTML_CODE.user_data.row_group+="	<td>";HTML_CODE.user_data.row_group+='		<input type="checkbox" id="group_checkbox_$group_id$"/>';HTML_CODE.user_data.row_group+="    </td>";HTML_CODE.user_data.row_group+="	<td>$group_name$</td>";HTML_CODE.user_data.row_group+="	<td>$group_num_users$</td>";HTML_CODE.user_data.row_group+="</tr>";HTML_CODE.user_data.row_group_other="<tr>";HTML_CODE.user_data.row_group_other+="	<td>";HTML_CODE.user_data.row_group_other+='		<input type="checkbox" id="group_checkbox_other_$group_id$"/>';HTML_CODE.user_data.row_group_other+="  </td>";HTML_CODE.user_data.row_group_other+="	<td>$group_name$</td>";HTML_CODE.user_data.row_group_other+="	<td>$group_num_users$</td>";HTML_CODE.user_data.row_group_other+="</tr>";HTML_CODE.group_list=[];HTML_CODE.group_list.row_group="<tr>";HTML_CODE.group_list.row_group+="	<td>";HTML_CODE.group_list.row_group+='		<input class="group_check" type="checkbox" id_group="$group_id$" id="group_checkbox_$group_id$"/>';HTML_CODE.group_list.row_group+="</td>";HTML_CODE.group_list.row_group+='	<td><a href="#" id="group_name$group_id$" id_group="$group_id$">$group_name$</a></td>';HTML_CODE.group_list.row_group+="	<td>$number_users$</td>";HTML_CODE.group_list.row_group+="	<td>$number_plugins$</td>";HTML_CODE.group_list.row_group+="	<td>$number_pools$</td>";HTML_CODE.group_list.row_group+="</tr>";HTML_CODE.li_tab_editable='<li class="dropdown active" id="$ID_TAB$">';HTML_CODE.li_tab_editable+='		<a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">';HTML_CODE.li_tab_editable+='		<input type="text" id="text_editing_$ID_TAB$" style=" display: none;"> ';HTML_CODE.li_tab_editable+='		<span id="go_$ID_TAB$">$NAME_TAB$</span> ';HTML_CODE.li_tab_editable+='			<span class="glyphicon glyphicon-pencil" STYLE="font-size: 10pt" id="edit_$ID_TAB$"></span>';HTML_CODE.li_tab_editable+='			<span class="glyphicon glyphicon-remove" STYLE="font-size: 10pt" id="close_$ID_TAB$"></span>';HTML_CODE.li_tab_editable+="		</a>";HTML_CODE.li_tab_editable+="	</ul>\n";HTML_CODE.li_tab_editable+="</li>";HTML_CODE.li_tab_no_editable='<li class="dropdown active" id="$ID_TAB$">';HTML_CODE.li_tab_no_editable+='		<a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">';HTML_CODE.li_tab_no_editable+='		<input type="text" id="text_editing_$ID_TAB$" style=" display: none;"> ';HTML_CODE.li_tab_no_editable+='		<span id="go_$ID_TAB$">$NAME_TAB$</span> ';HTML_CODE.li_tab_no_editable+='			<span class="glyphicon glyphicon-remove" STYLE="font-size: 10pt" id="close_$ID_TAB$"></span>';HTML_CODE.li_tab_no_editable+="		</a>";HTML_CODE.li_tab_no_editable+="	</ul>\n";HTML_CODE.li_tab_no_editable+="</li>";HTML_CODE.new_job=new Object();HTML_CODE.new_job.por_defecto="<option disabled selected> -- select a configuration -- </option>";HTML_CODE.new_job.por_defecto_plugin="<option disabled selected> -- select a plugin -- </option>";HTML_CODE.new_job.data_plugin="<option $VAR_SELECTED$ ";HTML_CODE.new_job.data_plugin+='value ="$VAR_VALUE$" >$VAR_TEXT$';HTML_CODE.new_job.data_plugin+="</option>";HTML_CODE.new_job.plugin_list_job="<option $VAR_SELECTED$ ";HTML_CODE.new_job.plugin_list_job+=' style="background-image: url(data:image/png;base64,$VAR_ICON$)" ';HTML_CODE.new_job.plugin_list_job+='value ="$VAR_VALUE$" >$VAR_TEXT$';HTML_CODE.new_job.plugin_list_job+="</option>";HTML_CODE.new_job.parameters_text_box='<div class="form-group">';HTML_CODE.new_job.parameters_text_box+='<label class="col-sm-2 control-label" for="jobAddOperation">';HTML_CODE.new_job.parameters_text_box+="$VAR_LABEL$";HTML_CODE.new_job.parameters_text_box+="</label>";HTML_CODE.new_job.parameters_text_box+='<div class="col-sm-4">';HTML_CODE.new_job.parameters_text_box+='<input type="text" class="form-control" placeholder="" ';HTML_CODE.new_job.parameters_text_box+=' value="$VAR_VALUE$"  ';HTML_CODE.new_job.parameters_text_box+=' name="$VAR_NAME$" ';HTML_CODE.new_job.parameters_text_box+=' id="$VAR_ID$" ';HTML_CODE.new_job.parameters_text_box+=" />";HTML_CODE.new_job.parameters_text_box+=" </div>";HTML_CODE.new_job.parameters_text_box+=" </div>";HTML_CODE.panels=[];$.ajax({url:C.panels.panel_monitor.url,async:true,success:function(a){HTML_CODE.panels.panel_monitor=a}});$.ajax({url:C.panels.new_job.url,async:true,success:function(a){HTML_CODE.panels.new_job=a}});$.ajax({url:C.panels.panel_user_list.url,async:true,success:function(a){HTML_CODE.panels.panel_user_list=a}});$.ajax({url:C.panels.button_open_new_tabs.url,async:true,success:function(a){HTML_CODE.panels.button_open_new_tabs=a}});$.ajax({url:C.panels.header.url,async:true,success:function(a){HTML_CODE.panels.header=a}});$.ajax({url:C.panels.panel_user_data.url,async:true,success:function(a){HTML_CODE.panels.panel_user_data=a}});$.ajax({url:C.panels.panel_group_list.url,async:true,success:function(a){HTML_CODE.panels.panel_group_list=a}});$.ajax({url:C.panels.panel_group_data.url,async:true,success:function(a){HTML_CODE.panels.panel_group_data=a}});$.ajax({url:C.panels.panel_history.url,async:true,success:function(a){HTML_CODE.panels.panel_history=a}});$.ajax({url:C.panels.panel_statistics.url,async:true,success:function(a){HTML_CODE.panels.panel_statistics=a}});$.ajax({url:C.panels.panel_node_list.url,async:true,success:function(a){HTML_CODE.panels.panel_node_list=a}});$.ajax({url:C.panels.panel_pool_list.url,async:true,success:function(a){HTML_CODE.panels.panel_pool_list=a}});$.ajax({url:C.panels.panel_preset_list.url,async:true,success:function(a){HTML_CODE.panels.panel_preset_list=a}});$.ajax({url:C.panels.panel_contrab_list.url,async:true,success:function(a){HTML_CODE.panels.panel_contrab_list=a}});$.ajax({url:C.panels.panel_plugin_list.url,async:true,success:function(a){HTML_CODE.panels.panel_plugin_list=a}});$.ajax({url:C.panels.panel_pool_details.url,async:true,success:function(a){HTML_CODE.panels.panel_pool_details=a}});Ext.namespace("App");App.Tabs=function(a){Ext.apply(this,a);this.a_tabs=[];this.tab_active=null;App.Tabs.cont_tab=0;this.__defineGetter__("widthOfList",this._widthOfList);this.__defineGetter__("widthOfHidden",this._widthOfHidden);this.__defineGetter__("leftPosition",this._leftPos);this.$init()};App.Tabs.prototype._widthOfList=function(){var a=0;$("."+this.listClass+" li").each(function(){var b=$(this).outerWidth();a+=b});return a};App.Tabs.prototype._widthOfHidden=function(){return(($("."+this.wrapperClass).outerWidth())-this.widthOfList-this.leftPosition)-this.scrollBarWidths};App.Tabs.prototype._leftPos=function(){return $("."+this.listClass).position().left};App.Tabs.prototype.reAdjust=function(){if(($("."+this.wrapperClass).outerWidth())<this.widthOfList){$("."+this.scrollerRightClass).show()}else{$("."+this.scrollerRightClass).hide()}if(this.leftPosition<0){$("."+this.scrollerLeftClass).show()}else{$("."+this.listClass).animate({left:"-="+this.leftPosition+"px"},"slow");$("."+this.scrollerLeftClass).hide()}};App.Tabs.prototype.$init=function(){this.reAdjust();var a=this;$(window).on("resize",function(b){a.reAdjust()});$("."+this.scrollerRightClass).click(function(){a.goTo(-150)});$("."+this.scrollerLeftClass).click(function(){a.goTo(150)});$("#"+this.html_id).sortable();this.goToStart()};App.Tabs.prototype.goTo=function(b){var a=this;$("."+this.listClass).animate({left:(b>=0?"+=":"-=")+Math.abs(b)+"px"},"fast",function(){if(a.leftPosition<0){$("."+a.scrollerLeftClass).show()}else{$("."+a.scrollerLeftClass).hide()}if(a.widthOfHidden<0){$("."+a.scrollerRightClass).show()}else{$("."+a.scrollerRightClass).hide()}console.info("left:"+a.leftPosition);console.info("hidden:"+a.widthOfHidden);if(a.widthOfHidden<0&&a.leftPosition<0){$("."+a.scrollerRightClass).show();$("."+a.scrollerLeftClass).show()}})};App.Tabs.prototype.goToEnd=function(){$("."+this.scrollerLeftClass).fadeIn("slow");$("."+this.scrollerRightClass).fadeOut("slow");this.goTo(this.widthOfHidden)};App.Tabs.prototype.goToStart=function(){$("."+this.scrollerRightClass).fadeIn("slow");$("."+this.scrollerLeftClass).fadeOut("slow");this.goTo(-this.leftPosition)};App.Tabs.prototype.getNewIdTab=function(){var a="tab__"+App.Tabs.cont_tab;App.Tabs.cont_tab++;return(a)};App.Tabs.prototype.getTabByType=function(a){return buscar_elemento(this.a_tabs,function(b){return b.define.class_panel==a.class_panel})};App.Tabs.prototype.close_tab=function(d){if(this.a_tabs[d].tab_id==this.tab_active.getTabId()){var a=Object.keys(this.a_tabs);if(a[a.length-1]==d){if(a.length!=1){this.setActiveTabId(a[a.length-2])}}else{var e=buscar_elemento(a,function(f){return f==d});var c=parseInt(e)+1;var b=a[c];this.setActiveTabId(b)}}this.a_tabs[d].close();$("#"+d).remove();delete this.a_tabs[d];this.reAdjust()};App.Tabs.prototype.create_tab=function(d){if(!d||d.length==0){return}var b=this;if(!d.replicate&&this.getTabByType(d)!=false){this.setActiveTabId(this.getTabByType(d))}else{var c=this.getNewIdTab();Ext.ns("App.panels."+d);console.log(d.class_panel);App.panels[d].class_panel=this.a_tabs[c]=new window[d.class_panel](c);this.setActive(this.a_tabs[c]);if(d.replicate){var e=HTML_CODE.li_tab_editable}else{var e=HTML_CODE.li_tab_no_editable}$("#tabs").append(replaceAll(e,{$ID_TAB$:c,$NAME_TAB$:d.text_default}));$("#go_"+c).click(function(f){f.preventDefault();b.setActiveTabId(c)});var a=$("#go_"+c).text();$("#edit_"+c).click(function(g){g.preventDefault();var f=$("#go_"+c).text();$("#go_"+c).hide();$("#text_editing_"+c).show();$("#text_editing_"+c).val(f)});$("#text_editing_"+c).blur(function(g){log4javascript.getRootLogger().info("blur PROCESTAB "+c);var f=$("#text_editing_"+c).val();$("#go_"+c).text(f);$("#go_"+c).show();$("#text_editing_"+c).hide()});$("#close_"+c).click(function(f){f.preventDefault();b.close_tab(c)})}this.reAdjust()};App.Tabs.prototype.setActiveTabId=function(b){for(var a in this.a_tabs){if(this.a_tabs[a].getTabId()==b){this.setActive(this.a_tabs[a]);return true}}};App.Tabs.prototype.setActive=function(c){this.tab_active=c;if(this.tab_active.define.class_panel==C.panels.panel_monitor.class_panel&&this.loaded){this.tab_active.update()}var a=false;for(var b in this.a_tabs){if(this.a_tabs[b].getTabId()!=this.tab_active.getTabId()){$("#"+this.a_tabs[b].getTabId()).removeClass("active");$("#"+this.a_tabs[b].getTabId()).addClass("desactive");this.a_tabs[b].hide()}else{$("#"+this.a_tabs[b].getTabId()).removeClass("desactive");$("#"+this.a_tabs[b].getTabId()).addClass("active");this.a_tabs[b].show();if(typeof this.a_tabs[b].update=="function"){this.a_tabs[b].update()}}}};Ext.ns("App.Model");App.Model.Abstract=Ext.extend(App.AbstractClass,{constructor:function(a){App.Model.Abstract.superclass.constructor.apply(this,arguments);if(this.$fields==null){throw Error("This is an abstract class. Do not direct instance.")}this.addEvents("updated","inserted","removed");Ext.apply(this,a)},toRowModelArray:function(){var a=this;if(!$.isArray(this.$fields)){throw Error("$fields array should be overridden in child class")}return this.$fields.map(function(b){return $.isFunction(a[b])?a[b].call(this):a[b]})},toOptionElement:function(){var a=document.createElement("option");a.text=this.name;a.value=this.id;a.setAttribute("id",this.id);a.setAttribute("name",this.id);if(this.enabled===0){a.setAttribute("disabled",true)}return a},toLookupList:function(c,e,b){var g="",f=this;if(!Array.isArray(c)){return"[NOT SET]"}if(c.length==0){return"[NONE]"}var h=$.isNumeric(c[0])?c.toModelArray(e,b):c;if(firstItem=h.shift()){g=firstItem.name}else{g="[HIDDEN]"}var a=h.map(function(j){return j.name||"[HIDDEN]"});var d=new Ext.Template(App.Widget.getTemplate("table_popup_list"));d.compile();if(c.length>1){g+="&nbsp;&nbsp;"+d.apply({content:a.join(",\r\n")})}return g},hasPermission:function(a){if(!this.permissions){return true}return(this.permissions&(1<<a))!==0},toString:function(){return this.id},destroy:function(){console.info("[App.Model] Model id:"+this.id+" destroyed");delete this}});App.Model.isModel=function(a){return typeof a=="object"&&a.isExtendedFrom(App.Model.Abstract)};App.Model.APISet={$fields:["id","name"],constructor:function APISet(a){this.id=a.value;this.name=a.key;App.Model.APISet.superclass.constructor.apply(this,arguments)}};App.Model.APISet=Ext.extend(App.Model.Abstract,App.Model.APISet);Ext.ns("App.Model");App.Model.User={$fields:[],constructor:function(a){App.Model.User.superclass.constructor.apply(this,arguments);Ext.apply(this,a);if(this.id==0){this.groups=App.API.Groups.getGroups()}},getRole:function(){return croupier.UserRole.__names__[this.role]},getDataLink:function(a){return'<a href="#" data-userid='+this.id+">"+a+"</a>"},toRowModelArray:function(){return["",this.alias,this.getDataLink(this.name),this.surname,this.email,this.getRole(),$.isArray(this.groups)?this.groups.length:"[UNKNOWN]"]},getGroups:function(){return this.id==0?this.groups:App.API.Groups.getGroupsByUser(this)},isSuperAdministrator:function(){return this.role===croupier.UserRole.SUPERADMINISTRATOR},remove:function(){var a=this;croupier.api.user$remove([this.id],function(){a.fireEvent("removed",this)})}};App.Model.User=Ext.extend(App.Model.Abstract,App.Model.User);Ext.ns("App.Model");App.Model.Group={$fields:[],constructor:function(a){App.Model.Group.superclass.constructor.apply(this,arguments);Ext.apply(this,a)},getDataLink:function(){return'<a href="#" data-groupid='+this.id+">"+this.name+"</a>"},toRowModelArray:function(a){if(a!=="permission"){return["",this.getDataLink(),Array.isArray(this.users)?this.users.length:"[UNKNOWN]",Array.isArray(this.plugins)?this.plugins.length:"[UNKNOWN]",$.isFunction(this.pools.size)?this.pools.size():"[UNKNOWN]"]}else{return["",this.name,Array.isArray(this.users)?this.users.length:"[UNKNOWN]"]}},hasPoolPermission:function(b,a){return;App.Model.Abstract.prototype.hasPermissions.call(this.pools.get(b),a)},hasPlugin:function(a){return this.plugins.some(function(b){return b=="*"||a==b},this)},getPluginConfigs:function(){if(this.plugins.contains("*")){var a=App.API.Plugins.getPlugins(),b=[];a.forEach(function(c){$.merge(b,c.getConfigurations())});return b}return this.plugins.map(function(d){var e=d.split(":")[0],c=d.split(":")[1];return new App.Model.PluginConfig({id:c,name:c,plugin:App.API.Plugins.getPlugin(e)})},this)},getUsers:function(){return this.users.map(function(a){return App.Model.isModel(a)?a:App.API.Users.getUser(a)},this)},getPools:function(){pools=this.pools.values();if(pools.some(function(a){if(a.pool==0){this.poolAllPerm=a.permission;return true}else{return false}},this)){return App.API.Pools.getPools().map(function(a){a.groupPermission=this.poolAllPerm;return a},this)}return pools.map(function(b){var a=App.API.Pools.getPool(b.pool);a.groupPermission=b.permission;return a},this)},getGroups:function(){groups=this.groups.values();if(groups.some(function(a){if(a.other==0){this.groupAllPerm=a.modify;return true}else{return false}},this)){return App.API.Groups.getGroups().map(function(a){a.groupCanModify=this.groupAllPerm;return a},this)}return this.groups.values().map(function(a){var b=App.API.Groups.getGroup(a.other);b.groupCanModify=a.modify;return b},this)},canModifyGroup:function(a){return;this.groups.get(a).modify=="1"},setUsers:function(a){this.$users=a.toIds();this.users=a},setPools:function(a){this.$pools=a.map(function(b){return{pool:b.id,permission:b.groupPermission}});if(this.pools&&$.isFunction(this.pools.setAll)){this.pools.setAll(this.$pools)}},setGroups:function(a){this.$groups=a.map(function(b){return{other:b.id,modify:b.groupCanModify?"1":"0"}});if(this.groups&&$.isFunction(this.groups.setAll)){this.groups.setAll(this.$groups)}},setPlugins:function(a){this.$plugins=a.toIds();this.plugins=a},update:function(){var a=this;App.API.Groups.api.userGroup$set(this.id,this.name,this.description,this.$users,this.$plugins,this.$pools,this.$groups,function(b){if(b.status==croupier.ResponseStatus.SUCCESS){a.fireEvent("updated",this)}})},insert:function(){var a=this;App.API.Groups.api.userGroup$add(this.name,this.description,this.$users,this.$plugins,this.$pools,this.$groups,this.permission,function(b){if(b.status==croupier.ResponseStatus.SUCCESS){a.fireEvent("inserted",this)}})}};App.Model.Group=Ext.extend(App.Model.Abstract,App.Model.Group);Ext.ns("App.Model");App.Model.Job={$fields:[],toolbarTpl:'<href="#" title="Remove job" class="color-red"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>							<a href="#" title="Pause job"><span class="glyphicon glyphicon-pause" aria-hidden="true"></span></a><a href="#" title="Start job" class="color-green"><span class="glyphicon glyphicon-play" aria-hidden="true"></span></a>',constructor:function(a){App.Model.Job.superclass.constructor.apply(this,arguments);this.$private("_id",this._getId,this._setId);this.addEvents("log","properties");this.id=a.id;this.name=a.name;this.plugin=a.hasOwnProperty("plugin")?a.plugin:"";this.priority=a.hasOwnProperty("priority")?a.priority:0;this.status=a.status||croupier.JobStatus.DISABLED;this.progress=a.progress||0;this.time=a.time||0;this.errors=a.errors||0;this.warnings=a.warnings||0;this.registered=a.registered;this.$private("primaryNodes",this._getPrimaryNodes,this._setPrimaryNodes);this.$private("primaryPools",this._getPrimaryPools,this._setPrimaryPools);this.$private("secondaryNodes",this._getSecondaryNodes,this._setSecondaryNodes);this.$private("secondaryPools",this._getSecondaryPools,this._setSecondaryPools);this.primaryNodes=a.primaryNodes;this.secondaryNodes=a.secondaryNodes;this.primaryPools=a.primaryPools;this.secondaryPools=a.secondaryPools;if($.isNumeric(this.node)){this.node=croupier.data.nodes.get(this.node)}},getNode:function(){return this.node},setNode:function(a){console.log("[setNode]"+a);this.node=$.isNumeric(a)?App.API.Nodes.getNode(a):a},_getId:function(){return this.isChildJob()?this.parent.id+"."+this.part:this.id},_setId:function(a){this.$id=a},isChildJob:function(){return $.isPlainObject(this.parent)},getPriority:function(){switch(this.priority){case CONSTANT.PRIORITY.A_DEFINED.ULTRA_HIGH:return"ULTRA_HIGH ("+this.priority+")";break;case CONSTANT.PRIORITY.A_DEFINED.HIGH:return"HIGH ("+this.priority+")";break;case CONSTANT.PRIORITY.A_DEFINED.NORMAL:return"NORMAL ("+this.priority+")";break;case CONSTANT.PRIORITY.A_DEFINED.LOW:return"LOW ("+this.priority+")";break;case CONSTANT.PRIORITY.A_DEFINED.ULTRA_LOW:return"ULTRA_LOW ("+this.priority+")";break;default:return this.priority}},getNodeById:function(a){return App.API.Nodes.getNode(a)},_getPrimaryNodes:function(){return $.isArray(this.$primaryNodes)&&this.$primaryNodes.length>0?this.toLookupList(this.$primaryNodes,"nodes",App.Model.Node):""},_setPrimaryNodes:function(a){this.$primaryNodes=$.isArray(a)?a:null},_getSecondaryNodes:function(){return $.isArray(this.$secondaryNodes)&&this.$secondaryNodes.length>0?this.toLookupList(this.$secondaryNodes,"nodes",App.Model.Node):""},_setSecondaryNodes:function(a){this.$secondaryNodes=$.isArray(a)?a:null},_getPrimaryPools:function(){return Array.isArray(this.$primaryPools)&&this.$primaryPools.length>0?this.toLookupList(this.$primaryPools,"pools",App.Model.Pool):""},_setPrimaryPools:function(a){this.$primaryPools=$.isArray(a)&&a.length>0?a:""},_getSecondaryPools:function(){return Array.isArray(this.$secondaryPools)&&this.$secondaryPools.length>0?this.toLookupList(this.$secondaryPools,"pools",App.Model.Pool):""},_setSecondaryPools:function(a){this.$secondaryPools=$.isArray(a)?a:null},getJobs:function(){if(!Array.isArray(this.children)||this.children.length==0){return null}return this.children.map(function(a){a.id=this.id;a.plugin=this.plugin;return a},this)},getProgress:function(){function a(c){var b=new Ext.Template(c==100?HTML_CODE.Progres_bar_executed:HTML_CODE.Progres_bar);return b.compile().apply({WIDTH:c,PERCENT:c})}switch(this.status){case croupier.JobStatus.EXECUTED:return a(100);break;case croupier.JobStatus.RETRY:case croupier.JobStatus.DISABLED:case croupier.JobStatus.TIMEOUT:case croupier.JobStatus.ENABLED:case croupier.JobStatus.ERROR:case croupier.JobStatus.EXECUTING:case croupier.JobStatus.PAUSED:return a(this.progress==null?0:this.progress);break}return this.progress+"%"},setPrimaryPools:function(b){var a=this;croupier.api.job$set(this.id,this.name,this.description,this.priority,this.retries,this.timeout,this.os,this.$primaryNodes,this.$secondaryNodes,b,this.$secondaryPools,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){a.fireEvent("updated",this)}})},setSecondaryPools:function(b){var a=this;croupier.api.job$set(this.id,this.name,this.description,this.priority,this.retries,this.timeout,this.os,this.$primaryNodes,this.$secondaryNodes,this.$primaryPools,b,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){a.fireEvent("updated",this)}})},setPrimaryNodes:function(a){var b=this;croupier.api.job$set(this.id,this.name,this.description,this.priority,this.retries,this.timeout,this.os,a,this.$secondaryNodes,this.$primaryPools,this.$secondaryPools,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){b.fireEvent("updated",this)}})},setSecondaryNodes:function(a){var b=this;croupier.api.job$set(this.id,this.name,this.description,this.priority,this.retries,this.timeout,this.os,this.$primaryNodes,a,this.$primaryPools,this.$secondaryPools,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){b.fireEvent("updated",this)}})},toRowModelArray:function(){return !this.isChildJob()?["","",this._id,this.name,this.plugin,this.getProgress(),croupier.JobStatus.__names__[this.status],this.start||"",this.finish||"",this.getPriority(),this.errors||0,this.warnings||0,this.primaryPools,this.secondaryPools,this.primaryNodes,this.secondaryNodes,this.getToolbar()]:["","",this.name,this.plugin,this.getProgress(),croupier.JobStatus.__names__[this.status],this.getPriority(),this.errors||0,this.warnings||0,this.getToolbar(),""]},requestProperties:function(){var a=this;croupier.api.job$getProperties(this.id,function(b){if(b.status==croupier.ResponseStatus.SUCCESS){a.fireEvent("properties",b.value)}})},getStatusClass:function(){switch(this.status){case croupier.JobStatus.ENABLED:return HTML_CODE.tr_pending;break;case croupier.JobStatus.DISABLED:return HTML_CODE.tr_disabled;break;case croupier.JobStatus.EXECUTED:return HTML_CODE.tr_finished;break;case croupier.JobStatus.PAUSED:return HTML_CODE.tr_paused;break;case croupier.JobStatus.EXECUTING:return"in-progress";break;case croupier.JobStatus.ERROR:case croupier.JobStatus.RETRY:case croupier.JobStatus.TIMEOUT:return"with-error";default:return false}},getOs:function(){switch(this.os){case"Linux":return"<span class='ico-os ico-os-linux'>Linux</span>&nbsp&nbsp Linux";break;case"Windows":return"<span class='ico-os ico-os-windows'>Windows</span>&nbsp&nbsp Windows";break;case"Mac":return"<span class='ico-os ico-os-mac'>MacOS</span>&nbsp&nbsp SunOS";break;default:return this.os}},getToolbar:function(){if(!this.isChildJob()&&this.children&&this.children.length>0){if(nodeJob=this.children.find(function(a){return $.isPlainObject(a.node)},this)){return nodeJob.name}else{return"[NOT SET]"}}return $.isPlainObject(this.node)?this.node.name:"[NOT SET]"},requestLog:function(){var a=this;croupier.api.job$getLog(this.id,this.part||0,function(b){if(b.status==croupier.ResponseStatus.SUCCESS){a.fireEvent("log",b.value)}})}};App.Model.Job=Ext.extend(App.Model.Abstract,App.Model.Job);Ext.ns("App.Model");App.Model.Pool={$fields:[],constructor:function Pool(a){App.Model.Pool.superclass.constructor.apply(this,arguments);this.addEvents("nodesupdated");if(!this.description){this.description=""}},toRowModelArray:function(){return["","",this.getDataLink(this.name),this.description,Array.isArray(this.nodes)?this.nodes.length:"[NO DATA]"]},getNodes:function(){return this.nodes.toModelArray("nodes",App.Model.Node)},canUseAsPrimary:function(){return this.hasPermission(croupier.PoolPermission.usePrimary)},canUseAsSecondary:function(){return this.hasPermission(croupier.PoolPermission.useSecondary)},getDataLink:function(){if(this.hasPermission(croupier.PoolPermission.set)||this.hasPermission(croupier.PoolPermission.moveNodes)){return'<a href="#" data-poolid='+this.id+">"+this.name+"</a>"}else{return this.name}},update:function(){var b=this;var a=(this.nodes.length>0&&App.Model.isModel(this.nodes[0]))?this.nodes.toIds():this.nodes;croupier.api.pool$set(this.id,this.name,this.description,this.enabled,a,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){b.fireEvent("updated",this)}},this)},setNodes:function(a){var b=this;if(a.length>0&&App.Model.isModel(a[0])){a=a.toIds()}croupier.api.pool$setNodes(this.id,a,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){b.fireEvent("nodesupdated",a)}},this)},addNodes:function(a){var b=this;if(a.length>0&&App.Model.isModel(a[0])){a=a.toIds()}croupier.api.pool$addNodes(this.id,a,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){b.fireEvent("nodesupdated",a)}},this)},canModify:function(){return App.Users.getCurrentUser().getGroups().some(function(a){return a.hasPoolPermission(this.id,croupier.UserGroupPoolPermission.MODIFY)},this)},insert:function(){var a=this;var b=this.nodes&&Array.isArray(this.nodes)&&this.nodes.length>0&&App.Model.isModel(this.nodes[0])?this.nodes.toIds():this.nodes;croupier.api.pool$add(this.name,this.description,this.enabled,b,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){a.fireEvent("inserted",a)}})}};App.Model.Pool=Ext.extend(App.Model.Abstract,App.Model.Pool);Ext.ns("App.Model");App.Model.Node={$fields:["os","ip","name","status","progress"],constructor:function(a){App.Model.Node.superclass.constructor.apply(this,arguments);this.id=a.id;this.name=a.name;if(a.hasOwnProperty("basicSystemInfo")){Ext.apply(this,this.basicSystemInfo);this.os=a.basicSystemInfo.os&&a.basicSystemInfo.os.name?croupier.OsName.__names__[a.basicSystemInfo.os.name]:" --- ";this.ip=a.basicSystemInfo.net?a.basicSystemInfo.net.ip:" - ";this.bits=a.basicSystemInfo.os&&a.basicSystemInfo.os.bits?a.basicSystemInfo.os.bits:"";if(this.memory){this.ram=Math.round(this.memory.ram/(1024*1024))+" MB"}}else{this.ip=this.os="[NOT SET]";this.bits=""}if(this.enabled==1){this.enabled=true}this.status=a.status;this.progress=a.progress;this.registered=a.registered;this.$private("jobs",this._getJobs,this._setJobs);this.$private("pools",this._getPools,this._setPools);this.addEvents("log.loaded","moved");this._setJobs(a.jobs);this._setPools(a.pools)},setStatus:function(a){},setEnabledJobPlugins:function(a){this.enabledPlugins=a.toIds()},getExtraInfo:function(){},_getJobs:function(){return this.$jobs?this.$jobs:"[HIDDEN]"},_setJobs:function(a){this.$jobs=$.isArray(a)?a.toModelArray("jobs",App.Model.Job):null},_getPools:function(){return this.$pools?this.$pools:"[HIDDEN]"},_setPools:function(a){this.$pools=$.isArray(a)?a:null},getPoolsList:function(){return this.toLookupList(this.$pools,"pools",App.Model.Pool)},getProgress:function(){function a(c){var b=new Ext.Template(c==100?HTML_CODE.Progres_bar_executed:HTML_CODE.Progres_bar);b.compile();return b.apply({WIDTH:c,PERCENT:c})}switch(this.status){case croupier.NodeStatus.LOGGED:case croupier.NodeStatus.UPDATING:case croupier.NodeStatus.VALIDATING:case croupier.NodeStatus.TESTING:case croupier.NodeStatus.WAITING:return a(0);break;case croupier.NodeStatus.DISCONNECTED:return"";break;case croupier.NodeStatus.READY:return"";break;case croupier.NodeStatus.EXECUTING:case croupier.NodeStatus.PAUSED:return a(this.progress);break}return this.progress+"%"},getOsIcon:function(){switch(this.os){case"Linux":return"<span class='ico-os ico-os-linux'>Linux</span>";break;case"Windows":return"<span class='ico-os ico-os-windows'>Windows</span>";break;case"Mac":return"<span class='ico-os ico-os-mac'>MacOS</span>";break;default:return""}},getOs:function(){switch(this.os){case"Linux":return"<span class='ico-os ico-os-linux'>Linux</span>&nbsp&nbsp Linux";break;case"Windows":return"<span class='ico-os ico-os-windows'>Windows</span>&nbsp&nbsp Windows";break;case"Mac":return"<span class='ico-os ico-os-mac'>MacOS</span>&nbsp&nbsp SunOS";break;default:return this.os}},getDataLink:function(){return'<a href="#" data-node-id='+this.id+">"+this.name+"</a>"},toRowModelArray:function(a){jobs=this.jobs.length>0&&(job=App.API.Jobs.getJob(this.jobs[0].id))!=null?job.name:"";if(!a){return["","",this.getOs(),this.ip,this.getDataLink(),this.getStatusName(),Array.isArray(this.jobs)?jobs:this.jobs,this.getProgress(),this.registered,this.getPoolsList(),this.getCPUInfo(),this.getMemoryInfo()]}else{if(a=="full"){return["","",this.getDataLink(),this.getStatusName(),this.fullOs(),this.ip,Array.isArray(this.jobPlugins)?this.toLookupList(this.jobPlugins.map(function(b){b.name=b.enabled=="1"?b.plugin:b.plugin+" (disabled)\r\n";return b})):"[NOT SET]"]}}},fullOs:function(){return this.getOs()+" "+this.bits},requestLog:function(){var a=this;croupier.api.node$getLog(this.id,function(b){if(b.status==croupier.ResponseStatus.SUCCESS){a.fireEvent("log.loaded",b.value)}})},getCPUInfo:function(){if(!this.basicRuntimeInfo){return"[NO INFO]"}var b=Math.round(this.basicRuntimeInfo.cpu.used*100);if(b<20){var a=new Ext.Template(HTML_CODE.Progres_bar_executed)}else{if(b>=20&&b<=50){var a=new Ext.Template(HTML_CODE.Progres_bar)}else{if(b>50&&b<=80){var a=new Ext.Template(HTML_CODE.Progres_bar_warning)}else{var a=new Ext.Template(HTML_CODE.Progres_bar_danger)}}}return a.compile().apply({WIDTH:b,PERCENT:b})},getMemoryInfo:function(){if(!this.basicRuntimeInfo){return"[NO INFO]"}var e=Math.round(this.basicRuntimeInfo.memory.used*100/this.basicRuntimeInfo.memory.total),a=Math.round(this.basicRuntimeInfo.memory.total/(1024*1024))+" MB ",d=Math.round(this.basicRuntimeInfo.memory.used/(1024*1024))+" MB "+e;if(e<20){var b=new Ext.Template(HTML_CODE.Progres_bar_executed)}else{if(e>=20&&e<=50){var b=new Ext.Template(HTML_CODE.Progres_bar)}else{if(e>50&&e<=80){var b=new Ext.Template(HTML_CODE.Progres_bar_warning)}else{var b=new Ext.Template(HTML_CODE.Progres_bar_danger)}}}var c=b.compile().apply({WIDTH:e,PERCENT:d});return c},getStatusName:function(){return croupier.NodeStatus.__names__[this.status]?croupier.NodeStatus.__names__[this.status]:"UNKNOWN"},getStatusClass:function(){switch(this.status){case croupier.NodeStatus.LOGGED:case croupier.NodeStatus.UPDATING:case croupier.NodeStatus.VALIDATING:case croupier.NodeStatus.TESTING:case croupier.NodeStatus.WAITING:return HTML_CODE.tr_pending;break;case croupier.NodeStatus.DISCONNECTED:return HTML_CODE.tr_disabled;break;case croupier.NodeStatus.READY:return HTML_CODE.tr_finished;break;case croupier.NodeStatus.PAUSED:return HTML_CODE.tr_paused;break;case croupier.NodeStatus.EXECUTING:return"in-progress";break;default:return false}},canUseAsPrimary:function(){return this.hasPermission(croupier.NodePermission.usePrimary)},canUseAsSecondary:function(){return this.hasPermission(croupier.NodePermission.useSecondary)},moveToPool:function(a){var b=this;if(App.Model.isModel(a)){throw new Error("[Node::moveToPool()]: Pool provided is not a valid pool model.")}croupier.api.pool$moveNodes(this.$pools.length>0?this.$pools[0].id:0,a.id,[this.id],function(c){if(c.status==croupier.ResponseStatus.SUCCESS){b.fireEvent("moved",a)}})},getPowerClass:function(){return this.on=="1"?"poweron":"poweroff"},update:function(){var a=this;croupier.api.node$set(this.id,this.permanent||0,this.plugin||null,this.properties||{},this.enabled||false,this.enabledPlugins||[],function(b){if(b.status==croupier.ResponseStatus.SUCCESS){a.fireEvent("updated")}})}};App.Model.Node=Ext.extend(App.Model.Abstract,App.Model.Node);App.Model.Plugin={$fields:["id","name"],constructor:function Plugin(a){App.Model.Plugin.superclass.constructor.apply(this,arguments);this.description=this.description||""},getIcon:function(a){return $("<img>").attr("src","data:image/png;base64,"+this.icon).attr("height",a+"px").get(0).outerHTML},toRowModelArray:function(){return["",this.getIcon(40),this.name,this.description,(this.vendor&&this.vendor.name)||"[NOT SET]",this.configurations.length]},getConfigurations:function(){return this.configurations.map(function(a){return new App.Model.PluginConfig({id:a,name:a,enabled:1,plugin:this})},this)},loadData:function(){}};App.Model.Plugin=Ext.extend(App.Model.Abstract,App.Model.Plugin);Ext.ns("App.Model");App.Model.PluginConfig={$fields:["id","name"],constructor:function PluginConfig(a){App.Model.PluginConfig.superclass.constructor.apply(this,arguments);this.id=this.plugin.id+":"+this.id},toRowModelArray:function(a){if(!a){return["",this.name,this.getEnabledBox(),this.plugin]}else{if(a=="node"){return["",this.name,this.test,this.plugin]}}},getEnabledBox:function(){var a=$("<input>").attr("type","checkbox").attr("disabled","disabled");if(this.enabled=="1"){a.attr("checked","checked")}return a.get(0).outerHTML}};App.Model.PluginConfig=Ext.extend(App.Model.Abstract,App.Model.PluginConfig);Ext.ns("App.API");App.API.Jobs={getJobs:function(){return this.data.jobs.values(true).map(function(a){return this.getJob(a.id)},this)},getJob:function(a){if(!a||((job=this.data.jobs.get(a))===null)){throw new Error("[Jobs]: No Job with id:"+a)}return new App.Model.Job(job)},addJob:function(c,b,a){croupier.api.job$add(c.name,c.description,c.plugin,c.properties,c.priority,c.retries,c.timeout,c.userGroup,c.enabled,c.os,c.$primaryNodes||null,c.$secondaryNodes||null,c.$primaryPools||null,c.$secondaryPools||null,c.postJobs||null,function(){return b.apply(a,arguments)})},setPriority:function(a,b){this.api.job$setPriority(a.toIds(),b,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){if(App.mainBox){App.mainBox.progress(100);App.mainBox.done()}}})},pauseJobs:function(a,b){this.api.job$pause(a.toIds(),b,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){if(App.mainBox){App.mainBox.progress(100);App.mainBox.done()}}})},enableJobs:function(a,b){this.api.job$setEnabled(a.toIds(),b,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){if(App.mainBox){App.mainBox.progress(100);App.mainBox.done()}}})},removeJobs:function(a,b){this.api.job$remove(a.toIds(),b,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){if(App.mainBox){App.mainBox.progress(100);App.mainBox.done()}}})}};App.API.Jobs=$.extend(croupier,App.API.Jobs);function getConfigurationProperties(e,b){var f;var d;var a=$.grep(e.configurations,function(g){return g.name==b});if(a.length!==1){}else{f=a[0]}var a=$.grep(e.properties,function(g){return g.id==f.properties});if(a.length!==1){}else{d=a[0].properties}for(var c in f.overwrite){if(!d){continue}if(d.hasOwnProperty(c)){propierties[c]=e.configurations[pos].overwrite[c]}}return(d)}function getTypeProperty(a){var b=a.split("-");if(b[1]==="s"){return"string"}else{if(b[1]=="path"){return"path"}else{if(b[1]=="path[]"){return"multipath"}else{if(b[1]=="eoh"){return"exec_output_handler"}}}}return"TypeProperty not procesable"}function add_job(b,d,a,e,c){croupier.api.job$add(b,d,a,e,c,0,0,$("#jobAddGroup select").val(),true,$("#jobAddRadioNode").val()=="on"?$("#jobAddPrimaryNode select").val():null,$("#jobAddRadioNode").val()=="on"?$("#jobAddSecondaryNode select").val():null,$("#jobAddRadioPool").val()=="on"?$("#jobAddPrimaryPool select").val():null,$("#jobAddRadioPool").val()=="on"?$("#jobAddSecondaryPool select").val():null,null,null)}Ext.ns("App.API");App.API.Nodes={getNodes:function(){return this.data.nodes.values(true).map(function(a){return this.getNode(a.id)},this)},getNode:function(a){if((node=this.data.nodes.get(a))===null){throw new Error("[App.API.Nodes::get()]: No Node with ID:"+a)}return new App.Model.Node(node)},removeNodes:function(a,c,b){this.api.node$remove(a.toIds(),function(d){if(d.status==croupier.ResponseStatus.SUCCESS){c.call(b||this)}})},pauseNodes:function(a,d,c,b){this.api.node$pause(a.toIds(),d,function(e){if(e.status==croupier.ResponseStatus.SUCCESS){c.call(b||this)}})},resumeNodes:function(a,c,b){this.api.node$resume(a.toIds(),function(d){if(d.status==croupier.ResponseStatus.SUCCESS){c.call(b||this)}})},enableNodes:function(a,b){this.api.node$setEnabled(a.toIds(),b,function(c){if(c.status==croupier.ResponseStatus.SUCCESS){if(App.mainBox){App.mainBox.progress(100);App.mainBox.done()}}})}};App.API.Nodes=$.extend(croupier,App.API.Nodes);Ext.ns("App.API");App.API.Groups={getGroups:function(){return this.data.userGroups.values(true)},getGroupsByUser:function(a){a=Number.isInteger(a)?this.Users.getUser(a):a;return a.groups.map(function(b){return this.getGroup(b)},this)},getGroup:function(a){if((group=this.data.userGroups.get(a))==null){if(App.config.debug){App.errorMsg("App.API.Groups::get()","No id found: "+a)}else{throw new Error("[App.API.Groups::get()]: No Group with ID:"+a)}return false}return new App.Model.Group(group)},removeGroups:function(a,c,b){this.api.userGroup$remove(a.toIds(),function(d){if(d.status==croupier.ResponseStatus.SUCCESS){c.call(b||this)}else{App.mainBox.abort()}})}};App.API.Groups=$.extend(croupier,App.API.Groups);Ext.ns("App.API");App.API.Users={getUsers:function(){return this.data.users.values(true).map(function(a){return this.getUser(a.id)},this)},getUser:function(a){if(a==0){return new App.Model.User(croupier.user)}if((user=this.data.users.get(a))==null){if(App.config.debug){App.errorMsg("App.API.Users::getUser()","No id found: "+a)}else{throw new Error("[App.API.Users::getUser()]: Wrong User ID:"+a)}return false}return new App.Model.User(user)},getCurrentUser:function(){return this.getUser(this.user.id)},removeUsers:function(c,b,a){this.api.user$remove(c.toIds(),function(d){if(d.status==croupier.ResponseStatus.SUCCESS){b.call(a||this)}})}};App.API.Users=$.extend(croupier,App.API.Users);Ext.ns("App.API");App.API.Pools={getPools:function(){return this.data.pools.values(true).map(function(a){return this.getPool(a.id)},this)},getPool:function(a){if((pool=this.data.pools.get(a))==null){if(App.config.debug){App.errorMsg("App.API.Pools::get()","No id found: "+a)}else{throw new Error("[App.API.Pools::get()]: No Pool with ID:"+a)}return false}return new App.Model.Pool(pool)},removePools:function(c,b,a){this.api.pool$remove(c.toIds(),function(d){if(d.status==croupier.ResponseStatus.SUCCESS){b.call(a||this)}})}};App.API.Pools=$.extend(croupier,App.API.Pools);(function(){var f,a,g,d,e,b={}.hasOwnProperty,c=function(l,j){for(var h in j){if(b.call(j,h)){l[h]=j[h]}}function k(){this.constructor=l}k.prototype=j.prototype;l.prototype=new k();l.__super__=j.prototype;return l};d=(function(){function h(){this.options_index=0;this.parsed=[]}h.prototype.add_node=function(j){if(j.nodeName.toUpperCase()==="OPTGROUP"){return this.add_group(j)}else{return this.add_option(j)}};h.prototype.add_group=function(p){var o,l,n,k,m,j;o=this.parsed.length;this.parsed.push({array_index:o,group:true,label:this.escapeExpression(p.label),title:p.title?p.title:void 0,children:0,disabled:p.disabled,classes:p.className});m=p.childNodes;j=[];for(n=0,k=m.length;n<k;n++){l=m[n];j.push(this.add_option(l,o,p.disabled))}return j};h.prototype.add_option=function(k,l,j){if(k.nodeName.toUpperCase()==="OPTION"){if(k.text!==""){if(l!=null){this.parsed[l].children+=1}this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:k.value,text:k.text,html:k.innerHTML,title:k.title?k.title:void 0,selected:k.selected,disabled:j===true?j:k.disabled,group_array_index:l,group_label:l!=null?this.parsed[l].label:null,classes:k.className,style:k.style.cssText})}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true})}return this.options_index+=1}};h.prototype.escapeExpression=function(l){var k,j;if((l==null)||l===false){return""}if(!/[\&\<\>\"\'\`]/.test(l)){return l}k={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};j=/&(?!\w+;)|[\<\>\"\'\`]/g;return l.replace(j,function(m){return k[m]||"&amp;"})};return h})();d.select_to_array=function(h){var n,m,l,j,k;m=new d();k=h.childNodes;for(l=0,j=k.length;l<j;l++){n=k[l];m.add_node(n)}return m.parsed};a=(function(){function h(j,k){this.form_field=j;this.options=k!=null?k:{};if(!h.browser_is_supported()){return}this.is_multiple=this.form_field.multiple;this.set_default_text();this.set_default_values();this.setup();this.set_up_html();this.register_observers();this.on_ready()}h.prototype.set_default_values=function(){var j=this;this.click_test_action=function(k){return j.test_active_click(k)};this.activate_action=function(k){return j.activate_field(k)};this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.allow_single_deselect=(this.options.allow_single_deselect!=null)&&(this.form_field.options[0]!=null)&&this.form_field.options[0].text===""?this.options.allow_single_deselect:false;this.disable_search_threshold=this.options.disable_search_threshold||0;this.disable_search=this.options.disable_search||false;this.enable_split_word_search=this.options.enable_split_word_search!=null?this.options.enable_split_word_search:true;this.group_search=this.options.group_search!=null?this.options.group_search:true;this.search_contains=this.options.search_contains||false;this.single_backstroke_delete=this.options.single_backstroke_delete!=null?this.options.single_backstroke_delete:true;this.max_selected_options=this.options.max_selected_options||Infinity;this.inherit_select_classes=this.options.inherit_select_classes||false;this.display_selected_options=this.options.display_selected_options!=null?this.options.display_selected_options:true;this.display_disabled_options=this.options.display_disabled_options!=null?this.options.display_disabled_options:true;return this.include_group_label_in_selected=this.options.include_group_label_in_selected||false};h.prototype.set_default_text=function(){if(this.form_field.getAttribute("data-placeholder")){this.default_text=this.form_field.getAttribute("data-placeholder")}else{if(this.is_multiple){this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||h.default_multiple_text}else{this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||h.default_single_text}}return this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||h.default_no_result_text};h.prototype.choice_label=function(j){if(this.include_group_label_in_selected&&(j.group_label!=null)){return"<b class='group-name'>"+j.group_label+"</b>"+j.html}else{return j.html}};h.prototype.mouse_enter=function(){return this.mouse_on_container=true};h.prototype.mouse_leave=function(){this.mouse_on_container=false};h.prototype.input_focus=function(j){var k=this;if(this.is_multiple){if(!this.active_field){return setTimeout((function(){return k.container_mousedown()}),50)}}else{if(!this.active_field){return this.activate_field()}}};h.prototype.input_blur=function(j){var k=this;if(!this.mouse_on_container){this.active_field=false;return setTimeout((function(){return k.blur_test()}),100)}};h.prototype.results_option_build=function(k){var l,o,n,j,m;l="";m=this.results_data;for(n=0,j=m.length;n<j;n++){o=m[n];if(o.group){l+=this.result_add_group(o)}else{l+=this.result_add_option(o)}if(k!=null?k.first:void 0){if(o.selected&&this.is_multiple){this.choice_build(o)}else{if(o.selected&&!this.is_multiple){this.single_set_selected_text(this.choice_label(o))}}}}return l};h.prototype.result_add_option=function(l){var k,j;if(!l.search_match){return""}if(!this.include_option_in_results(l)){return""}k=[];if(!l.disabled&&!(l.selected&&this.is_multiple)){k.push("active-result")}if(l.disabled&&!(l.selected&&this.is_multiple)){k.push("disabled-result")}if(l.selected){k.push("result-selected")}if(l.group_array_index!=null){k.push("group-option")}if(l.classes!==""){k.push(l.classes)}j=document.createElement("li");j.className=k.join(" ");j.style.cssText=l.style;j.setAttribute("data-option-array-index",l.array_index);j.innerHTML=l.search_text;if(l.title){j.title=l.title}return this.outerHTML(j)};h.prototype.result_add_group=function(l){var k,j;if(!(l.search_match||l.group_match)){return""}if(!(l.active_options>0)){return""}k=[];k.push("group-result");if(l.classes){k.push(l.classes)}j=document.createElement("li");j.className=k.join(" ");j.innerHTML=l.search_text;if(l.title){j.title=l.title}return this.outerHTML(j)};h.prototype.results_update_field=function(){this.set_default_text();if(!this.is_multiple){this.results_reset_cleanup()}this.result_clear_highlight();this.results_build();if(this.results_showing){return this.winnow_results()}};h.prototype.reset_single_select_options=function(){var j,n,l,m,k;m=this.results_data;k=[];for(n=0,l=m.length;n<l;n++){j=m[n];if(j.selected){k.push(j.selected=false)}else{k.push(void 0)}}return k};h.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide()}else{return this.results_show()}};h.prototype.results_search=function(j){if(this.results_showing){return this.winnow_results()}else{return this.results_show()}};h.prototype.winnow_results=function(){var u,o,r,n,j,t,p,s,k,l,q,m;this.no_results_clear();n=0;t=this.get_search_text();u=t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");k=new RegExp(u,"i");r=this.get_search_regex(u);m=this.results_data;for(l=0,q=m.length;l<q;l++){o=m[l];o.search_match=false;j=null;if(this.include_option_in_results(o)){if(o.group){o.group_match=false;o.active_options=0}if((o.group_array_index!=null)&&this.results_data[o.group_array_index]){j=this.results_data[o.group_array_index];if(j.active_options===0&&j.search_match){n+=1}j.active_options+=1}o.search_text=o.group?o.label:o.html;if(!(o.group&&!this.group_search)){o.search_match=this.search_string_match(o.search_text,r);if(o.search_match&&!o.group){n+=1}if(o.search_match){if(t.length){p=o.search_text.search(k);s=o.search_text.substr(0,p+t.length)+"</em>"+o.search_text.substr(p+t.length);o.search_text=s.substr(0,p)+"<em>"+s.substr(p)}if(j!=null){j.group_match=true}}else{if((o.group_array_index!=null)&&this.results_data[o.group_array_index].search_match){o.search_match=true}}}}}this.result_clear_highlight();if(n<1&&t.length){this.update_results_content("");return this.no_results(t)}else{this.update_results_content(this.results_option_build());return this.winnow_results_set_highlight()}};h.prototype.get_search_regex=function(k){var j;j=this.search_contains?"":"^";return new RegExp(j+k,"i")};h.prototype.search_string_match=function(o,l){var k,n,m,j;if(l.test(o)){return true}else{if(this.enable_split_word_search&&(o.indexOf(" ")>=0||o.indexOf("[")===0)){n=o.replace(/\[|\]/g,"").split(" ");if(n.length){for(m=0,j=n.length;m<j;m++){k=n[m];if(l.test(k)){return true}}}}}};h.prototype.choices_count=function(){var k,m,j,l;if(this.selected_option_count!=null){return this.selected_option_count}this.selected_option_count=0;l=this.form_field.options;for(m=0,j=l.length;m<j;m++){k=l[m];if(k.selected){this.selected_option_count+=1}}return this.selected_option_count};h.prototype.choices_click=function(j){j.preventDefault();if(!(this.results_showing||this.is_disabled)){return this.results_show()}};h.prototype.keyup_checker=function(j){var l,k;l=(k=j.which)!=null?k:j.keyCode;this.search_field_scale();switch(l){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0){return this.keydown_backstroke()}else{if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}}break;case 13:j.preventDefault();if(this.results_showing){return this.result_select(j)}break;case 27:if(this.results_showing){this.results_hide()}return true;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};h.prototype.clipboard_event_checker=function(j){var k=this;return setTimeout((function(){return k.results_search()}),50)};h.prototype.container_width=function(){if(this.options.width!=null){return this.options.width}else{return""+this.form_field.offsetWidth+"px"}};h.prototype.include_option_in_results=function(j){if(this.is_multiple&&(!this.display_selected_options&&j.selected)){return false}if(!this.display_disabled_options&&j.disabled){return false}if(j.empty){return false}return true};h.prototype.search_results_touchstart=function(j){this.touch_started=true;return this.search_results_mouseover(j)};h.prototype.search_results_touchmove=function(j){this.touch_started=false;return this.search_results_mouseout(j)};h.prototype.search_results_touchend=function(j){if(this.touch_started){return this.search_results_mouseup(j)}};h.prototype.outerHTML=function(k){var j;if(k.outerHTML){return k.outerHTML}j=document.createElement("div");j.appendChild(k);return j.innerHTML};h.browser_is_supported=function(){if(window.navigator.appName==="Microsoft Internet Explorer"){return document.documentMode>=8}if(/iP(od|hone)/i.test(window.navigator.userAgent)){return false}if(/Android/i.test(window.navigator.userAgent)){if(/Mobile/i.test(window.navigator.userAgent)){return false}}return true};h.default_multiple_text="Select Some Options";h.default_single_text="Select an Option";h.default_no_result_text="No results match";return h})();f=jQuery;f.fn.extend({editableChosen:function(h){if(!a.browser_is_supported()){return this}return this.each(function(k){var l,j;l=f(this);j=l.data("chosen");if(h==="destroy"&&j instanceof g){j.destroy()}else{if(!(j instanceof g)){l.data("chosen",new g(this,h))}}})}});g=(function(h){c(j,h);function j(){e=j.__super__.constructor.apply(this,arguments);return e}j.prototype.setup=function(){this.form_field_jq=f(this.form_field);this.current_selectedIndex=this.form_field.selectedIndex;return this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")};j.prototype.set_up_html=function(){var k,l;k=["chosen-container"];k.push("chosen-container-"+(this.is_multiple?"multi":"single"));if(this.inherit_select_classes&&this.form_field.className){k.push(this.form_field.className)}if(this.is_rtl){k.push("chosen-rtl")}l={"class":k.join(" "),style:"width: "+(this.container_width())+";",title:this.form_field.title};if(this.form_field.id.length){l.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"}this.container=f("<div />",l);if(this.is_multiple){this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>')}else{this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>')}this.form_field_jq.hide().after(this.container);this.dropdown=this.container.find("div.chosen-drop").first();this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chosen-results").first();this.search_field_scale();this.search_no_results=this.container.find("li.no-results").first();if(this.is_multiple){this.search_choices=this.container.find("ul.chosen-choices").first();this.search_container=this.container.find("li.search-field").first()}else{this.search_container=this.container.find("div.chosen-search").first();this.selected_item=this.container.find(".chosen-single").first()}this.results_build();this.set_tab_index();return this.set_label_behavior()};j.prototype.on_ready=function(){return this.form_field_jq.trigger("chosen:ready",{chosen:this})};j.prototype.register_observers=function(){var k=this;this.container.bind("touchstart.chosen",function(l){k.container_mousedown(l);return l.preventDefault()});this.container.bind("touchend.chosen",function(l){k.container_mouseup(l);return l.preventDefault()});this.container.bind("mousedown.chosen",function(l){k.container_mousedown(l)});this.container.bind("mouseup.chosen",function(l){k.container_mouseup(l)});this.container.bind("mouseenter.chosen",function(l){k.mouse_enter(l)});this.container.bind("mouseleave.chosen",function(l){k.mouse_leave(l)});this.search_results.bind("mouseup.chosen",function(l){k.search_results_mouseup(l)});this.search_results.bind("mouseover.chosen",function(l){k.search_results_mouseover(l)});this.search_results.bind("mouseout.chosen",function(l){k.search_results_mouseout(l)});this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(l){k.search_results_mousewheel(l)});this.search_results.bind("touchstart.chosen",function(l){k.search_results_touchstart(l)});this.search_results.bind("touchmove.chosen",function(l){k.search_results_touchmove(l)});this.search_results.bind("touchend.chosen",function(l){k.search_results_touchend(l)});this.form_field_jq.bind("chosen:updated.chosen",function(l){k.results_update_field(l)});this.form_field_jq.bind("chosen:activate.chosen",function(l){k.activate_field(l)});this.form_field_jq.bind("chosen:open.chosen",function(l){k.container_mousedown(l)});this.form_field_jq.bind("chosen:close.chosen",function(l){k.input_blur(l)});this.search_field.bind("blur.chosen",function(l){k.input_blur(l)});this.search_field.bind("keyup.chosen",function(l){});this.search_field.bind("keydown.chosen",function(l){});this.search_field.bind("focus.chosen",function(l){k.input_focus(l)});this.search_field.bind("cut.chosen",function(l){});this.search_field.bind("paste.chosen",function(l){});if(this.is_multiple){return this.search_choices.bind("click.chosen",function(l){k.choices_click(l)})}else{return this.container.bind("click.chosen",function(l){l.preventDefault()})}};j.prototype.destroy=function(){f(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action);if(this.search_field[0].tabIndex){this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex}this.container.remove();this.form_field_jq.removeData("chosen");return this.form_field_jq.show()};j.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq[0].disabled;if(this.is_disabled){this.container.addClass("chosen-disabled");this.search_field[0].disabled=true;if(!this.is_multiple){this.selected_item.unbind("focus.chosen",this.activate_action)}return this.close_field()}else{this.container.removeClass("chosen-disabled");this.search_field[0].disabled=false;if(!this.is_multiple){return this.selected_item.bind("focus.chosen",this.activate_action)}}};j.prototype.container_mousedown=function(k){if(!this.is_disabled){if(k&&k.type==="mousedown"&&!this.results_showing){k.preventDefault()}if(!((k!=null)&&(f(k.target)).hasClass("search-choice-close"))){if(!this.active_field){if(this.is_multiple){this.search_field.val("")}f(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action);this.results_show()}else{if(!this.is_multiple&&k&&((f(k.target)[0]===this.selected_item[0])||f(k.target).parents("a.chosen-single").length)){k.preventDefault();this.results_toggle()}}return this.activate_field()}}};j.prototype.container_mouseup=function(k){if(k.target.nodeName==="ABBR"&&!this.is_disabled){return this.results_reset(k)}};j.prototype.search_results_mousewheel=function(k){var l;if(k.originalEvent){l=k.originalEvent.deltaY||-k.originalEvent.wheelDelta||k.originalEvent.detail}if(l!=null){k.preventDefault();if(k.type==="DOMMouseScroll"){l=l*40}return this.search_results.scrollTop(l+this.search_results.scrollTop())}};j.prototype.blur_test=function(k){if(!this.active_field&&this.container.hasClass("chosen-container-active")){return this.close_field()}};j.prototype.close_field=function(){f(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action);this.active_field=false;this.results_hide();this.container.removeClass("chosen-container-active");this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};j.prototype.activate_field=function(){this.container.addClass("chosen-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus()};j.prototype.test_active_click=function(k){var l;l=f(k.target).closest(".chosen-container");if(l.length&&this.container[0]===l[0]){return this.active_field=true}else{return this.close_field()}};j.prototype.results_build=function(){this.parsing=true;this.selected_option_count=null;this.results_data=d.select_to_array(this.form_field);if(this.is_multiple){this.search_choices.find("li.search-choice").remove()}else{if(!this.is_multiple){this.single_set_selected_text();if(this.disable_search||this.form_field.options.length<=this.disable_search_threshold){this.search_field[0].readOnly=true;this.container.addClass("chosen-container-single-nosearch")}else{this.search_field[0].readOnly=false;this.container.removeClass("chosen-container-single-nosearch")}}}this.update_results_content(this.results_option_build({first:true}));this.search_field_disabled();this.show_search_field_default();this.search_field_scale();return this.parsing=false};j.prototype.result_do_highlight=function(l){var p,o,m,n,k;if(l.length){this.result_clear_highlight();this.result_highlight=l;this.result_highlight.addClass("highlighted");m=parseInt(this.search_results.css("maxHeight"),10);k=this.search_results.scrollTop();n=m+k;o=this.result_highlight.position().top+this.search_results.scrollTop();p=o+this.result_highlight.outerHeight();if(p>=n){return this.search_results.scrollTop((p-m)>0?p-m:0)}else{if(o<k){return this.search_results.scrollTop(o)}}}};j.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted")}return this.result_highlight=null};j.prototype.results_show=function(){if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false}this.container.addClass("chosen-with-drop");this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());this.winnow_results();return this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this})};j.prototype.update_results_content=function(k){return this.search_results.html(k)};j.prototype.results_hide=function(){if(this.results_showing){this.result_clear_highlight();this.container.removeClass("chosen-with-drop");this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})}return this.results_showing=false};j.prototype.set_tab_index=function(l){var k;if(this.form_field.tabIndex){k=this.form_field.tabIndex;this.form_field.tabIndex=-1;return this.search_field[0].tabIndex=k}};j.prototype.set_label_behavior=function(){var k=this;this.form_field_label=this.form_field_jq.parents("label");if(!this.form_field_label.length&&this.form_field.id.length){this.form_field_label=f("label[for='"+this.form_field.id+"']")}if(this.form_field_label.length>0){return this.form_field_label.bind("click.chosen",function(l){if(k.is_multiple){return k.container_mousedown(l)}else{return k.activate_field()}})}};j.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices_count()<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default")}else{this.search_field.val("");return this.search_field.removeClass("default")}};j.prototype.search_results_mouseup=function(k){var l;l=f(k.target).hasClass("active-result")?f(k.target):f(k.target).parents(".active-result").first();if(l.length){this.result_highlight=l;this.result_select(k);return this.search_field.focus()}};j.prototype.search_results_mouseover=function(k){var l;l=f(k.target).hasClass("active-result")?f(k.target):f(k.target).parents(".active-result").first();if(l){return this.result_do_highlight(l)}};j.prototype.search_results_mouseout=function(k){if(f(k.target).hasClass("active-result"||f(k.target).parents(".active-result").first())){return this.result_clear_highlight()}};j.prototype.choice_build=function(l){var k,m,n=this;k=f("<li />",{"class":"search-choice"}).html("<span>"+(this.choice_label(l))+"</span>");if(l.disabled){k.addClass("search-choice-disabled")}else{m=f("<a />",{"class":"search-choice-close","data-option-array-index":l.array_index});m.bind("click.chosen",function(o){return n.choice_destroy_link_click(o)});k.append(m)}return this.search_container.before(k)};j.prototype.choice_destroy_link_click=function(k){k.preventDefault();k.stopPropagation();if(!this.is_disabled){return this.choice_destroy(f(k.target))}};j.prototype.choice_destroy=function(k){if(this.result_deselect(k[0].getAttribute("data-option-array-index"))){this.show_search_field_default();if(this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1){this.results_hide()}k.parents("li").first().remove();return this.search_field_scale()}};j.prototype.results_reset=function(){this.reset_single_select_options();this.form_field.options[0].selected=true;this.single_set_selected_text();this.show_search_field_default();this.results_reset_cleanup();this.form_field_jq.trigger("change");if(this.active_field){return this.results_hide()}};j.prototype.results_reset_cleanup=function(){this.current_selectedIndex=this.form_field.selectedIndex;return this.selected_item.find("abbr").remove()};j.prototype.result_select=function(k){var m,l;if(this.result_highlight){m=this.result_highlight;this.result_clear_highlight();if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false}if(this.is_multiple){m.removeClass("active-result")}else{this.reset_single_select_options()}m.addClass("result-selected");l=this.results_data[m[0].getAttribute("data-option-array-index")];l.selected=true;this.form_field.options[l.options_index].selected=true;this.selected_option_count=null;if(this.is_multiple){this.choice_build(l)}else{this.single_set_selected_text(this.choice_label(l))}if(!((k.metaKey||k.ctrlKey)&&this.is_multiple)){this.results_hide()}this.search_field.val("");if(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex){this.form_field_jq.trigger("change",{selected:this.form_field.options[l.options_index].value})}this.current_selectedIndex=this.form_field.selectedIndex;k.preventDefault();return this.search_field_scale()}};j.prototype.single_set_selected_text=function(k){if(k==null){k=this.default_text}if(k===this.default_text){this.selected_item.addClass("chosen-default")}else{this.single_deselect_control_build();this.selected_item.removeClass("chosen-default")}return this.selected_item.find("span").html(k)};j.prototype.result_deselect=function(l){var k;k=this.results_data[l];if(!this.form_field.options[k.options_index].disabled){k.selected=false;this.form_field.options[k.options_index].selected=false;this.selected_option_count=null;this.result_clear_highlight();if(this.results_showing){this.winnow_results()}this.form_field_jq.trigger("change",{deselected:this.form_field.options[k.options_index].value});this.search_field_scale();return true}else{return false}};j.prototype.single_deselect_control_build=function(){if(!this.allow_single_deselect){return}if(!this.selected_item.find("abbr").length){this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}return this.selected_item.addClass("chosen-single-with-deselect")};j.prototype.get_search_text=function(){return f("<div/>").text(f.trim(this.search_field.val())).html()};j.prototype.winnow_results_set_highlight=function(){var k,l;l=!this.is_multiple?this.search_results.find(".result-selected.active-result"):[];k=l.length?l.first():this.search_results.find(".active-result").first();if(k!=null){return this.result_do_highlight(k)}};j.prototype.no_results=function(k){var l;l=f('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');l.find("span").first().html(k);this.search_results.append(l);return this.form_field_jq.trigger("chosen:no_results",{chosen:this})};j.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};j.prototype.keydown_arrow=function(){var k;if(this.results_showing&&this.result_highlight){k=this.result_highlight.nextAll("li.active-result").first();if(k){return this.result_do_highlight(k)}}else{return this.results_show()}};j.prototype.keyup_arrow=function(){var k;if(!this.results_showing&&!this.is_multiple){return this.results_show()}else{if(this.result_highlight){k=this.result_highlight.prevAll("li.active-result");if(k.length){return this.result_do_highlight(k.first())}else{if(this.choices_count()>0){this.results_hide()}return this.result_clear_highlight()}}}};j.prototype.keydown_backstroke=function(){var k;if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}else{k=this.search_container.siblings("li.search-choice").last();if(k.length&&!k.hasClass("search-choice-disabled")){this.pending_backstroke=k;if(this.single_backstroke_delete){return this.keydown_backstroke()}else{return this.pending_backstroke.addClass("search-choice-focus")}}}};j.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus")}return this.pending_backstroke=null};j.prototype.keydown_checker=function(l){var m,k;m=(k=l.which)!=null?k:l.keyCode;this.search_field_scale();if(m!==8&&this.pending_backstroke){this.clear_backstroke()}switch(m){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:if(this.results_showing&&!this.is_multiple){this.result_select(l)}this.mouse_on_container=false;break;case 13:if(this.results_showing){l.preventDefault()}break;case 32:if(this.disable_search){l.preventDefault()}break;case 38:l.preventDefault();this.keyup_arrow();break;case 40:l.preventDefault();this.keydown_arrow();break}};j.prototype.search_field_scale=function(){var k,o,n,l,r,s,q,m,p;if(this.is_multiple){n=0;q=0;r="position:absolute; left: -1000px; top: -1000px; display:none;";s=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(m=0,p=s.length;m<p;m++){l=s[m];r+=l+":"+this.search_field.css(l)+";"}k=f("<div />",{style:r});k.text(this.search_field.val());f("body").append(k);q=k.width()+25;k.remove();o=this.container.outerWidth();if(q>o-10){q=o-10}return this.search_field.css({width:q+"px"})}};return j})(a)}).call(this);Ext.namespace("App");$.extend(Ext.Element.prototype,App.AbstractClass.prototype);App.Widget={cssClass:"widget",constructor:function Widget(a){if(!a.id){throw Error("No ID provided at config");return}Ext.apply(this,a);this.trans=false;this.tpl=a.template?new Ext.Template(App.Widget.getTemplate(a.template)):null;this.config=a;this.id=a.id;this.__defineGetter__("$",function(){return $("#"+this.id)});this.listeners=a.listeners;App.Widget.superclass.constructor.call(this,a.id);if(a.template){this.render()}else{}this.$jq=this.$;this.$ext=Ext.get(this.id);this.dom=Ext.getDom(this.id);this.setCSSClass(this.cssClass)},setCSSClass:function(a){this.$jq.addClass(a)},begin:function(){this.trans=true;return this},commit:function(){this.trans=false;this.render()},render:function(){if(!this.tpl instanceof Ext.Template){return}this.html=this.tpl.compile().apply(this);if($.isPlainObject(this.config.renderer)&&$.isFunction(this.config.renderer.func)){this.config.renderer.func.call(this.config.renderer.scope,html)}else{this.container=$("#"+this.id+"_container");if(this.container.length==0){console.warn("[App.Widget] Widget container element: #"+this.id+"_container Not Found!");$(document.body).append($("<div>").attr("id",this.id+"_container"))}if(this.container.has(":first-child")){this.container.empty()}this.container[this.persistentContainer?"append":"replaceWith"]($(this.html));console.info("[App.Widget] Widget #"+this.id+" HTML template rendered");this.fireEvent("rendered",this.id)}return this},fireEvent:function(a){if(!(Array.isArray(this.disableEvents)&&this.disableEvents.contains(a))){return Ext.util.Observable.prototype.fireEvent.apply(this,arguments)}else{return true}},destroy:function(){delete this}};App.Widget=Ext.extend(Ext.util.Observable,App.Widget);App.Widget.getTemplate=function(b){var a=$("template[name='"+b+"']");if(a.length!==1){throw new Error("[App.Widget::getTemplate] Template "+b+" not found. Or duplicated template names.")}else{return a.html()}};App.Widget.renderTemplate=function(c,b){var a=new Ext.Template(this.getTemplate(c));return a.compile().apply(b)};Ext.ns("App.Widget");App.Widget.Table={_dtButtonsInfoId:"datatables_buttons_info",defaultRenderMode:"full-hold",_addEvents:function(){this.addEvents("loaded","rowadded","rowmodified","rowdeleted","beforeaddrow","beforedeleterow","beforemodifyrow","rowselected","rowunselected","beforeselected","beforeunselected")},constructor:function Table(a){var c=this;App.Widget.Table.superclass.constructor.call(this,a);this._addEvents();this.animation=App.config.table.animation;Ext.apply(this,a||{});if(!Ext.isMac&&!Ext.isSafari){Ext.applyIf(a,{lengthChange:true,scrollY:false,searching:true,dom:"Blcfrtip",pageLength:App.config.table.defaultPageSize?App.config.table.defaultPageSize:30,buttons:["copyHtml5","excelHtml5","csvHtml5","pdfHtml5","colvis"],language:{buttons:{colvis:"Show/Hide columns"}},colReorder:true})}else{Ext.applyIf(a,{lengthChange:true,scrollY:false,searching:true,dom:"lcfrtip",pageLength:App.config.table.defaultPageSize?App.config.table.defaultPageSize:30,colReorder:true})}if(!$.isFunction(this.rowClass)){this.rowClass=App.AbstractRow}this.rows=[];console.info("[DataTable "+this.id+"] init");$("#"+this.id+"_dt tbody").empty();this.dtId=this.id+"_dt";console.warn(a);if(!a.columnDefs){a.columnDefs=[]}var b={};$.extend(b,a);this.$dt=$("#"+this.dtId).DataTable(Ext.applyIf(b,{retrieve:true}));$(window).on("resize",function(){c.adjust()});this.on("rowadded",function(d){$(c.$dt.row(d).node()).data(c.rows[d]);if(c.animation){c.playAnimation(d,"add")}if(!App.config.table.disableHeaderUpdate){c.initHeader()}});this.on("rowdeleted",function(d){if(c.animation){c.playAnimation(d,"delete")}if(!App.config.table.disableHeaderUpdate){c.initHeader()}});this.on("rowupdated",function(d){if(c.animation){c.playAnimation(d,"update")}if(!App.config.table.disableHeaderUpdate){c.initHeader()}});this.on("loaded",function(){c.$dt.buttons.info(false);c.initHeader();c.$dt.draw();if(Array.isArray(this.actions)){this._buildContextMenu();this._buildActionsButtons(this.id+"_actions",true);this._validateActionsButtons(this.id+"_actions")}},this);this.$dt.on("select",function(h,g,f,d){if(f!=="rows"&&f!=="row"){return}$("a[data-button-type='multi']").removeClass("disabled");if(!c.fireEvent("rowselected",c.getModelByIndex(d))){g.rows(d).deselect()}});this.$dt.on("deselect",function(h,g,f,d){if(f!=="rows"&&f!=="row"){return}if(g.rows(".selected").toArray()[0].length==0){$("a[data-button-type='multi']").addClass("disabled")}if(!c.fireEvent("rowunselected",c.getModelByIndex(d))){g.rows(d).select()}});$("#"+this.id+"_checkall").click(function(){c.$dt.rows("*")[this.checked?"select":"deselect"]()});this.on("rowselected",function(d){if(Array.isArray(this.actions)){this._validateActionsButtons(this.id+"_actions",true)}},this);this.on("rowunselected",function(d){if(Array.isArray(this.actions)){this._validateActionsButtons(this.id+"_actions")}},this);this.currentPageSize=this.getPageSize();this.$dt.draw.defer(1000)},destroy:function(){this.$dt.destroy();this.rows.forEach(function(a){a.destroy()});delete this},getModelByIndex:function(a){var b=$(this.$dt.rows(a).nodes()).data().id;return this.rows.find(function(c){return c.id===b});return false},addRow:function(b){if(!b.isExtendedFrom(App.Model.Abstract)&&$.isPlainObject(b)){var c=new this.rowClass(b)}else{var c=b}if(!this.fireEvent("beforeaddrow",c)){return false}this.rows.push(c);var a=this.$dt.row.add(c.toRowModelArray(this.rowType||null));$(a.node()).data(b);this.fireEvent("rowadded",this.rows.length-1,c);return c},updateRow:function(b){var c=App.Model.isModel(b)?b:new this.rowClass(b);if(!App.Model.isModel(c)){throw new Error("[App.Widget.Table::updateRow] rowClass of row doesn't extend App.Model.Abstract class")}if(!this.fireEvent("beforemodifyrow",c)){return false}if((rowIndex=this.getRowIndex(c))!=-1){if($.isFunction(this.rows[rowIndex].destroy)){this.rows[rowIndex].destroy()}delete this.rows[rowIndex];this.rows[rowIndex]=c;var a=c.toRowModelArray(this.rowType||null);this.$dt.row(rowIndex).data(a);$(this.$dt.row(rowIndex).node()).data(a);this.fireEvent("rowupdated",rowIndex,c)}else{console.warn("[App.Widget.Table::updateRow] No Row with such row model data id")}},deleteRowModel:function(a){if($.isNumeric(a)){a={id:a}}if((rowIndex=this.getRowIndex(a))!==-1){this.deleteRow(rowIndex)}else{console.warn("[Table::deleteRowModel()]: No row-model with such id.")}},deleteRow:function(b){var a=this;if(!this.fireEvent("rowbeforedeleted",this.rows[b])){return false}if(this.rows[b]){this.rows.remove(this.rows[b])}if(this.animation){window.setTimeout(function(){a.fireEvent("rowdeleted",b)},100);window.setTimeout(function(){a.$dt.row(b).remove();a.$dt.draw("full-hold")},2000)}else{this.fireEvent("rowdeleted",b);a.$dt.row(b).remove();a.$dt.draw("full-hold")}},clear:function(){this.$dt.clear();this.fireEvent("cleared");if(!this.trans){this.render()}return this},attachRowModelListeners:function(){},showLoadingMask:function(){this.$dt.buttons.info("Loading","Please wait...")},msgBox:function(b,d,c,a){if(this.$dt.buttons,arguments.length==0){this.$dt.buttons.info(false)}else{this.$dt.buttons.info(d,c,a);switch(b){case"success":$("#"+this.dtButtonsInfoId+" h2").addClass("msg-success");break;case"error":$("#"+this.dtButtonsInfoId+" h2").addClass("msg-error");break;default:$("#"+this.dtButtonsInfoId+" h2").removeClass("msg-success");$("#"+this.dtButtonsInfoId+" h2").removeClass("msg-error")}}},playAnimation:function(c,a){var b=$(this.$dt.row(c).node());switch(a){case"add":this.$dt.draw("full-hold");b.addClass.defer(300,b,["added"]);b.removeClass.defer(2000,b,["added"]);break;case"update":this.$dt.draw("full-hold");b.addClass.defer(500,b,["modified"]);b.removeClass.defer(2000,b,["modified"]);break;case"delete":b.addClass.defer(300,b,["deleted"]);b.removeClass.defer(2000,b,["deleted"]);this.$dt.draw.defer(2000,this.$dt,["full-hold"]);break}b.fadeOut.defer(600,b);b.fadeIn.defer(1000,b);b.fadeOut.defer(600,b);b.fadeIn.defer(1000,b)},load:function(b){var a=this;if(!$.isArray(b)){throw Error("[App.Widget.Table] rows should be an array")}if($.isArray(this.rows)){delete this.rows}this.rows=[];this.$dt.clear();b.forEach(function(c){a.addRow(c)});this.fireEvent("loaded");this.$dt.draw.defer(300,this.$dt);this.initHeader()},getRowIndex:function(a){return this.rows.findIndex(function(b){return b.id==a.id})},getPageSize:function(){return this.$dt.page.len()},setPageSize:function(a){this.$dt.page.len(a<=0?1:a);this.$dt.draw();return this},adjust:function(){this.$dt.columns.adjust().responsive.recalc();this.$dt.draw.defer(400,this.$dt);this.msgBox()},getSelectedRows:function(){return this.$dt.rows(".selected").toArray()[0].map(function(a){return this.rows[a]},this)},initHeader:function(){var a=this;$("#"+this.id+"_n").text(this.rows.length)},_buildActionsButtons:function(e,c){var b=this,a=0,d=$("#"+e);d.empty();this.actions.filter(function(f){return !f.menuOnly}).forEach(function(g){var f=$("<a>").addClass("action-button").attr("id","action-item-"+a).attr("data-toggle","popover").attr("data-placement","top").attr("data-trigger","hover").attr("title",g.label).attr("data-content",g.hint).appendTo(d);$("<span>").addClass(g.iconClass).appendTo(f);f.data(g);$("#"+e).on("click","#action-item-"+a,function(k,h){k.stopImmediatePropagation();var j=b.getSelectedRows();if(j.length==0&&!g.noRowsAllowed){b.msgBox("error","No rows selected!","Please select any row by clicking on the checkbox column.",2000);return}else{if(j.length>1&&!g.multi){b.msgBox("error","Select only one row","Cannot perform this operation on more than one row at time. Please select only one row.",3500);return}}if(!g.validator(j)){b.msgBox("error","Action unauthorized","You do not have permission to execute this action on selected row(s)",2000);return}else{if(j.length>1){if((pRows=j.filter(function(l){return !g.validator([l])})).length>0){pRows.forEach(function(m){var l=b.getRowIndex(m);b.$dt.rows(l).deselect();$(b.$dt.rows(l).nodes()).addClass("deleted")},b);if(confirm("You don't have permission to execute this action for some of selected rows (they are marked with red color now). Do you wish to unselect them and do an operation only on permitted rows?")){j=b.getSelectedRows();pRows.forEach(function(m){var l=b.getRowIndex(m);$(b.$dt.rows(l).nodes()).removeClass("deleted")},b)}else{pRows.forEach(function(m){var l=b.getRowIndex(m);$(b.$dt.rows(l).nodes()).removeClass("deleted")},b);return}}}}g.handler.call(g.scope,j)});a++},this);$("#"+e+" a").popover()},_validateActionsButtons:function(e,d){var b=$("#"+e+" a"),a=this;var c=this.getSelectedRows();b.each(function(h,g){var f=$(g).data();if(c.length>0&&!f.noRowsAllowed){if(!f.validator(c)){$(g).addClass("disabled")}else{$(g).removeClass("disabled")}}else{if(!f.noRowsAllowed){$(g).addClass("disabled")}else{$(g).removeClass("disabled")}}})},_buildContextMenu:function(){var c=this;var b=0;console.info("[Table] Generating context menu for "+this.id);var d=this.id+"_contextMenu";var a=this.actions.map(function(f){var e=$("<li>").addClass("context-menu-item list-group-item list-group-item-info");var g=Math.round(Math.random()*100000000000);e.attr("data-objectid",g);App["object"+g]=f;e.text(f.label).attr("id","context-menu-item-"+b).attr("data-toggle","popover").attr("data-placement","right").attr("data-trigger","hover").attr("data-content",f.hint).append($("<span>").addClass(f.iconClass).css("float","left"));$("#"+this.id).on("click","#context-menu-item-"+b,function(k,h){k.stopImmediatePropagation();var j=c.getSelectedRows();if(j.length==0&&!f.noRowsAllowed){c.msgBox("error","No rows selected!","Please select any row by clicking on the checkbox column.",2000);return}else{if(j.length>1&&!f.multi){c.msgBox("error","Select only one row","Cannot perform this operation on more than one row at time. Please select only one row.",3500);return}}if(!f.validator(j)){c.msgBox("error","Action unauthorized","You do not have permission yo execute this action on selected row(s)",2000);return}else{if(j.length>1){if((pRows=j.filter(function(l){return !f.validator([l])})).length>0){pRows.forEach(function(m){var l=c.getRowIndex(m);c.$dt.rows(l).deselect();$(c.$dt.rows(l).nodes()).addClass("deleted")},c);if(confirm("You don't have permission to execute this action for some of selected rows (they are marked with red color now). Do you wish to unselect them and do an operation only on permitted rows?")){j=c.getSelectedRows();pRows.forEach(function(m){var l=c.getRowIndex(m);$(c.$dt.rows(l).nodes()).removeClass("deleted")},c)}else{pRows.forEach(function(m){var l=c.getRowIndex(m);$(c.$dt.rows(l).nodes()).removeClass("deleted")},c);return}}}}f.handler.call(f.scope,j);$("#"+d).hide();c.$dt.rows("*").deselect()});b++;return e.get(0).outerHTML},this);$(document.body).click(function(){$("#"+d).hide()});$("#"+this.id).append(App.Widget.renderTemplate("contextMenu",{id:this.id+"_contextMenu",optList:a.join("")}));$("#"+d+" li").mouseenter(function(){$(this).addClass("active_item")}).mouseleave(function(){$(this).removeClass("active_item")});$("#"+d).hide();$("#"+this.id).on("contextmenu","table tr td",function(h){console.log(this);var f=this.offsetLeft+document.body.scrollLeft,j=this.offsetTop+document.body.scrollTop;c.$dt.rows($(this).parent("tr")).select();$("#"+d).css("left",f+100).css("top",j+250).show();h.preventDefault();h.stopImmediatePropagation();$("#"+d+" li").popover();var g=c.getSelectedRows();$("#"+d+" .context-menu-item").each(function(k,l){var e=App["object"+$(l).attr("data-objectid")];if(g.length==0||!e.validator(g)){$(l).addClass("disabled")}else{$(l).removeClass("disabled")}console.log($(l).text()+":"+e.validator(g))});return false})}};App.Widget.Table=Ext.extend(App.Widget,App.Widget.Table);App.Widget.Table.makeSelectable=function(a){a=new Object(a);a.columnDefs=[];a.columnDefs.push({orderable:false,className:"select-checkbox",targets:0});Ext.apply(a,{pagingType:"full_numbers",select:{style:"multi",selector:"td.select-checkbox"},orderMulti:true,order:[[0,"asc"]]});return a};Ext.ns("App.Widget");App.Widget.JobsExtendedTable=Ext.extend(App.Widget.Table,{constructor:function ExtendedTable(a){var c=this;var b=[];b.push({className:"details-control",orderable:false,defaultContent:"",targets:0});if(a.selectable!==false){b.push({orderable:false,className:"select-checkbox",targets:1})}Ext.applyIf(a,{columnDefs:b,pagingType:"full_numbers",select:{style:"multi",selector:"td.select-checkbox"},orderMulti:true,order:[[0,"asc"],[1,"asc"]]});App.Widget.JobsExtendedTable.superclass.constructor.call(this,a);$("#"+this.id+"_dt tbody").on("click","td.details-control",function(){var e=$(this).closest("tr");var h=c.$dt.row(e);if(h.child.isShown()){h.child.hide();e.removeClass("shown")}else{var d=Math.floor(Math.random()*1000000000000);var g=$(h.node()).data().getJobs();if(g===null){h.child(App.Widget.getTemplate("no_child_jobs")).show();e.addClass("shown");return}c.xTpl=new Ext.Template(App.Widget.getTemplate("jobs_children"));c.xTpl.compile();var f=c.xTpl.apply({id:c.id+"_child_"+d});h.child(f).show();c.childJobs=new App.Widget.JobsTable({id:c.id+"_child_"+d,dom:"tp",selectable:false,template:"jobs_children"});c.childJobs.load(g);$("#"+c.id+"_child_"+d).addClass("childTable");e.addClass("shown");e.attr("data-child-id",c.id+"_child_"+d)}})}});Ext.ns("App.Widget");App.Widget.NodesTable=Ext.extend(App.Widget.Table,{constructor:function NodesTable(a){var b=this;Ext.applyIf(a,{rowClass:App.Model.Node,columnDefs:[{orderable:false,className:"select-checkbox",targets:0},{className:"power-indicator",targets:1}],pagingType:"full_numbers",select:{style:"multi",selector:"td.select-checkbox"},orderMulti:true,order:[[0,"asc"]],actions:[{label:"Show details",hint:"Shows detailed information of the node and permits Enable/Disable node plugins.",iconClass:"ico-btn ico-btn-view_details",menuOnly:true,validator:function(){return true},handler:function(c){var d=c[0];b.loadDetails(d)}},{label:"Show Log",hint:"Opens a log of this node.",iconClass:"ico-btn ico-btn-log",validator:function(c){return c[0].hasPermission(croupier.NodePermission.getLog)},handler:function(c){var d=c[0];this.logViewer=new App.Widget.LogViewer({id:this.id+"_nodeLog",logName:d.name,title:"Node Log"});d.addListener("log.loaded",function(e){App.mainBox.progress(100);App.mainBox.done();this.logViewer.loadLog(e);this.logViewer.show()},this);App.mainBox=App.progressMsg("Nodes","Loading log of node:"+d.name);d.requestLog()},scope:this},{label:"Pause node(s)",hint:"Pauses all selected nodes",iconClass:"ico-btn ico-btn-pause",scope:this,multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.NodePermission.pause)})},handler:function(c){App.mainBox=App.progressMsg("Nodes","Pausing nodes...");App.API.Nodes.pauseNodes(c,confirm("Do you wish to also cancel all jobs of the node(s)?"),function(){App.mainBox.progress(100);App.mainBox.done()})}},{label:"Resume node(s)",hint:"Resumes paused nodes",iconClass:"ico-btn ico-btn-play",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.NodePermission.resume)})},handler:function(c){App.mainBox=App.progressMsg("Nodes","Resuming nodes...");App.API.multiAction("resume","node",c)}},{label:"Stop node(s)",hint:"Stops selected nodes",iconClass:"ico-btn ico-btn-stop",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.NodePermission.stop)})},handler:function(c){App.mainBox=App.progressMsg("Nodes","Stopping nodes...");App.API.multiAction("stop","node",c)}},{label:"Enable node(s)",hint:"Enables selected nodes",iconClass:"ico-btn ico-btn-node_power_on",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.NodePermission.set)&&!d.enabled})},handler:function(c){App.mainBox=App.progressMsg("Nodes","Enabling nodes...");App.API.Nodes.enableNodes(c,true)}},{label:"Disable node(s)",hint:"Disables selected nodes",iconClass:"ico-btn ico-btn-node_power_off",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.NodePermission.set)&&d.enabled=="1"})},handler:function(c){App.mainBox=App.progressMsg("Nodes","Disabling nodes...");App.API.Nodes.enableNodes(c,false)}},{label:"Remove node(s)",hint:"Removes selected nodes permanently.",iconClass:"ico-btn ico-btn-node_delete",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.NodePermission.remove)})},handler:function(c){App.mainBox=App.progressMsg("Nodes","Removing nodes...");App.API.Nodes.removeNodes(c,function(){App.mainBox.progress(100);App.mainBox.done()})}},{label:"Shutdown node(s)",hint:"Powers off the nodes machine",iconClass:"ico-btn ico-btn-node_power_off",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.NodePermission.resume)})},handler:function(c){App.mainBox=App.progressMsg("Nodes","Shutdown nodes...");App.API.multiAction("shutdown","node",c)}},{label:"Power on node(s)",hint:"Powers on the nodes machine",iconClass:"ico-btn ico-btn-node_power_on",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.NodePermission.wake)&&!d.on});return false},handler:function(c){App.mainBox=App.progressMsg("Nodes","Power on nodes...");App.API.multiAction("wake","node",c)}},{label:"Reboot node(s)",hint:"Reboots the nodes machine",iconClass:"ico-btn ico-btn-node_reboot",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.NodePermission.reboot)})},handler:function(c){App.mainBox=App.progressMsg("Nodes","Shutdown nodes...");App.API.multiAction("reboot","node",c)}},{label:"Assign to pool",hint:"Asks you for a pool and assigns selected node(s) to that pool",iconClass:"glyphicon glyphicon-indent-left",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.NodePermission.set)})},handler:function(c){var d=this;this.poolBox.modal({backdrop:"static"});this.poolSelector.setLoadingMask();this.poolSelector.on("loaded",function(){this.poolSelector.setLoadingMask(false)},this);this.poolSelector.load(App.API.Pools.getPools());$("#"+this.poolBox.attr("id")+"_applyBtn").click(function(){var e=d.poolSelector.getSelectedModel();App.mainBox=App.progressMsg("Nodes","Assigning nodes to pool:"+e.name);e.on("nodesupdated",function(){App.mainBox.progress(100);App.mainBox.done()});e.addNodes(c)})},scope:this}]});App.Widget.NodesTable.superclass.constructor.call(this,a);this.on("loaded",function(){console.log("NodesTable loaded");this._buildActionsButtons(this.id+"_nodeActions",false);this._buildPoolSelector(this.id+"_poolSelector");$("#"+this.id+"_saveNodeBtn").click(function(){b.saveNode()});$("#"+this.id+"_cancelNodeBtn").click(function(){})});this.$dt.on("click","td.power-indicator",function(d){var c=$(d.currentTarget).parent("tr").data();if(c.on=="1"&&confirm("You are about to shutdown a node "+c.name+". Proceed?")){App.mainBox=App.progressMsg("Node","Shutdown node "+c.name);App.API.multiAction("shutdown","node",[c])}else{if(!c.on&&confirm("You are about to power on a node "+c.name+". Proceed?")){App.mainBox=App.progressMsg("Node","Trying to boot node "+c.name);App.API.multiAction("wake","node",[c])}}});this._setStatusMarkers();if(!croupier||a.noSync){return}croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$add],function(c){b.addRow(c);b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$setStatus],function(c,d){b.updateRow(App.API.Nodes.getNode(d));b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$removePool],function(c,d){console.info("[Nodes] removePool event captured");b.updateRow(App.API.Nodes.getNode(d));b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$addPool],function(c,d){console.info("[Nodes] addPool event captured");b.updateRow(App.API.Nodes.getNode(d));b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$setBasicSystemInfo],function(c,d){b.updateRow(App.API.Nodes.getNode(d));b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$setJobPlugins],function(c,d){b.updateRow(App.API.Nodes.getNode(d));b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$setEnabled],function(c,d){b.updateRow(App.API.Nodes.getNode(d));b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$addJob],function(c,d){b.updateRow(App.API.Nodes.getNode(d));b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$removeJob],function(c,d){b.updateRow(App.API.Nodes.getNode(d));b.initHeader()});if(App.config.handleRuntimeEvents){croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$setBasicRuntimeInfo],function(c,d){b.updateRow(App.API.Nodes.getNode(d));b.initHeader()})}croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$remove],function(c,d){b.deleteRowModel(d);b.initHeader()})},initHeader:function(){var a=this;$("#"+this.id+"_nodes_n,#"+this.id+"_n").text(this.rows.length);$("#"+this.id+"_nodes_wn,#"+this.id+"_wn").text(this.rows.filter(function(b){return b.status==croupier.NodeStatus.EXECUTING}).length);$("#"+this.id+"_nodes_on,#"+this.id+"_on").text(this.rows.filter(function(b){return b.status==croupier.NodeStatus.DISCONNECTED}).length);$("#"+this.id+"_nodes_rn,#"+this.id+"_rn").text(this.rows.filter(function(b){return b.status==croupier.NodeStatus.READY}).length);$(".table_popup_list").popover();$("#"+this.id+" td a[data-node-id]").off("click").click(function(){a.$dt.rows("*").deselect();a.$dt.rows($(this).parent("td").parent("tr")).select();var b=$(this).attr("data-node-id");a.loadDetails(App.API.Nodes.getNode(b))});this.constructor.superclass.initHeader.call(this)},_setStatusMarkers:function(){var a=this;this.on("rowadded",function(b,c){$(a.$dt.row(b).node()).addClass(c.getStatusClass()+" "+c.getPowerClass())});this.on("rowupdated",function(b,c){var d=$(a.$dt.row(b).node());if(d.hasClass("selected")){d.attr("class",c.getStatusClass()+" "+c.getPowerClass()+" selected")}else{d.attr("class",c.getStatusClass()+" "+c.getPowerClass())}})},loadDetails:function(c){var b=this;if(!App.Model.isModel(c)&&$.isNumeric(c)){c=App.API.Nodes.getNode(c)}function a(e){return $("#"+b.id+"_"+e)}a("nodeName").text(c.name);a("nodeIp").text(c.ip);this.nodePoolBox=new App.Widget.PoolsSelectBox({id:this.id+"_nodePool",multiple:true,persistentContainer:true});this.nodePoolBox.on("loaded",function(){$(this.nodePoolBox.$select).val(c.$pools);this.nodePoolBox._syncChosen()},this);this.nodePoolBox.load(App.API.Pools.getPools());$("li[role='presentation']:first a").click();if(Array.isArray(c.$jobs)&&c.$jobs.length>0){var d=App.API.Jobs.getJob(c.$jobs[0]);a("jobName").text(d.name);a("jobId").text(d.id);a("jobPlugin").text(d.plugin.split(":")[0]);a("jobConfig").text(d.plugin.split(":")[1]);a("jobPriority").text(d.getPriority());a("jobPrimaryPool").html(d.primaryPools);a("jobSecondaryPool").html(d.secondaryPools);a("jobPrimaryNodes").html(d.primaryNodes);a("jobSecondaryNodes").html(d.secondaryNodes);a("progress").html(d.getProgress());$("li[role='presentation']:last").removeClass("disabled");a("nodeJobBtn").show();a("nodeJob").css("visibility","visible").removeClass("disabled")}else{a("nodeJobBtn").hide();$("li[role='presentation']:last").addClass("disabled");a("nodeJob").css("visibility","hidden").addClass("disabled")}this.configsTable=new App.Widget.PluginConfigsTable({id:this.id+"_config",rowType:"node"});this.allConfigs=[];this.plugins=App.API.Plugins.getPlugins();this.plugins.forEach(function(e){$.merge(this.allConfigs,e.getConfigurations())},this);this.configs=c.jobPlugins.map(function(f){var e=f.plugin.split(":")[0],g=f.plugin.split(":")[1];if((plModel=this.allConfigs.find(function(h){return h.id==f.plugin}))){plModel.test=f.test;plModel.enabled=f.enabled;return plModel}else{return false}},this);this.configsTable.on("loaded",function(){this.configsTable.$dt.order([[3,"asc"]]).draw()},this);this.configsTable.on("rowadded",function(f,e){if(e.enabled){this.configsTable.$dt.rows(f).select()}},this);this.configsTable.load(this.configs.filter(function(e){return e}));if(c.os){a("soInfo").css("visibility","visible");a("os").html(c.getOs());a("bits").text(c.os.bits)}else{a("soInfo").css("visibility","hidden")}if(c.cpu){a("cpu").text(c.cpu.model);a("totalCores").text(c.cpu.cores);a("mhz").text(c.cpu.mhz)}if(c.memory){a("ram").text(c.ram)}a("nodeDetails").modal({backdrop:"static"}).show();this.currentNode=c},saveNode:function(){var a=this.currentNode.$pools.map(function(c){return c.toString()});App.mainBox=App.progressMsg("Nodes","Saving node details...");if((Array.isArray(this.nodePoolBox.val())&&!this.nodePoolBox.val().equal(a))||(this.nodePoolBox.val()==null&&this.currentNode.$pools.length!=0)){var b=this.nodePoolBox.val().toModelArray("pools",App.Model.Pool);b.forEach(function(c){c.on("nodesupdated",function(){App.mainBox.progress(50)});c.addNodes([this.currentNode])},this)}this.currentNode.setEnabledJobPlugins(this.configsTable.getSelectedRows());this.currentNode.addListener("updated",function(){App.mainBox.progress(100);App.mainBox.done()});this.currentNode.update()},_buildPoolSelector:function(b){var a={id:b,title:"Move node(s) to the pool"};$("<div>").attr("id",b+"_container").appendTo($("#"+this.id).parent());$("#"+b+"_container").replaceWith($(App.Widget.renderTemplate("selectorBox",a)));this.poolBox=$("#"+b);this.poolSelector=new App.Widget.PoolsSelectBox({id:b+"_select",defaultMessage:"Select a pool",multiple:false})}});Ext.ns("App.Widget");App.Widget.JobsTable=Ext.extend(App.Widget.JobsExtendedTable,{constructor:function(a){var b=this;Ext.apply(a,{rowClass:App.Model.Job,pagingType:"full_numbers",actions:[{label:"Pause job(s)",hint:"Pauses selected jobs",iconClass:"ico-btn ico-btn-pause",multi:true,handler:function(c){var d=confirm("Do you want also cancel and reexecute theese jobs?");App.mainBox=App.progressMsg("Jobs","Pausing job(s)...");App.API.Jobs.pauseJobs(c,d,function(){App.mainBox.progress(100);App.mainBox.done()})},validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.set)&&d.status==croupier.JobStatus.EXECUTING})}},{label:"Resume job(s)",hint:"Resumes selected jobs",iconClass:"ico-btn ico-btn-play",multi:true,handler:function(c){App.mainBox=App.progressMsg("Jobs","Resuming job(s)...");App.API.multiAction("resume","job",c)},validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.set)})}},{label:"Cancel job(s)",hint:"Cancels selected jobs on they node",iconClass:"ico-btn ico-btn-job_cancel",multi:true,handler:function(c){var d=c.map(function(e){return{id:e.node.id}});App.mainBox=App.progressMsg("Jobs","Resuming job(s)...");App.API.multiAction("cancelJobs","node",d)},validator:function(c){return c.some(function(d){return d.node&&App.Model.Abstract.prototype.hasPermission.call(d.node,croupier.NodePermission.cancelJobs)})}},{label:"Retry job(s)",hint:"Reexecutes selected jobs (Jobs must be in ERROR state).",iconClass:"ico-btn ico-btn-node_reboot",multi:true,handler:function(c){App.mainBox=App.progressMsg("Jobs","Relaunching job(s)...");App.API.multiAction("retry","job",c)},validator:function(c){return c.some(function(d){return d.status==croupier.JobStatus.ERROR||d.status==croupier.JobStatus.RETRY})}},{label:"Change priority",hint:"Sets a new priority for the selected job(s)",iconClass:"ico-btn ico-btn-priority",multi:true,handler:function(c){var e=App.API.Users.getCurrentUser().isSuperAdministrator()?"-255 and +255":"-100 and +100",d=prompt("Enter new priority. (Value must be between "+e+" )");if($.isNumeric(d)&&(App.API.Users.getCurrentUser().isSuperAdministrator()?(d>=-255&&d<=255):(d>=-100&&d<=100))){App.mainBox=App.progressMsg("Jobs","Setting priority of job(s) to:"+d);App.API.Jobs.setPriority(c,d)}else{App.errorMsg("Invalid priority value","Priority value must be numeric, and between "+e)}},validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.set)&&d.status!=croupier.JobStatus.EXECUTED})}},{label:"Remove job",hint:"Removes selected job(s)",iconClass:"ico-btn ico-btn-job_delete",multi:true,handler:function(c){App.mainBox=App.progressMsg("Jobs","Removing job(s)...");App.API.Jobs.removeJobs(c,confirm("Do you want to remove job(s) permanently?"))},validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.remove)})}},{label:"Disable job(s)",hint:"Cancels selected job(s),and no execute until it will be enabled",iconClass:"ico-btn ico-btn-node_power_off",multi:true,handler:function(c){App.mainBox=App.progressMsg("Jobs","Disabling jobs...");App.API.Jobs.enableJobs(c,false)},validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.set)&&d.status!=croupier.JobStatus.DISABLED})}},{label:"Enable job(s)",hint:"Enables disabled job(s)",iconClass:"ico-btn ico-btn-node_power_on",multi:true,handler:function(c){App.mainBox=App.progressMsg("Jobs","Enabling jobs...");App.API.Jobs.enableJobs(c,true)},validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.set)&&d.status==croupier.JobStatus.DISABLED})}},{label:"Show log",hint:"Opens a log viewer and load the log file of the job",iconClass:"ico-btn ico-btn-log",handler:function(c){var e=c[0],d=new App.Widget.LogViewer({id:"jobLog"});e.on("log",function(f){App.mainBox.progress(100);App.mainBox.done();d.loadLog(f);d.show()});App.mainBox=App.progressMsg("Jobs","Loading log of job: "+e.name);e.requestLog()},validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.get)})}},{label:"Duplicate job",hint:"Opens a 'New Job' dialogbox and loads the same data as in selected job",iconClass:"ico-btn ico-btn-job_duplicate",handler:function(c){var d=c[0];this.panelNewJob=new App.Panel.NewJob();this.panelNewJob.show();$("#create-new-job").modal({backdrop:"static"});this.panelNewJob.loadJobData(d)},validator:function(c){return true},scope:this},{label:"Change primary pools",hint:"Ask's you for a list of pools and then set's them as a primary pools of all of the selected jobs",iconClass:"ico-btn ico-btn-pool_primary",multi:true,handler:function(c){var d=this;this.poolBox.modal({backdrop:"static"});this.poolSelector.on("loaded",function(){},this);this.poolSelector.load(App.API.Pools.getPools());$("#"+this.poolBox.attr("id")+"_applyBtn").off("click").one("click",function(){App.mainBox=App.progressMsg("Jobs","Assigning primary pools...");var e=0;c.forEach(function(f,g){f.on("updated",function(){if(g==c.length-1){App.mainBox.progress(100);App.mainBox.done()}});f.setPrimaryPools(d.poolSelector.val());e++})})},scope:this,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.set)})}},{label:"Change secondary pools",hint:"Ask's you for a list of pools and then set's them as a secondary pools of all of the selected jobs",iconClass:"ico-btn ico-btn-pool_secondary",multi:true,handler:function(c){var d=this;this.poolBox.modal({backdrop:"static"});this.poolSelector.on("loaded",function(){},this);this.poolSelector.load(App.API.Pools.getPools());$("#"+this.poolBox.attr("id")+"_applyBtn").off("click").one("click",function(){App.mainBox=App.progressMsg("Jobs","Assigning secondary pools...");var e=0;c.forEach(function(f,g){f.on("updated",function(){if(g==c.length-1){App.mainBox.progress(100);App.mainBox.done()}});f.setSecondaryPools(d.poolSelector.val());e++})})},validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.set)})},scope:this},{label:"Change primary nodes",hint:"Ask's you for a list of nodes and then set's them as a primary nodes of all of the selected jobs",iconClass:"ico-btn ico-btn-node_primary",multi:true,handler:function(c){var d=this;this.nodeBox.modal({backdrop:"static"});this.nodeSelector.on("loaded",function(){},this);this.nodeSelector.load(App.API.Nodes.getNodes());$("#"+this.nodeBox.attr("id")+"_applyBtn").off("click").one("click",function(){App.mainBox=App.progressMsg("Jobs","Assigning primary nodes...");var e=0;c.forEach(function(f,g){f.on("updated",function(){if(g==c.length-1){App.mainBox.progress(100);App.mainBox.done()}});f.setPrimaryNodes(d.nodeSelector.val());e++})})},validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.set)})},scope:this},{label:"Change secondary nodes",hint:"Ask's you for a list of nodes and then set's them as a secondary nodes of all of the selected jobs",iconClass:"ico-btn ico-btn-node_secondary",multi:true,scope:this,handler:function(c){var d=this;this.nodeBox.modal({backdrop:"static"});this.nodeSelector.load(App.API.Nodes.getNodes());$("#"+this.nodeBox.attr("id")+"_applyBtn").off("click").one("click",function(){App.mainBox=App.progressMsg("Jobs","Assigning secondary nodes...");var e=0;c.forEach(function(f,g){f.on("updated",function(){if(g==c.length-1){App.mainBox.progress(100);App.mainBox.done()}});f.setSecondaryNodes(d.nodeSelector.val());e++})})},validator:function(c){return c.some(function(d){return d.hasPermission(croupier.JobPermission.set)})}}]});App.Widget.JobsTable.superclass.constructor.call(this,a);this.on("loaded",function(){console.log("JobsTable loaded");this._buildPoolSelector(this.id+"_poolSelector","Pools");this._buildNodesSelector(this.id+"_nodeSelector","Nodes")});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.job$remove],function(c,d){b.deleteRow(d);b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.job$add],function(c){b.addRow(c);b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.job$setStatus],function(c,d){console.log("[job$setstatus]: "+d);console.log(c);b.updateRow(App.API.Jobs.getJob(d));b.initHeader()});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.job$setNode],function(c,d){b.updateRow(App.API.Jobs.getJob(d))});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.job$setPriority],function(c,d){b.updateRow(App.API.Jobs.getJob(d))});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.job$set],function(c,d){b.updateRow(App.API.Jobs.getJob(d))});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.job$setUser],function(c,d){b.updateRow(App.API.Jobs.getJob(d))});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.job$setUserGroup],function(c,d){b.updateRow(App.API.Jobs.getJob(d))});this._setStatusMarkers()},initHeader:function(){$("#"+this.id+"_jobs_n").text(this.rows.length);$("#"+this.id+"_jobs_wn").text(this.rows.filter(function(a){return a.status==croupier.JobStatus.EXECUTING}).length);$(".table_popup_list").popover()},_buildPoolSelector:function(c,b){var a={id:c,title:"Select "+b+" to set to job"};$("<div>").attr("id",c+"_container").appendTo($("#"+this.id).parent());$("#"+c+"_container").replaceWith($(App.Widget.renderTemplate("selectorBox",a)));this.poolBox=$("#"+c);this.poolSelector=new App.Widget.PoolsSelectBox({id:c+"_select",defaultMessage:"Select "+b,multiple:true})},_buildNodesSelector:function(c,b){var a={id:c,title:"Select "+b+" to set to job"};$("<div>").attr("id",c+"_container").appendTo($("#"+this.id).parent());$("#"+c+"_container").replaceWith($(App.Widget.renderTemplate("selectorBox",a)));this.nodeBox=$("#"+c);this.nodeSelector=new App.Widget.NodesSelectBox({id:c+"_select",defaultMessage:"Select "+b,multiple:true})},_setStatusMarkers:function(){var a=this;this.on("rowadded",function(b,c){$(a.$dt.row(b).node()).addClass(c.getStatusClass())});this.on("rowupdated",function(b,c){var d=$(a.$dt.row(b).node());if(d.hasClass("selected")){d.attr("class",c.getStatusClass()+" selected")}else{d.attr("class",c.getStatusClass())}})},deleteRow:function(b){var a=this.rows.findIndex(function(c){return croupier.toJobLongId(c.id)==b});if(a!=-1){this.constructor.superclass.deleteRow.call(this,a)}else{throw new Error("[JobsTable::deleteRow()]: No row with id:"+b+" found")}},getRowIndex:function(a){return this.rows.findIndex(function(b){return a.longId==b.longId})}});Ext.ns("App.Widget");App.Widget.UsersTable=Ext.extend(App.Widget.Table,{constructor:function(a){a=App.Widget.Table.makeSelectable(a);Ext.apply(a,{rowClass:App.Model.User,actions:[{label:"New user",hint:"Create a new user",iconClass:"ico-btn ico-btn-user_add",noRowsAllowed:true,multi:true,validator:function(){return App.canUserDo(croupier.ModificationDataAllPermission.user$add)},handler:function(){App.tabs.tab_active.the_panel_user_data=new panel_user_data(App.tabs.tab_active.tab_id,-1);App.tabs.tab_active.the_panel_user_data.show()}},{label:"Show details",hint:"Shows detailed information of the user and permits add/remove his groups",iconClass:"ico-btn ico-btn-view_details",menuOnly:true,validator:function(c){return true},handler:function(d){var c=d[0];App.tabs.tab_active.the_panel_user_data=new panel_user_data(App.tabs.tab_active.tab_id,c.id);App.tabs.tab_active.the_panel_user_data.show()}},{label:"Remove users",hint:"Removes selected users",iconClass:"ico-btn ico-btn-users_delete",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.UserPermission.remove)})},handler:function(c){if(!confirm("Are you sure?")){return}App.mainBox=App.progressMsg("Users","Removing users...");App.API.Users.removeUsers(c,function(){App.mainBox.progress(100);App.mainBox.done()},this)},scope:this}]});App.Widget.UsersTable.superclass.constructor.call(this,a);if(croupier&&!a.noSync){croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.user$add],function(c){this.addRow(c)},this);croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.user$set],function(c,d){this.updateRow(croupier.data.users.get(d))},this);croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.user$remove],function(c,d){console.info("[users table] captured remove event");this.deleteRowModel(d)},this)}var b=this;$("#"+b.id+"_dt").on("draw.dt",function(){$("#"+b.id+"_dt td a").off("click").click(function(){console.log("[UsersTable] Loading user data id:"+this.getAttribute("data-userid"));App.tabs.tab_active.the_panel_user_data=new panel_user_data(App.tabs.tab_active.tab_id,this.getAttribute("data-userid"))})})},initHeader:function(){var a=this;$("#"+this.id+"_n").text(this.rows.length);$("#"+this.id+"_wn").text(this.rows.filter(function(b){return b.role==croupier.UserRole.ADMINISTRATOR||b.role==croupier.UserRole.SUPERADMINISTRATOR}).length)}});Ext.ns("App.Widget");App.Widget.GroupsTable=Ext.extend(App.Widget.Table,{constructor:function(a){if(!a.noselectable){a=App.Widget.Table.makeSelectable(a)}Ext.apply(a,{rowClass:App.Model.Group,actions:[{label:"New group",hint:"Create a new group",iconClass:"ico-btn ico-btn-group_add",noRowsAllowed:true,multi:true,validator:function(){return App.canUserDo(croupier.ModificationDataAllPermission.userGroup$add)},handler:function(){App.tabs.tab_active.the_panel_group_data=new App.Panel.GroupData(App.tabs.tab_active.getTabId(),-1)}},{label:"Show details",hint:"Shows detailed information of the group and permits configure it permissions and add/remove users",iconClass:"ico-btn ico-btn-view_details",menuOnly:true,validator:function(b){return true},handler:function(c){var b=c[0];App.tabs.tab_active.the_panel_group_data=new App.Panel.GroupData(App.tabs.tab_active.getTabId(),b.id)}},{label:"Remove groups",hint:"Removes selected groups",iconClass:"ico-btn ico-btn-group_delete",multi:true,validator:function(b){return b.some(function(c){return c.hasPermission(croupier.UserGroupPermission.remove)})},handler:function(b){if(!confirm("Are you sure?")){return}App.mainBox=App.progressMsg("Groups","Removing groups...");App.API.Groups.removeGroups(b,function(){App.mainBox.progress(100);App.mainBox.done()},this)},scope:this}]});App.Widget.GroupsTable.superclass.constructor.call(this,a);if(croupier&&!a.noSync){croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.userGroup$add],function(b){this.addRow(b)},this);croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.userGroup$removeUser],function(b){this.updateRow(b)},this);croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.userGroup$remove],function(b,c){this.deleteRowModel(c);this.initHeader()},this)}},initHeader:function(){$("#"+this.id+"_n").text(this.rows.length);$("#"+this.id+" td a").off("click").click(function(){console.log("[GroupsTable] Loading group data id:"+this.getAttribute("data-groupid"));App.tabs.tab_active.the_panel_group_data=new App.Panel.GroupData(App.tabs.tab_active.getTabId(),this.getAttribute("data-groupid"))})},addRow:function(a){if(a.id==0){return this}else{return this.constructor.superclass.addRow.apply(this,arguments)}}});Ext.ns("App.Widget");App.Widget.PoolsTable={constructor:function(a){if(a.selectable!==false){a=App.Widget.Table.makeSelectable(a)}Ext.apply(a,{rowClass:App.Model.Pool,actions:[{label:"New pool",hint:"Create a new pool",iconClass:"ico-btn ico-btn-pool_add",noRowsAllowed:true,multi:true,validator:function(){return App.canUserDo(croupier.ModificationDataAllPermission.pool$add)},handler:function(){App.tabs.tab_active.panelDetails=new App.Panel.PoolDetails(App.tabs.tab_active.tab_id,-1);App.tabs.tab_active.panelDetails.show()}},{label:"Show details",hint:"Shows detailed information of the pool and permits add/remove nodes from it.",iconClass:"ico-btn ico-btn-view_details",menuOnly:true,validator:function(d){var c=d[0];return c.hasPermission(croupier.PoolPermission.moveNodes)},handler:function(d){var c=d[0];App.tabs.tab_active.panelDetails=new App.Panel.PoolDetails(App.tabs.tab_active.tab_id,c.id);App.tabs.tab_active.panelDetails.show()}},{label:"Remove pools",hint:"Removes selected pools",iconClass:"ico-btn ico-btn-pool_delete",multi:true,validator:function(c){return c.some(function(d){return d.hasPermission(croupier.PoolPermission.remove)})},handler:function(c){App.mainBox=App.progressMsg("Pools","Removing pools...");App.API.Pools.removePools(c,function(){App.mainBox.progress(100);App.mainBox.done()},this)},scope:this}]});a.columnDefs.push({className:"details-control",orderable:false,defaultContent:"",targets:1});App.Widget.PoolsTable.superclass.constructor.call(this,a);if(croupier&&!a.noSync){croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.pool$add],function(c){console.info("[Pools] new model added. ID:"+c.id);this.addRow(c)},this);croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.pool$set],function(c,d){console.info("[Pools] model updated. ID:"+d);this.updateRow(App.API.Pools.getPool(d))},this);croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.pool$addNode],function(c,d){console.info("[Pools] model updated. ID:"+d);this.updateRow(App.API.Pools.getPool(d))},this);croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.pool$removeNode],function(c,d){console.info("[Pools] model updated. ID:"+d);this.updateRow(App.API.Pools.getPool(d))},this);croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.pool$remove],function(c,d){console.info("[pools] captured remove event");this.deleteRowModel(d)},this)}var b=this;this._setExtraInfo();$("#"+b.id+"_dt").on("draw.dt",function(){$("#"+b.id+"_dt td a[data-poolid]").off("click").click(function(){console.log("[PoolsTable] Loading pool data id:"+this.getAttribute("data-poolid"));App.tabs.tab_active.panelDetails=new App.Panel.PoolDetails(App.tabs.tab_active.tab_id,this.getAttribute("data-poolid"));App.tabs.tab_active.panelDetails.show()})})},initHeader:function(){var a=this;$("#"+this.id+"_nu").text(this.rows.filter(function(b){return b.groupPermission==croupier.UserGroupPoolPermission.USE_PRIMARY||b.groupPermission==croupier.UserGroupPoolPermission.USE_SECONDARY}).length);$("#"+this.id+"_nm").text(this.rows.filter(function(b){return b.groupPermission==croupier.UserGroupPoolPermission.MODIFY}).length);this.constructor.superclass.initHeader.call(this)},addRow:function(a){if(a.id==0){return this}else{return this.constructor.superclass.addRow.apply(this,arguments)}},_setExtraInfo:function(){var a=this;$("#"+this.id+"_dt tbody").on("click","td.details-control",function(){var c=$(this).closest("tr");var f=a.$dt.row(c);if(f.child.isShown()){f.child.hide();c.removeClass("shown")}else{var b=Math.floor(Math.random()*1000000000000);var e=$(f.node()).data().getNodes();if(e===null){f.child(App.Widget.getTemplate("no_pool_nodes")).show();c.addClass("shown");return}a.xTpl=new Ext.Template(App.Widget.getTemplate("pool_nodes"));a.xTpl.compile();var d=a.xTpl.apply({id:a.id+"_child_"+b});f.child(d).show();a.nodesTable=new App.Widget.NodesTable({id:a.id+"_child_"+b,dom:"t",selectable:false,template:"pool_nodes"});a.nodesTable.load(e);$("#"+a.id+"_child_"+b).addClass("childTable");c.addClass("shown");c.attr("data-child-id",a.id+"_child_"+b)}})}};App.Widget.PoolsTable=Ext.extend(App.Widget.Table,App.Widget.PoolsTable);Ext.ns("App.Widget");App.Widget.DuoTables=Ext.extend(App.Widget,{constructor:function DuoTables(a){Ext.apply(this,a);if(this.leftTable&&this.rightTable&&this.leftTable.config&&this.rightTable.config){this.leftTable.config.id=this.id+"_left";this.rightTable.config.id=this.id+"_right";console.warn(this.leftTable.config);this.leftTable=new this.leftTable.$class(Ext.applyIf(this.leftTable.config,{dom:"lcfrtip",animation:false,noSync:true}));this.rightTable=new this.rightTable.$class(Ext.applyIf(this.rightTable.config,{dom:"lcfrtip",animation:false}));this.leftTable.on("beforeaddrow",function(c){return this.rightTable.getRowIndex(c)===-1},this);this.rightTable.on("beforeaddrow",function(c){return this.leftTable.getRowIndex(c)===-1},this)}else{throw new Error("[DuoTables]: Config error")}var b=this;$("#"+this.id+"_left_trigger span").click(function(){b.leftTrigger()});$("#"+this.id+"_right_trigger span").click(function(){b.rightTrigger()});this.rightTable.on("rowdeleted",function(){this.$dt.draw();this.initHeader()},this.rightTable);this.leftTable.on("rowdeleted",function(){this.$dt.draw();this.initHeader()},this.leftTable);this.rightTable.on("rowadded",function(){this.$dt.draw();this.initHeader()},this.rightTable);this.leftTable.on("rowadded",function(){this.$dt.draw();this.initHeader()},this.leftTable)},leftTrigger:function(){this.leftTable.msgBox("Moving...");var a=this.rightTable.getSelectedRows();this.rightTable.$dt.rows(".selected").deselect();if(a.length>0){a.forEach(function(b){this.rightTable.deleteRowModel(b);this.leftTable.addRow(b)},this)}else{console.info("[DuoTables::leftTrigger] No rows selected")}this.leftTable.msgBox();this.leftTable.initHeader();this.rightTable.initHeader()},rightTrigger:function(){this.rightTable.msgBox("Moving...");var a=this.leftTable.getSelectedRows();this.leftTable.$dt.rows(".selected").deselect();if(a.length>0){a.forEach(function(b){this.leftTable.deleteRowModel(b);this.rightTable.addRow(b)},this)}else{console.info("[DuoTables::rightTrigger] No rows selected")}this.rightTable.msgBox()},refresh:function(){this.rightTable.adjust();this.leftTable.adjust()},getAssigned:function(){return this.leftTable.rows}});Ext.ns("App.Widget");App.Widget.UsersDuoTables=Ext.extend(App.Widget.DuoTables,{constructor:function(a){Ext.applyIf(a,{leftTable:{$class:App.Widget.UsersTable,config:a.leftTableConfig||{}},rightTable:{$class:App.Widget.UsersTable,config:a.rightTableConfig||{}}});App.Widget.UsersDuoTables.superclass.constructor.call(this,a)}});Ext.ns("App.Widget");App.Widget.GroupsDuoTables=Ext.extend(App.Widget.DuoTables,{constructor:function(a){Ext.applyIf(a,{leftTable:{$class:App.Widget.GroupsTable,config:a.leftTableConfig||{}},rightTable:{$class:App.Widget.GroupsTable,config:a.rightTableConfig||{}}});App.Widget.GroupsDuoTables.superclass.constructor.call(this,a)}});Ext.ns("App.Widget");App.Widget.NodesDuoTable=Ext.extend(App.Widget.DuoTables,{constructor:function(a){Ext.applyIf(a,{leftTable:{$class:App.Widget.NodesTable,config:a.leftTableConfig||{}},rightTable:{$class:App.Widget.NodesTable,config:a.rightTableConfig||{}}});App.Widget.NodesDuoTable.superclass.constructor.call(this,a)}});Ext.ns("App.Widget");App.Widget.PluginsTable=Ext.extend(App.Widget.Table,{constructor:function(a){a=App.Widget.Table.makeSelectable(a);Ext.apply(a,{rowClass:App.Model.Plugin});if(a.showConfigs){a.columnDefs.push({className:"details-control text-left",orderable:false,defaultContent:"",targets:5})}App.Widget.PluginsTable.superclass.constructor.call(this,a);if(a.showConfigs){this.on("loaded",function(){this._setExtraInfo()},this)}this.on("rowadded",function(b,c){c.loadData()})},_setExtraInfo:function(){var a=this;$("#"+this.id+"_dt tbody").on("click","td.details-control",function(){var d=$(this).closest("tr");var f=a.$dt.row(d);if(f.child.isShown()){f.child.hide();d.removeClass("shown")}else{var b=Math.floor(Math.random()*1000000000000);var c=$(f.node()).data().getConfigurations();if(c===null){f.child(App.Widget.getTemplate("no_plugin_config")).show();d.addClass("shown");return}var e=App.Widget.renderTemplate("plugin_configs",{id:a.id+"_child_"+b});f.child(e).show();a.configsTable=new App.Widget.PluginConfigsTable({id:a.id+"_child_"+b,dom:"t",noGroup:true});a.configsTable.load(c);$("#"+a.id+"_child_"+b).addClass("childTable");d.addClass("shown");d.attr("data-child-id",a.id+"_child_"+b)}})}});Ext.ns("App.Widget");App.Widget.PluginConfigsTable=Ext.extend(App.Widget.Table,{constructor:function(a){a=App.Widget.Table.makeSelectable(a);Ext.apply(a,{rowClass:App.Model.PluginConfig,drawCallback:function(c){if(a.noGroup){return}var b=this.api();var e=b.rows({page:"current"}).nodes();var d=null;b.column(3,{page:"current"}).data().each(function(g,f){if(d!==g){$(e).eq(f).before(App.Widget.renderTemplate("pluginConfigGroup",{name:g.name,icon:g.icon,description:g.description}));d=g}})}});if(!a.noGroup){a.columnDefs.push({visible:false,targets:3})}App.Widget.PluginConfigsTable.superclass.constructor.call(this,a)}});Ext.ns("App.Widget");App.Widget.PermissionsDuoTables=Ext.extend(App.Widget.DuoTables,{constructor:function(a){if(a.permissionColumn){if(!a.leftTable.config.columnDefs){a.leftTable.config.columnDefs=[]}a.leftTable.config.columnDefs.push({orderable:false,className:"select-checkbox",targets:0});a.leftTable.config.columnDefs.push({targets:3,className:"permissions-select",orderable:false,data:null,defaultContent:App.Widget.renderTemplate("permissionsSelect",a)});Ext.apply(a.leftTable.config,{pagingType:"full_numbers",select:{style:"multi",selector:"td:first-child"},orderMulti:true,order:[[0,"asc"]]});a.leftTable.config.selectable=false}App.Widget.PermissionsDuoTables.superclass.constructor.call(this,a);var b=this;$("#"+this.id+"_all").click(function(){if(this.checked){$("#"+b.id+"_all_perm").removeAttr("disabled");$("#"+b.id).css("opacity","0.5").addClass("disabled");b.rightTable.msgBox("Assign to All","Permissions will be assigned to all elements")}else{$("#"+b.id+"_all_perm").attr("disabled","disabled");$("#"+b.id).css("opacity","1").removeClass("disabled");b.rightTable.msgBox()}});this.$all=$("#"+this.id+"_all_perm");if(this.apiSet){this.leftTable.on("rowadded",function(e,d){var c=$(this.leftTable.$dt.row(e).node()).find(".permissionsSelect");this.loadPermissionSelect(c)},this)}this.loadPermissionSelect(this.$all)},isAll:function(){return $("#"+this.id+"_all").get(0).checked},loadPermissionSelect:function(a){if(!this.apiSet){return}a.empty();this.apiSet.__names__.forEach(function(b){console.log(b);var c=new App.Model.APISet({key:b,value:this.apiSet[b]});$(c.toOptionElement()).appendTo(a)},this)}});Ext.ns("App.Widget");App.Widget.PoolsPermissionsDuoTables={constructor:function(a){Ext.applyIf(a,{leftTable:{$class:App.Widget.PoolsTable,config:a.leftTableConfig||{}},rightTable:{$class:App.Widget.PoolsTable,config:a.rightTableConfig||{}},permissionColumn:true,apiSet:croupier.UserGroupPoolPermission});App.Widget.PoolsPermissionsDuoTables.superclass.constructor.call(this,a);this.leftTable.on("rowadded",function(b,c){c.groupPermission=typeof c.groupPermission=="undefined"?croupier.UserGroupPoolPermission.VIEW:c.groupPermission;$(this.leftTable.$dt.row(b).node()).find(".permissionsSelect").val(c.groupPermission).on("change",function(){c.groupPermission=$(this).val()})},this)},getAssigned:function(){if(this.isAll()){return[new App.Model.Pool({id:0,groupPermission:this.$all.val()})]}else{return this.constructor.superclass.getAssigned.call(this)}}};App.Widget.PoolsPermissionsDuoTables=Ext.extend(App.Widget.PermissionsDuoTables,App.Widget.PoolsPermissionsDuoTables);Ext.ns("App.Widget");App.Widget.GroupsPermissionsDuoTables=Ext.extend(App.Widget.PermissionsDuoTables,{constructor:function(a){Ext.applyIf(a,{leftTable:{$class:App.Widget.GroupsTable,config:a.leftTableConfig||{rowType:"permission",noselectable:true}},rightTable:{$class:App.Widget.GroupsTable,config:a.rightTableConfig||{}},permissionColumn:true,apiSet:croupier.UserGroupUserGroupPermission});App.Widget.GroupsPermissionsDuoTables.superclass.constructor.call(this,a);this.leftTable.on("rowadded",function(b,c){c.groupCanModify=c.groupCanModify||false;$(this.leftTable.$dt.row(b).node()).find(".permissionsSelect").val(c.groupCanModify?croupier.UserGroupUserGroupPermission.MODIFY:croupier.UserGroupUserGroupPermission.VIEW).on("change",function(){c.groupCanModify=$(this).val()==croupier.UserGroupUserGroupPermission.MODIFY})},this)},getAssigned:function(){if(this.isAll()){return[new App.Model.Group({id:0,groupCanModify:this.$all.val()==croupier.UserGroupUserGroupPermission.MODIFY})]}else{return this.constructor.superclass.getAssigned.call(this)}}});Ext.ns("App.Widget");App.Widget.PluginsPermissionsDuoTables=Ext.extend(App.Widget.PermissionsDuoTables,{constructor:function(a){Ext.applyIf(a,{leftTable:{$class:App.Widget.PluginConfigsTable,config:a.leftTableConfig||{}},rightTable:{$class:App.Widget.PluginConfigsTable,config:a.rightTableConfig||{}}});App.Widget.PluginsPermissionsDuoTables.superclass.constructor.call(this,a)},getAssigned:function(){if(this.isAll()){return[new App.Model.Plugin({id:"*"})]}else{return this.constructor.superclass.getAssigned.call(this)}}});Ext.ns("App.Widget");App.Widget.SelectBox=Ext.extend(App.Widget,{cssClass:"widget selectbox",constructor:function SelectBox(a){Ext.applyIf(a,{template:"SelectBox",search_contains:true,include_group_label_in_selected:true,inherit_select_classes:true,multiple:true});this.mult=a.multiple?"multiple":"";App.Widget.SelectBox.superclass.constructor.apply(this,arguments);this.selectId=this.id+"_select";this.$chosen=$("#"+this.selectId).chosen(a);this.$select=this.$chosen.filter("select:first-child")[0];if($.isFunction(a.modelClass)&&a.modelClass.superclass.constructor==App.Model.Abstract){this.modelClass=a.modelClass}else{throw new TypeError("[App.Widget.SelectBox]: modelClass undefined or not implement App.Model.Abstract")}this.options=[];this.addEvents("loaded","ready","optionadded","optionchanged","optionremoved");var b=this;this.$chosen.on("chosen:ready",function(){b.fireEvent("ready")});this.$chosen.on("change",function(d,c){b.fireEvent("change",c)});this.$chosen.on("chosen:ready",function(){if(b.disabled){b.disable()}})},setLoadingMask:function(){if(arguments.length==0){$("#"+this.id+" .chosen-container").attr("class","chosen-container progress-bar progress-bar-success progress-bar-striped active").children("a").children("span").text("Loading")}else{$("#"+this.id+" .chosen-container").attr("class","chosen-container chosen-container-single");this._syncChosen()}},val:function(a){if(a){$("#"+this.selectId).val(a);this._syncChosen()}else{return $("#"+this.selectId).val()}},disable:function(){$("#"+this.id+" *").attr("disabled","disabled").addClass("disabled").prop("disabled",true);this._syncChosen()},enable:function(){$("#"+this.id+" *").removeAttr("disabled").removeClass("disabled").prop("disabled",false);this._syncChosen()},clear:function(){if(Array.isArray(this.options)){delete this.options}this.options=[];$(this.$select).empty();if(this.emptyOption){$("<option>").attr("name","empty").attr("id","empty").attr("value","empty").attr("disabled","disabled").attr("selected","selected").text(this.emptyOption).appendTo($(this.$select))}this._syncChosen();return this},load:function(a){if(!Array.isArray(a)){throw new TypeError("[SelectBox::load()] optList is not an Array. ("+a+")")}this.clear();a.forEach(function(b){this.addOption(b)},this);this.fireEvent("loaded",this.options.length);return this},addOption:function(b){var a=!b.isExtendedFrom(App.Model.Abstract)?new this.modelClass(b):b;this.$select.add(a.toOptionElement());this.options.push(a);this.fireEvent("optionadded",a);this._syncChosen();return this},deleteOption:function(a){this.options.remove(this.options[a]);this.$select.remove(a);this._syncChosen();return this},deleteModel:function(a){this.deleteOption(this.getIndexByModelId(a));return this},getIndexByModelId:function(a){var c=$.isPlainObject(a)?a.id:a;var b=this.$select.namedItem(c);return Array.from(this.$select.options).indexOf(b)},updateOption:function(c){var b=new this.modelClass(c);var a=this.getIndexByModelId(b);this.options[a]=b;this.$select.options[a]=b.toOptionElement();this._syncChosen()},_syncChosen:function(){this.$chosen.trigger("chosen:updated")},syncListWith:function(b){var a=this;if(b.constructor.superclass.constructor!==App.Widget.SelectBox){throw new Error("[SelectBox::syncWithList()]: selBox is not a valid App.Widget.SelectBox instance")}b.$chosen.on("change",function(c,d){if(Ext.isString(d.deselected)){a.$select.namedItem(d.deselected).removeAttribute("disabled")}if(Ext.isString(d.selected)){a.$select.namedItem(d.selected).setAttribute("disabled","disabled")}a._syncChosen()})},getSelectedModel:function(){return this.options.find(function(a){return a.id==this.val()},this)}});Ext.ns("App.Widget");App.Widget.PoolsSelectBox=Ext.extend(App.Widget.SelectBox,{constructor:function PoolsSelectBox(a){this._defConfig={cssClass:"widget selectbox pools",label:"Pools",width:"250px",no_results_text:"No pools found!",defaultMessage:"Select pools",modelClass:App.Model.Pool};Ext.applyIf(a,this._defConfig);App.Widget.PoolsSelectBox.superclass.constructor.apply(this,arguments)},addOption:function(a){if(a.id==0){return this}else{this.constructor.superclass.addOption.apply(this,arguments)}}});Ext.ns("App.Widget");App.Widget.NodesSelectBox=Ext.extend(App.Widget.SelectBox,{constructor:function NodesSelectBox(a){var b=this;this._defConfig={cssClass:"widget selectbox nodes",label:"Nodes",width:"260px",no_results_text:"No nodes found!",defaultMessage:"Select nodes",modelClass:App.Model.Node};Ext.applyIf(a,this._defConfig);App.Widget.NodesSelectBox.superclass.constructor.apply(this,arguments);this.$chosen.on("chosen:showing_dropdown",function(c){b._setListDecoration()});this.$chosen.on("chosen:hiding_dropdown",function(c){b._setSelectedDecoration()});this.$chosen.on("chosen:ready",function(c){b._setSelectedDecoration()})},_setListDecoration:function(){var a=this;console.info("[NodesSelectBox]: setListDecoration()");$("#"+this.id+" .chosen-results > li.active-result").each(function(c,b){var d=a.options[b.getAttribute("data-option-array-index")];$(b).html(d.getOsIcon()+"&nbsp;"+d.name);$(b).addClass(d.getStatusClass())})},_setSelectedDecoration:function(){var a=this;$("#"+this.$chosen.attr("id")+"_chosen li.search-choice").each(function(c,d){var b=$(d);if(!b.children("a")[0]){return}var e=a.options[b.children("a")[0].getAttribute("data-option-array-index")];b.addClass(e.getStatusClass());b.children("span").html(e.getOsIcon()+"&nbsp;"+e.name)})},_syncChosen:function(){this.constructor.superclass._syncChosen.apply(this,arguments);this._setSelectedDecoration()}});Ext.ns("App.Widget");App.Widget.GroupsSelectBox=Ext.extend(App.Widget.SelectBox,{constructor:function GroupsSelectBox(a){this._defConfig={cssClass:"widget selectbox pools",label:"Groups",width:"250px",no_results_text:"No groups found!",defaultMessage:"Select group",modelClass:App.Model.Group};Ext.applyIf(a,this._defConfig);App.Widget.GroupsSelectBox.superclass.constructor.apply(this,arguments)},addOption:function(a){if(a.id==0){return this}else{this.constructor.superclass.addOption.apply(this,arguments)}}});Ext.ns("App.Widget");App.Widget.JobStatusSelectBox=Ext.extend(App.Widget.SelectBox,{constructor:function JobStatusSelectBox(a){this._defConfig={cssClass:"widget selectbox jobstatus",label:"Job Status",width:"250px",no_results_text:"No status type found!",defaultMessage:"Select job status",modelClass:App.Model.APISet};Ext.applyIf(a,this._defConfig);App.Widget.JobStatusSelectBox.superclass.constructor.apply(this,arguments);this.load()},load:function(){croupier.JobStatus.__names__.forEach(function(a){this.constructor.superclass.addOption.call(this,{key:a,value:croupier.JobStatus[a]})},this)},addOption:function(){throw new Error("[JobStatusSelectBox]: It's a static list. Cannot add values.")}});Ext.ns("App.Widget");App.Widget.PluginsSelectBox=Ext.extend(App.Widget.SelectBox,{constructor:function PluginsSelectBox(a){var b=this;this._defConfig={cssClass:"widget selectbox plugins",label:"Plugins",width:"260px",no_results_text:"No plugins found!",defaultMessage:"Select plugin",modelClass:App.Model.Plugin,template:"defSelectBox",emptyOption:"Select plugin"};Ext.applyIf(a,this._defConfig);App.Widget.PluginsSelectBox.superclass.constructor.apply(this,arguments);this.$chosen.on("chosen:showing_dropdown",function(c){b._setListDecoration()});this.$chosen.on("chosen:hiding_dropdown",function(c){b._setSelectedDecoration()});this.$chosen.on("chosen:ready",function(c){b._setSelectedDecoration()})},_setListDecoration:function(){var a=this;console.info("[PluginsSelectBox]: setListDecoration()");$("#"+this.id+" .chosen-results > li.active-result").each(function(c,d){var b=a.options[d.getAttribute("data-option-array-index")-1];$(d).html('<div class="pluginInfo" data-container="body" data-toggle="popover" data-placement="left" title="'+b.description+'">'+b.getIcon(40)+"&nbsp&nbsp"+b.name+"</div>")});$(".pluginInfo").mouseenter(function(){try{if($(this).attr("title").length>0||$(this).attr("data-original-title").length>0){$(this).popover("show")}}catch(b){}}).mouseleave(function(){$(this).popover("hide")})},_setSelectedDecoration:function(){var b=this;console.info("plugin model:"+$(this.$select).val());var a=App.API.Plugins.getPlugin($(this.$select).val());if(!App.Model.isModel(a)){return}$("#"+this.id+" a.chosen-single > span").html(a.getIcon(25)+"&nbsp;"+a.name)},_syncChosen:function(){this.constructor.superclass._syncChosen.apply(this,arguments);this._setSelectedDecoration()}});Ext.ns("App.Widget");App.Widget.PluginConfigSelectBox=Ext.extend(App.Widget.SelectBox,{constructor:function PluginConfigSelectBox(a){var b=this;this._defConfig={cssClass:"widget selectbox pluginconfig",label:"Configuration",width:"260px",height:"40px",no_results_text:"No configuration found!",defaultMessage:"Select plugin configuration",modelClass:App.Model.APISet,template:"defSelectBox",emptyOption:"Select configuration"};Ext.applyIf(a,this._defConfig);App.Widget.PluginConfigSelectBox.superclass.constructor.apply(this,arguments);this.$chosen.on("chosen:showing_dropdown",function(c){});this.$chosen.on("chosen:hiding_dropdown",function(c){});this.$chosen.on("chosen:ready",function(c){})},_setListDecoration:function(){var a=this;console.info("[PluginConfigSelectBox]: setListDecoration()");$("#"+this.id+" .chosen-results > li.active-result").each(function(c,d){var b=a.options[d.getAttribute("data-option-array-index")-1];$(d).html('<div class="pluginInfo" data-container="body" data-toggle="popover" data-placement="left" title="'+b.description+'">'+b.getIcon(40)+"&nbsp&nbsp"+b.name+"</div>");$(".pluginInfo").mouseenter(function(){$(this).popover("show")}).mouseleave(function(){$(this).popover("hide")})})}});Ext.ns("App.Widget");App.Widget.LogViewer={cssClass:"logViewer widget",constructor:function(a){var b=this;Ext.applyIf(a,{template:"nodeLog",persistentContainer:true});App.Widget.LogViewer.superclass.constructor.call(this,a);this.$doc=$("#"+this.id+"_iframe").get(0).contentWindow.document;$("#btn_log_close").click(function(){b.close()})},loadLog:function(a){this.$doc.write("<pre>"+a+"</pre>")},show:function(){$("#"+this.id).modal({backdrop:"static"}).show()},close:function(){$("#"+this.id).remove()}};App.Widget.LogViewer=Ext.extend(App.Widget,App.Widget.LogViewer);Ext.ns("App");App.Panel=Ext.extend(Ext.util.Observable,{constructor:function(){App.Panel.superclass.constructor.apply(this,arguments);this.addEvents("loaded","show","hide");this.html_id;this.url;this.loaded=false;this.tab_id;this.html_code="";this.htmlCodeId;this.load_html=function(){console.warn("[App.Panel] loading html of "+this.html_id);if(this.html_id){if(!existInHTML("#"+this.html_id)){$("#main_container").append("<div id='"+this.html_id+"' ></div>")}$("#"+this.html_id).hide();if(this.htmlCodeId==undefined){$("#"+this.html_id).append(HTML_CODE.panels[this.define.class_panel])}else{$("#"+this.html_id).append(replaceAll(HTML_CODE.panels[this.define.class_panel],this.htmlCodeId))}this.loaded=true;this.loaded_html();this.fireEvent("loaded")}};this.getTabId=function(){return this.tab_id};this.load_html()},loaded_html:function(){console.log("Panel:: loaded_html()");if(!croupier.$allEventReceived){croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.all],this.initialLoad,this)}else{this.initialLoad()}Ext.query("section .max-min-trigger").forEach(function(a){$(a).click(function(){var c=Ext.fly(a).parent("section");var e=Ext.fly(a).child("span");var d={duration:1,easing:"elasticIn"};var b=c.getAttribute("data-last-height");if(e.hasClass("glyphicon-minus")){c.dom.setAttribute("data-last-height",c.getHeight());c.setHeight(0,d);e.removeClass("glyphicon-minus");e.addClass("glyphicon-plus")}else{c.setHeight(b,d);e.removeClass("glyphicon-plus");e.addClass("glyphicon-minus")}})})},show:function(){if(this.constructor.length>1){$("#"+this.html_id+"_popup").modal({backgrop:"static"})}$("#"+this.html_id).show();$("#"+this.html_id).css("z-index",App.Panel.zIndex++);if(App.mainBox){$("#"+App.mainBox.id).remove()}$("a[data-toggle]").popover();this.fireEvent("show",this.tab_id)},hide:function(){$("#"+this.html_id).hide();this.fireEvent("hide",this.tab_id)},close:function(){$("#"+this.html_id).remove();this.fireEvent("close",this.tab_id)}});App.Panel.zIndex=0;window.panel=App.Panel;Ext.ns("App.Panel");App.Panel.ButtonOpenNewTabs={constructor:function button_open_new_tabs(){this.html_id="button_open_new_tab";this.define=C.panels.button_open_new_tabs;this.loaded_html=function(){$("#button-create-new-job").click(function(a){the_panel_new_job=new panel_new_job();the_panel_new_job.load_data();$("#create-new-job").modal({backdrop:"static"})});$("#button-user").click(function(a){App.tabs.create_tab(CONSTANT.panels.panel_user_list)});$("#button-monitor").click(function(a){App.tabs.create_tab(CONSTANT.panels.panel_monitor)});$("#button-group").click(function(a){App.tabs.create_tab(CONSTANT.panels.panel_group_list)});$("#button-create-history").click(function(a){App.tabs.create_tab(CONSTANT.panels.panel_history)});$("#button-create-stadistics").click(function(a){App.tabs.create_tab(CONSTANT.panels.panel_statistics)});$("#button-create-nodes").click(function(a){App.tabs.create_tab(CONSTANT.panels.panel_node_list)});$("#button-create-pools").click(function(a){App.tabs.create_tab(CONSTANT.panels.panel_pool_list)});$("#button-create-presets").click(function(a){App.tabs.create_tab(CONSTANT.panels.panel_preset_list)});$("#button-create-crontab").click(function(a){App.tabs.create_tab(CONSTANT.panels.panel_contrab_list)});$("#button-create-plugins").click(function(a){App.tabs.create_tab(CONSTANT.panels.panel_plugin_list)});$("*[data-userrole]").filter(function(a,b){if(croupier.user.role>$(b).data().userrole){$(b).hide()}});croupier.ModificationDataAllPermission.__names__.forEach(function(a){if(!App.canUserDo(croupier.ModificationDataAllPermission[a])){$('*[data-userpermission="'+a+'"]').hide()}},this);this.show()};App.Panel.ButtonOpenNewTabs.superclass.constructor.call(this)}};App.Panel.ButtonOpenNewTabs=Ext.extend(App.Panel,App.Panel.ButtonOpenNewTabs);window.button_open_new_tabs=App.Panel.ButtonOpenNewTabs;Ext.ns("App.Panel");App.Panel.Monitor=Ext.extend(App.Panel,{constructor:function(a){this.html_id=a+"_panel";this.tab_id=a;this.nodesTableId="table_nodes_"+this.tab_id;this.jobsTableId="table_jobs_"+this.tab_id;this.define=App.config.panels.panel_monitor;this.htmlCodeId={$table_nodes$:this.nodesTableId,$table_jobs$:this.jobsTableId,$table_nodes_tbody$:this.html_id+C.tcih+"table_nodes_tbody",$table_jobs_tbody$:this.html_id+C.tcih+"table_jobs_tbody",$job_table_name$:this.html_id+C.tcih+"job_table_name",$job_table_plugin$:this.html_id+C.tcih+"job_table_plugin",$job_table_config$:this.html_id+C.tcih+"job_table_config",$job_table_status$:this.html_id+C.tcih+"job_table_status",$job_table_priority$:this.html_id+C.tcih+"job_table_priority",$job_table_errors$:this.html_id+C.tcih+"job_table_errors",$job_table_warnings$:this.html_id+C.tcih+"job_table_warnings",$job_table_progress$:this.html_id+C.tcih+"job_table_progress",$title_nodes$:this.html_id+C.tcih+"title_nodes",$title_jobs$:this.html_id+C.tcih+"title_jobs",$debug_nodes$:this.html_id+C.tcih+"debug_nodes",$debug_jobs$:this.html_id+C.tcih+"debug_jobs"};App.$monitor=this;this.loaded_html=function(){var c=this;this.nodesTable=new App.Widget.NodesTable({id:this.nodesTableId});this.jobsTable=new App.Widget.JobsTable({id:this.jobsTableId});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.node$list],function(d){App.mainBox=App.progressMsg("Croupier Server Syncronization","Reloading monitor...");this.nodesTable.load(App.API.Nodes.getNodes())},this);croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.job$list],function(d){this.jobsTable.load(App.API.Jobs.getJobs())},this);this.resizeBar=Ext.get(this.nodesTableId+"_resizeBar");this.barInitPos=this.resizeBar.getTop();var b=this.tab_id;$("#nickusername_header").text(croupier.user.name);$("#"+this.nodesTableId+"_resizeBar").draggable({axis:"y",containment:"#main_container",start:function(){this.barInitPos=Ext.get(this).getTop();console.log("Initpos:"+this.barInitPos)},drag:function(){},stop:function(){var e=Ext.get(this).getTop();var f=Math.abs(e-this.barInitPos);var d=Math.round(f/30);console.info("offset:"+f);console.info("nRows:"+d);if(e>this.barInitPos){c.nodesTable.setPageSize(c.nodesTable.currentPageSize+d);c.jobsTable.setPageSize(c.jobsTable.currentPageSize-d)}else{if(e<this.barInitPos){c.nodesTable.setPageSize(c.nodesTable.currentPageSize-d);c.jobsTable.setPageSize(c.jobsTable.currentPageSize+d)}}c.nodesTable.currentPageSize=c.nodesTable.getPageSize();c.jobsTable.currentPageSize=c.jobsTable.getPageSize()}});this.constructor.superclass.loaded_html.call(this)};this.initialLoad=function(){var b=this;this.nodesTable.on("loaded",function(){console.info("[Monitor "+b.tab_id+"] Nodes table loaded");App.mainBox.progress(50);App.mainBox.setMsg("Monitor","Loading jobs...");this.jobsTable.load(App.API.Jobs.getJobs())},this);this.jobsTable.on("loaded",function(){console.info("[Monitor "+b.tab_id+"] Jobs table loaded");App.mainBox.progress(100);App.mainBox.done()});App.mainBox=App.progressMsg("Monitor","Loading nodes...",function(c){$("#"+c).remove()});this.nodesTable.load(App.API.Nodes.getNodes());this.nodesTable.adjust();this.jobsTable.adjust()};this.getNodesBox=function(){return Ext.get("table_nodes_"+this.tab_id+"_container")},this.getJobsBox=function(){return Ext.get("table_jobs_"+this.tab_id+"_container")},this.update=function(){console.info("[Monitor] ----***Heart beat***---- ");this.jobsTable.initHeader();this.nodesTable.initHeader()};this.hide=function(){this.constructor.superclass.hide.call(this)};this.show=function(){this.constructor.superclass.show.call(this)};this.close=function(){this.constructor.superclass.close.call(this)};App.Panel.Monitor.superclass.constructor.apply(this,arguments)}});window.panel_monitor=App.Panel.Monitor;Ext.ns("App.Panel");App.Panel.Header=Ext.extend(App.Panel,{constructor:function panel_header(){this.html_id="header";this.define=C.panels.header;this.loaded_html=function(){$("#nickusername_header").text(croupier.user.name);$("#"+this.html_id).show()};App.Panel.Header.superclass.constructor.apply(this,arguments)}});window.panel_header=App.Panel.Header;panel_contrab_list.prototype=new panel();function panel_contrab_list(a){this.html_id="contrab_list";this.tab_id=a;this.define=C.panels.panel_contrab_list;this.loaded_html=function(){};this.update=function(){};this.hide=function(){$("#"+this.html_id).hide()};this.show=function(){$("#"+this.html_id).show()};this.close=function(){$("#"+this.html_id).remove()};panel.prototype.constructor.call(this)}App.Panel.GroupData=Ext.extend(App.Panel,{constructor:function panel_group_data(b,a){this.html_id="panel_group_data";this.tab_id=b;this.define=C.panels.panel_group_data;this.group_id=a;this.users=App.API.Users.getUsers();if(a!=-1){this.group_data=App.API.Groups.getGroup(this.group_id)}else{this.group_data=null}this.loadDataGroup=function(){$("#groupName").val(this.group_data.name);$("#groupDescription").val(this.group_data.description)};this.close=function(){$("#datatables_buttons_info").remove();$("#"+this.html_id+" .modal").remove();$("#panel_group_data").remove()};this.show=function(){$("#"+this.html_id+" .modal").modal({backdrop:"static"}).fadeIn();$("#"+this.html_id).show()};this.getUsersByGroupId=function(c){return this.users.filter(function(d){return $.inArray(this.group_id,d.groups)},this)};this.initialLoad=function(){if(this.group_id==-1){return this.addModeLoad()}App.mainBox=App.progressMsg("Group details","Loading group users...");this.groupsDuo.leftTable.on("loaded",function(){App.mainBox.progress(87);this.groupsDuo.rightTable.load(App.API.Groups.getGroups())},this);this.groupsDuo.rightTable.on("loaded",function(){App.mainBox.progress(100);App.mainBox.done();$("#datatables_buttons_info").remove()},this);this.pluginsDuo.leftTable.on("loaded",function(){App.mainBox.progress(62);this.allConfigs=[];this.pluginsLoaded=0;this.plugins=App.API.Plugins.getPlugins();this.plugins.forEach(function(c){$.merge(this.allConfigs,c.getConfigurations())},this);this.pluginsDuo.rightTable.load(this.allConfigs)},this);this.pluginsDuo.rightTable.on("loaded",function(){App.mainBox.progress(75);App.mainBox.setMsg("Loading group groups...");this.groupsDuo.leftTable.load(this.group_data.getGroups())},this);this.poolsDuo.leftTable.on("loaded",function(){App.mainBox.progress(37);this.poolsDuo.rightTable.load(App.API.Pools.getPools())},this);this.poolsDuo.rightTable.on("loaded",function(){App.mainBox.progress(50);App.mainBox.setMsg("Loading group plugins...");this.groupConfigs=this.group_data.getPluginConfigs();console.dir(this.groupConfigs);this.pluginsDuo.leftTable.load(this.groupConfigs)},this);this.usersDuo.rightTable.on("loaded",function(){App.mainBox.progress(25);App.mainBox.setMsg("Loading group pools...");this.poolsDuo.leftTable.load(this.group_data.getPools())},this);this.usersDuo.leftTable.on("loaded",function(){App.mainBox.progress(12);this.usersDuo.rightTable.load(this.users)},this);this.usersDuo.leftTable.load(this.group_data.getUsers())};this.addModeLoad=function(){App.mainBox=App.progressMsg("Add Group","Loading lists...");$("#groupName").val("");$("#groupDescription").val("");$(".panel-newmode-only").show().css("visibility","visible");this.usersDuo.rightTable.on("loaded",function(){App.mainBox.progress(25);this.allConfigs=[];this.pluginsLoaded=0;this.plugins=App.API.Plugins.getPlugins();this.plugins.forEach(function(c){$.merge(this.allConfigs,c.getConfigurations())},this);this.pluginsDuo.rightTable.load(this.allConfigs)},this);this.pluginsDuo.rightTable.on("loaded",function(){App.mainBox.progress(50);this.poolsDuo.rightTable.load(App.API.Pools.getPools())},this);this.poolsDuo.rightTable.on("loaded",function(){App.mainBox.progress(75);this.groupsDuo.rightTable.load(App.API.Groups.getGroups())},this);this.groupsDuo.rightTable.on("loaded",function(){App.mainBox.progress(100);App.mainBox.done()},this);this.usersDuo.rightTable.load(App.API.Users.getUsers())};this.loaded_html=function(){var d=this;this.usersDuo=new App.Widget.UsersDuoTables({id:"duousers"});this.pluginsDuo=new App.Widget.PluginsPermissionsDuoTables({id:"duoplugins"});this.poolsDuo=new App.Widget.PoolsPermissionsDuoTables({id:"duopools"});this.groupsDuo=new App.Widget.GroupsPermissionsDuoTables({id:"duogroupsperm"});if(this.group_id!=-1){this.loadDataGroup()}else{$("#"+this.html_id+" .modal-title").text("Add Group")}$('a[data-toggle="tab"]').on("shown.bs.tab",function(f){d.usersDuo.refresh();d.poolsDuo.refresh();d.groupsDuo.refresh();d.pluginsDuo.refresh()});var c=this.tab_id;$(".groups_data_close_btn").click(function(){d.close()});$(".groups_data_save_btn").click(function(){if(d.group_id!=-1){d.save()}else{d.add()}});this.show();App.Panel.GroupData.superclass.loaded_html.call(this)};this.save=function(){App.mainBox=App.progressMsg("Group details","Saving group data...");this.group_data.name=$("#groupName").val();this.group_data.description=$("#groupDescription").val();this.group_data.setUsers(this.usersDuo.getAssigned());this.group_data.setPools(this.poolsDuo.getAssigned());this.group_data.setPlugins(this.pluginsDuo.getAssigned());this.group_data.setGroups(this.groupsDuo.getAssigned());this.group_data.on("updated",function(){App.mainBox.progress(100);App.mainBox.done();this.close.defer(2000,this)},this);this.group_data.update()};this.add=function(){if(!$("#groupName").formValidate()){return}App.mainBox=App.progressMsg("Add Group","Inserting group data...");this.group_data=new App.Model.Group({id:-1});this.group_data.name=$("#groupName").val();this.group_data.description=$("#groupDescription").val();this.group_data.permission=$("#groupPermission").val();this.group_data.setUsers(this.usersDuo.getAssigned());this.group_data.setPools(this.poolsDuo.getAssigned());this.group_data.setPlugins(this.pluginsDuo.getAssigned());this.group_data.setGroups(this.groupsDuo.getAssigned());this.group_data.on("inserted",function(){App.mainBox.progress(100);App.mainBox.done();this.close.defer(2000,this)},this);this.group_data.insert()};App.Panel.GroupData.superclass.constructor.apply(this,arguments)}});window.panel_group_data=App.Panel.GroupData;Ext.ns("App.Panel");App.Panel.Groups=Ext.extend(App.Panel,{constructor:function panel_group_list(a){this.html_id="group_list";this.tab_id=a;this.tableGroupsId="table-group";this.define=C.panels.panel_group_list;this.the_panel_group_data;this.loaded_html=function(){$("#"+this.html_id).show();console.log("html loaded");var b=this.tab_id;this.groupsTable=new App.Widget.GroupsTable({id:this.tableGroupsId});this.constructor.superclass.loaded_html.call(this);this.updateButtonAble()},this.initialLoad=function(){var b=this;this.groupsTable.on("rowselected",function(c){if(c.hasPermission(croupier.UserGroupPermission.remove)){$("#remove_group").off("click").click(function(){b.removeGroups()});return true}else{App.errorMsg("Groups","You don't has a permission to remove this group");return false}},this);this.groupsTable.on("loaded",function(){App.mainBox.progress(100);App.mainBox.done()},this);App.mainBox=App.progressMsg("Groups","Loading groups...");this.groupsTable.load(App.API.Groups.getGroups());this.groupsTable.initHeader()},this.updateButtonAble=function(){var b=this;$("#group_details").hide();if(App.canUserDo(croupier.ModificationDataAllPermission.userGroup$add)){$("#add_group").click(function(){b.the_panel_group_data=new panel_group_data(b.tab_id,-1)})}else{$("#add_group").addClass("disabled")}};this.removeGroups=function(){var b=this.groupsTable.getSelectedRows();if(b.length==0){return}if(!window.confirm("Are you sure?")){return}App.mainBox=App.progressMsg("Groups","Removing selected groups...");App.API.Groups.removeGroups(b,function(){App.mainBox.progress(100);App.mainBox.done()})};this.addGroup=function(){log4javascript.getRootLogger().info("addGroup--")};this.detailsGroup=function(){log4javascript.getRootLogger().info("detailsGroup")};this.groupDetails=function(b){this.the_panel_group_data=new panel_group_data(this.tab_id,b)};this.update=function(){this.groupsTable.adjust()};App.Panel.Groups.superclass.constructor.apply(this,arguments)}});window.panel_group_list=App.Panel.Groups;Ext.ns("App.Panel");App.Panel.NewJob=Ext.extend(App.Panel,{constructor:function panel_new_job(){this.html_id="new_job";this.define=C.panels.new_job;this.plugin_selected;this.configuration_selected;this.data_plugin;this.primaryPoolsId="jobAddPrimaryPool";this.secondaryPoolsId="jobAddSecondaryPool";this.primaryNodesId="jobAddPrimaryNode";this.secondaryNodesId="jobAddSecondaryNode";this.initStatusBoxId="jobAddStatus";this.groupBoxId="jobAddGroup";this.initialLoad=function(){this.plugins=App.API.Plugins.getPlugins();this.pluginsBox.load(this.plugins);this.pluginsBox.on("change",function(b){if(b.selected&&((id=b.selected)!=="empty")){this.pluginConfigBox.on("loaded",function(){this.pluginConfigBox.setLoadingMask("hide")},this);this.pluginConfigBox.setLoadingMask();this.pluginConfig=App.API.Plugins.getPluginData(id,function(c){this.pluginConfig=c;this.pluginConfigBox.load(c);this.pluginConfigBox.setLoadingMask("hide")},this);if(this.pluginConfig){this.pluginConfigBox.load(this.pluginConfig);this.pluginConfigBox.setLoadingMask("hide")}}},this);var a=this;this.pluginConfigBox.on("change",function(b){var c=b.selected;a.plugin=a.pluginsBox.getSelectedModel();a.pluginConfig=a.pluginConfigBox.getSelectedModel();a.pluginEditor=new App.Widget.PluginConfigurator({id:"pluginConfig",pluginName:a.plugin.name,pluginConfig:a.pluginConfig.name,icon:a.plugin.icon,pluginProperties:a.pluginConfig.getProperties(),persistentContainer:true});console.info("Loading editor with configuration: "+a.plugin.name+" - "+a.pluginConfig.name);console.dir(a.pluginConfig);a.pluginEditor.on("apply",function(d){this.typedProps=d;$("#jobAdd_Properties").html(App.Widget.renderTemplate("typedProps",{code:JSON.stringify(this.typedProps)}));$("#addJobPropsPanel").show();$("#jobAddEditProps").click(function(){a.pluginEditor.show()});$("#jobAddDeleteProps").click(function(){a.pluginEditor.close();delete a.pluginEditor;$("#jobAdd_Properties").empty();$("#addJobPropsPanel").hide()})},a);a.pluginEditor.show()});this.nodes=App.API.Nodes.getNodes();this.groups=App.API.Users.getCurrentUser().getGroups();this.groupsBox.load(this.groups);this.primaryNodes.on("loaded",function(){console.info("[NewJob] primaryNodes loaded");this.primaryNodes.syncListWith(this.secondaryNodes)},this);this.secondaryNodes.on("loaded",function(){console.info("[NewJob] secondaryNodes loaded");this.secondaryNodes.syncListWith(this.primaryNodes)},this);this.nodesPrimary=this.nodes.filter(function(b){return b.hasPermission(croupier.NodePermission.usePrimary)});this.nodesSecondary=this.nodes.filter(function(b){return b.hasPermission(croupier.NodePermission.useSecondary)});this.primaryNodes.load(this.nodesPrimary);this.secondaryNodes.load(this.nodesSecondary);this.pools=App.API.Pools.getPools();this.poolsPrimary=this.pools.filter(function(b){return b.canUseAsPrimary()});this.poolsSecondary=this.pools.filter(function(b){return b.canUseAsSecondary()},this);this.primaryPools.on("loaded",function(){console.info("[NewJob] primaryPools loaded");this.primaryPools.syncListWith(this.secondaryPools)},this);this.secondaryPools.on("loaded",function(){console.info("[NewJob] secondaryPools loaded");this.secondaryPools.syncListWith(this.primaryPools)},this);this.primaryPools.load(this.poolsPrimary);this.secondaryPools.load(this.poolsSecondary)};this.loaded_html=function(){var a=this;this.groupsBox=new App.Widget.GroupsSelectBox({id:this.groupBoxId,label:"Group",multiple:false});this.pluginsBox=new App.Widget.PluginsSelectBox({id:"jobAddPlugin",multiple:false});this.pluginConfigBox=new App.Widget.PluginConfigSelectBox({id:"jobAddConfiguration",multiple:false,disabled:true,defaultMessage:"Select a plugin first"});this.primaryPools=new App.Widget.PoolsSelectBox({id:this.primaryPoolsId,label:"Primary:",include_group_label_in_selected:true});this.secondaryPools=new App.Widget.PoolsSelectBox({id:this.secondaryPoolsId,label:"Secondary:"});this.primaryNodes=new App.Widget.NodesSelectBox({id:this.primaryNodesId,label:"Primary:"});this.secondaryNodes=new App.Widget.NodesSelectBox({id:this.secondaryNodesId,label:"Secondary:"});$("#btnAddJob").click(function(b){if(a.validate()){a.add_job()}});$("#jobAddPriority").change(function(){a.select_priority()});$("#jobAddRadioNodes,#jobAddRadioPool").change(function(){if($(this).val()=="on"){if($(this).attr("data-disable")=="nodes"){a.primaryNodes.disable();a.secondaryNodes.disable();a.primaryPools.enable();a.secondaryPools.enable()}else{a.primaryNodes.enable();a.secondaryNodes.enable();a.primaryPools.disable();a.secondaryPools.disable()}}});this.primaryNodes.disable();this.secondaryNodes.disable();this.primaryNodes._syncChosen();this.secondaryNodes._syncChosen();this.load_priority();$("#"+this.html_id).show();this.constructor.superclass.loaded_html.apply(this,arguments)};this.load_data=function(){$("#jobAddName").val("");$("#jobAddDescription").val("");$("#jobAddPriorityLevel").val("");$("#jobAddTimeout").val("");$("#jobAddRetries").val("");$("#jobAddStatus").prop("checked",true)};this.validate=function(){if(!$("#jobAddName,#jobAddPriorityLevel").formValidate()){return false}if($("#jobAddGroup_select").val()==null){App.errorMsg("Add Job","You must select a job group");return false}if(!this.typedProps){App.errorMsg("Add Job","You must configure a plugin first");return false}return true};this.loadJobData=function(c){App.mainBox=App.progressMsg("Duplicate Job","Loading form with job data...");this.$job=c;$("#jobAddName").val(c.name);$("#jobAddDescription").val(c.description);$("#jobAddPriorityLevel").val(c.priority);$("#jobAddGroup").val(c.userGroup);$("#jobAddTimeout").val(c.timeout);$("#jobAddRetries").val(c.retries);$("#jobAddStatus").prop("checked",c.enabled);if(Array.isArray(c.$primaryNodes)&&c.$primaryNodes.length>0){$(this.primaryNodes.$select).val(c.$primaryNodes);this.primaryNodes._syncChosen();$("#jobAddRadioNodes").prop("checked",true);this.primaryNodes.enable();this.secondaryNodes.enable()}if(Array.isArray(c.$secondaryNodes)&&c.$secondaryNodes.length>0){$(this.secondaryNodes.$select).val(c.$secondaryNodes);this.secondaryNodes._syncChosen();$("#jobAddRadioNodes").prop("checked",true);this.primaryNodes.enable();this.secondaryNodes.enable()}if(Array.isArray(c.$primaryPools)&&c.$primaryPools.length>0){$(this.primaryPools.$select).val(c.$primaryPools);this.primaryPools._syncChosen();$("#jobAddRadioPools").prop("checked",true);this.primaryPools.enable();this.secondaryPools.enable()}if(Array.isArray(c.$secondaryPools)&&c.$secondaryPools.length>0){$(this.secondaryPools.$select).val(c.$secondaryPools);this.secondaryPools._syncChosen();$("#jobAddRadioPools").prop("checked",true);this.primaryPools.enable();this.secondaryPools.enable()}var b=c.plugin.split(":")[0],a=c.plugin.split(":")[1];this.pluginConfigBox.on("loaded",function(){App.mainBox.progress(50);this.pluginConfigBox.val(a);c.on("properties",function(d){this.pluginConfigBox.fireEvent("change",{selected:a});this.pluginEditor.propTable.loadFromTypedProperties(d);App.mainBox.progress(100);App.mainBox.done()},this);c.requestProperties();$("#addJobPropsPanel").show()},this);this.pluginsBox.val(b);this.pluginsBox.fireEvent("change",{selected:b})};this.add_job=function(){var f;var c=new Object();var e=$("#jobAddName").val();var a=$("#jobAddDescription").val();var b=$("#jobAddPriorityLevel").val();if(b>=-255&&b<=255){jobAddPriorityV=b}else{App.errorMsg("Add Job","Priority has an incorrect value. It must be between "+App.Users.getCurrentUser().isSuperAdministrator()?"-255 and +255":"-100 and +100");return(false)}if(!App.config.debug||$("#jobsDebug").val()==""){this.addJob(e,a,jobAddPriorityV)}else{if(!$.isNumeric($("#jobsDebug").val())){alert("Enter number of jobs to generate")}else{var d=parseInt($("#jobsDebug").val());App.mainBox=App.progressMsg("New Job","Generating jobs...");$.ajaxSetup({async:false});for(i=0;i<d;i++){this.addJob(e+"_"+i,a,jobAddPriorityV);App.mainBox.progress(Math.round(i*100/d))}App.mainBox.progress(100);App.mainBox.done();$.ajaxSetup({async:true})}}};this.addJob=function(a,d,b){var c=this;this.newJob=new App.Model.Job({id:0,name:a,description:d,plugin:this.plugin.id+":"+this.pluginConfig.id,properties:this.typedProps,priority:b,retries:$("#jobAddRetries").val()==""?undefined:$("#jobAddRetries").val(),timeout:$("#jobAddTimeout").val()==""?undefined:$("#jobAddTimeout").val(),userGroup:$("#jobAddGroup select").val(),enabled:$("#jobAddStatus").get(0).checked,primaryNodes:$("#jobAddRadioNodes").get(0).checked?$("#jobAddPrimaryNode select").val():null,secondaryNodes:$("#jobAddRadioNodes").get(0).checked?$("#jobAddSecondaryNode select").val():null,primaryPools:$("#jobAddRadioPool").get(0).checked?$("#jobAddPrimaryPool select").val():null,secondaryPools:$("#jobAddRadioPool").get(0).checked?$("#jobAddSecondaryPool select").val():null,postJobs:undefined});var e=App.progressMsg("New Job","Adding a job: "+this.newJob.name);App.API.Jobs.addJob(this.newJob,function(f){if(f.status==croupier.ResponseStatus.SUCCESS){e.progress(100);e.done()}else{e.abort()}c.close()})};this.load_priority=function(){for(var a in CONSTANT.PRIORITY.A_DEFINED){var b={$VAR_VALUE$:CONSTANT.PRIORITY.A_DEFINED[a],$VAR_TEXT$:a+" ("+CONSTANT.PRIORITY.A_DEFINED[a]+")"};if(CONSTANT.PRIORITY.DEFAULT==a){$("#jobAddPriorityLevel").val(CONSTANT.PRIORITY.A_DEFINED[a]);b["$VAR_SELECTED$"]="selected"}else{b["$VAR_SELECTED$"]=""}html=replaceAll(HTML_CODE.new_job.data_plugin,b);$("#jobAddPriority").append(html)}};this.select_priority=function(){var a=$("#jobAddPriority").val();if(this.select_priority){$("#jobAddPriorityLevel").val(a);jobAddPriorityV=jobAddPriorityLevel}};App.Panel.NewJob.superclass.constructor.apply(this,arguments)}});window.panel_new_job=App.Panel.NewJob;Ext.ns("App.Panel");App.Panel.NodeList={constructor:function panel_node_list(a){this.html_id="node_list";this.tab_id=a;this.define=C.panels.panel_node_list;this.initialLoad=function(){this.nodeTable.on("loaded",function(){App.mainBox.progress(100);App.mainBox.done()},this);App.mainBox=App.progressMsg("Nodes","Loading nodes...");this.nodeTable.load(App.API.Nodes.getNodes())};this.loaded_html=function(){var b=this;this.nodeTable=new App.Widget.NodesTable({id:"table-nodes",rowType:"full"});croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.pool$list],function(c){App.mainBox=App.progressMsg("Croupier Server Syncronization","Reloading nodes...");this.nodeTable.load(App.API.Nodes.getNodes())},this);this.constructor.superclass.loaded_html.call(this)};this.update=function(){this.nodeTable.adjust()};App.Panel.NodeList.superclass.constructor.call(this)}};App.Panel.NodeList=Ext.extend(App.Panel,App.Panel.NodeList);window.panel_node_list=App.Panel.NodeList;Ext.ns("App.Panel");App.Panel.Plugins={constructor:function panel_plugin_list(a){this.html_id="plugin_list";this.tab_id=a;this.define=C.panels.panel_plugin_list;this.loaded_html=function(){this.pluginsTable=new App.Widget.PluginsTable({id:"plugins-table",showConfigs:true});App.mainBox=App.progressMsg("Plugins","Loading plugins");return this.constructor.superclass.loaded_html.apply(this,arguments)};this.initialLoad=function(){this.pluginsTable.on("loaded",function(){App.mainBox.progress(100);App.mainBox.done()});this.pluginsTable.load(App.API.Plugins.getPlugins())};App.Panel.Plugins.superclass.constructor.apply(this,arguments)}};App.Panel.Plugins=Ext.extend(App.Panel,App.Panel.Plugins);window.panel_plugin_list=App.Panel.Plugins;Ext.ns("App.Panel");App.Panel.Pools=Ext.extend(App.Panel,{constructor:function panel_pool_list(a){this.html_id="pool_list";this.tab_id=a;this.define=C.panels.panel_pool_list;this.poolsTableId="table-pools";this.initialLoad=function(){this.msgBox.setMsg("Loading pools list...");this.poolsTable.on("loaded",function(){this.msgBox.progress(100);this.msgBox.done()},this);this.poolsTable.load(App.API.Pools.getPools());croupier.on(croupier.ModificationType.__names__[croupier.ModificationType.pool$list],function(b){App.mainBox=App.progressMsg("Croupier Server Syncronization","Reloading pools...");this.poolsTable.load(App.API.Pools.getPools())},this)};this.loaded_html=function(){var b=this;this.poolsTable=new App.Widget.PoolsTable({id:this.poolsTableId});this.on("show",function(){this.poolsTable.adjust()},this);this.msgBox=App.progressMsg("Pools","Waiting server data...");$("#addPoolBtn").click(function(){App.tabs.tab_active.panelDetails=new App.Panel.PoolDetails(App.tabs.tab_active.tab_id,-1);App.tabs.tab_active.panelDetails.show()});$("#removePoolBtn").click(function(){var c=b.poolsTable.getSelectedRows();if(c.length<=0){return}b.removePools(c)});this.constructor.superclass.loaded_html.apply(this,arguments)};this.update=function(){this.poolsTable.adjust()};this.removePools=function(b){App.mainBox=App.progressMsg("Pools","Removing pools...");App.API.Pools.removePools(b,function(){App.mainBox.progress(100);App.mainBox.done();this.close.defer(1500)},this)};App.Panel.Pools.superclass.constructor.apply(this,arguments)}});window.panel_pool_list=App.Panel.Pools;Ext.ns("App.Panel");App.Panel.PoolDetails={constructor:function PoolDetails(b,a){this.html_id="pool_details";this.define=C.panels.panel_pool_details;this.poolId=a;this.tab_id=b;this.loaded_html=function(){var c=this;$(".save_pool_btn").click(function(){c[c.poolId!=-1?"saveData":"insertData"]()});$(".close_pool_btn").click(function(){c.close()});this.duoNodes=new App.Widget.NodesDuoTable({id:"duonodes"});this.constructor.superclass.loaded_html.call(this)};this.saveData=function(){this.pool.on("updated",function(){App.mainBox.progress(100);App.mainBox.done();this.close.defer(2000,this)},this);this.pool.on("nodesupdated",function(){App.mainBox.progress(100);App.mainBox.done();this.close.defer(2000,this)},this);this.pool.nodes=this.duoNodes.leftTable.rows.toIds();if(App.API.Users.getCurrentUser().isSuperAdministrator()){App.mainBox=App.progressMsg("Pool details","Saving pool data...");this.pool.name=$("#poolName").val();this.pool.description=$("#poolDescription").text();this.pool.enabled=$("#poolEnabled").get(0).checked;this.pool.update()}else{App.mainBox=App.progressMsg("Pool details","Saving pool nodes...");this.pool.setNodes(this.pool.nodes)}};this.insertData=function(){if(!$("#poolName").formValidate()){return}App.mainBox=App.progressMsg("Add Pool","Adding a pool...");this.pool=new App.Model.Pool({id:-1});this.pool.on("inserted",function(){App.mainBox.progress(100);App.mainBox.done();this.close.defer(1000,this)},this);this.pool.name=$("#poolName").val();this.pool.description=$("#poolDescription").val();this.pool.enabled=$("#poolEnabled").get(0).checked;this.pool.nodes=this.duoNodes.leftTable.rows;this.pool.insert()};this.initialLoad=function(){if(this.poolId!=-1){this.pool=App.API.Pools.getPool(this.poolId);$("#poolName").attr("value",this.pool.name);$("#poolDescription").text(this.pool.description);$("#poolEnabled").get(0).checked=this.pool.enabled=="1";if(!App.API.Users.getCurrentUser().isSuperAdministrator()){$("#poolName,#poolDescription").attr("disabled","disabled").addClass("disabled")}App.mainBox=App.progressMsg("Pool Details","Loading pool nodes...");this.poolNodes=this.pool.getNodes();this.duoNodes.rightTable.on("loaded",function(){App.mainBox.progress(100);App.mainBox.done()},this);this.duoNodes.leftTable.on("loaded",function(){App.mainBox.progress(50);this.duoNodes.rightTable.load(App.API.Nodes.getNodes())},this);this.duoNodes.leftTable.load(this.poolNodes)}else{this.duoNodes.rightTable.on("loaded",function(){App.mainBox.progress(100);App.mainBox.done()},this);App.mainBox=App.progressMsg("Add Pool","Loading nodes list...");this.duoNodes.rightTable.load(App.API.Nodes.getNodes())}};this.update=function(){$("#pool_details").show()};this.close=function(){$("#pool_data_popup").remove();App.tabs.tab_active.update()};this.show=function(){$("#pool_data_popup").modal({backdrop:"static"});$("#pool_details").show();this.constructor.superclass.show.apply(this,arguments)};App.Panel.PoolDetails.superclass.constructor.apply(this,arguments)}};App.Panel.PoolDetails=Ext.extend(App.Panel,App.Panel.PoolDetails);window.panel_pool_details=App.Panel.PoolDetails;panel_preset_list.prototype=new panel();function panel_preset_list(a){this.html_id="preset_list";this.tab_id=a;this.define=C.panels.panel_preset_list;this.loaded_html=function(){};this.update=function(){};this.hide=function(){$("#"+this.html_id).hide()};this.show=function(){$("#"+this.html_id).show()};this.close=function(){$("#"+this.html_id).remove()};panel.prototype.constructor.call(this)}panel_statistics.prototype=new panel();function panel_statistics(a){this.html_id="statistics";this.tab_id=a;this.define=C.panels.panel_statistics;this.loaded_html=function(){$(".datepicker").datepicker()};this.update=function(){};this.hide=function(){$("#"+this.html_id).hide()};this.show=function(){$("#"+this.html_id).show()};this.close=function(){$("#"+this.html_id).remove()};panel.prototype.constructor.call(this)}Ext.ns("App.Widget");App.Panel.UserData=Ext.extend(App.Panel,{constructor:function panel_user_data(b,a){this.html_id="panel_user_data";this.tab_id=b;this.define=C.panels.panel_user_data;this.user_id=a;this.user_data;this.all_groups;this.close=function(){$("#panel_user_data .modal").remove();$("#panel_user_data").remove()};this.show=function(){$("#panel_user_data").show();$("#panel_user_data .modal").modal({backdrop:"static"}).show()};this.loadDataUser=function(){if(this.user_id!=-1){this.user_data=App.API.Users.getUser(this.user_id);$("#user_nick").val(this.user_data.alias);$("#user_name").val(this.user_data.name);$("#user_mail").val(this.user_data.email);$("#user_subname").val(this.user_data.surname);$("#userRole").val(this.user_data.role);$("#user_enable").prop("checked",this.user_data.enabled);this.userGroups=this.user_data.getGroups()}this.groupsDuo=new App.Widget.GroupsDuoTables({id:"duogroups"});this.userGroupsTable=this.groupsDuo.leftTable;this.allGroupsTable=this.groupsDuo.rightTable;this.constructor.superclass.loaded_html.call(this)};this.getAllAvaliableGroups=function(){return App.API.Groups.getGroups()};this.addMode=function(){$("#"+this.html_id+" .modal-title").text("Add User");$("#user_nick").val("");$("#user_password").val("");App.mainBox=App.progressMsg("Add User","Loading groups...");this.allGroupsTable.on("loaded",function(){App.mainBox.progress(100);App.mainBox.done();window.setTimeout(function(){$("#user_nick").val("");$("#user_password").val("");$(".form_control").val("")},500)});this.allGroupsTable.load(this.getAllAvaliableGroups())};this.initialLoad=function(){if(this.user_id==-1){return this.addMode()}$("#"+this.html_id+" .modal-title").text("User Details");App.mainBox=App.progressMsg("User details","Loading user groups...");this.allGroupsTable.on("loaded",function(){App.mainBox.progress(100);App.mainBox.done()});this.userGroupsTable.on("loaded",function(){App.mainBox.progress(50);this.allGroupsTable.load(this.getAllAvaliableGroups())},this);if(this.user_id!=-1){this.userGroupsTable.load(this.userGroups)}};this.getUserGroups=function(){return this.userGroupsTable.rows.map(function(c){return c.id})};this.loaded_html=function(){this.loadDataUser();$("#user_password").val("");var c=this;$(".users_data_close_btn").click(function(){$("#panel_user_data .modal").remove();$("#panel_user_data").remove()});$(".users_data_save_btn").click(function(){c.saveDataUser()});this.show()};this.isUserGroupsChanged=function(){if(this.user_id==-1){return true}var c=this.userGroups.map(function(e){return e.id}),d=this.getUserGroups();return !c.equal(d)};this.saveDataUser=function(){if(this.user_id==-1&&!$("#user_nick,#user_password,#user_name,#user_subname,#user_mail").formValidate()){return}var j=$("#user_name").val();var g=$("#user_nick").val();var c=$("#user_mail").val();var h=$("#user_subname").val();var f=$("#user_enable")[0].checked;var e=this;var k=$("#userRole").val();App.mainBox=App.progressMsg("Users","Saving User data");function d(l){if(l.status==croupier.ResponseStatus.SUCCESS){if($("#user_password").val()!=""&&e.user_id!==-1){App.mainBox.setMsg("Saving user password...");App.mainBox.progress(50);croupier.api.user$setPassword(e.user_data.id,md5($("#user_password").val()),function(m){if(m.status==croupier.ResponseStatus.SUCCESS){if(e.isUserGroupsChanged()){App.mainBox.setMsg("Saving user groups...");App.mainBox.progress(50);e.saveGroups(function(){App.mainBox.progress(100);App.mainBox.done();e.done()})}else{App.mainBox.progress(100);App.mainBox.done();e.done()}}else{App.errorMsg("Croupier Server Error","Message: "+m.value,3000)}},e)}else{if(e.isUserGroupsChanged()){App.mainBox.setMsg("Saving user groups...");App.mainBox.progress(50);if(e.user_id==-1){e.user_id=l.value}e.saveGroups(function(){App.mainBox.progress(100);App.mainBox.done();e.done()})}else{App.mainBox.progress(100);App.mainBox.done();e.done()}}}else{}}if(this.user_id!==-1){croupier.api.user$set(e.user_data.id,c,j,h,g,k,f,d,e)}else{croupier.api.user$add(c,md5($("#user_password").val()),j,h,g,k,f,d,e)}};this.done=function(){function c(){$("#panel_user_data .modal").remove();$("#panel_user_data").remove()}c.defer(2000)};this.close=function(){$("#section_user_data").remove();App.tabs.tab_active.show()};this.saveGroups=function(c){croupier.api.user$setGroups(this.user_id,this.getUserGroups(),function(d){if(d.status==croupier.ResponseStatus.SUCCESS){c.call(this)}else{App.errorMsg("Croupier Server Error","Message: "+d.value)}},this);return this};App.Panel.UserData.superclass.constructor.apply(this,arguments)}});window.panel_user_data=App.Panel.UserData;Ext.ns("App.Panel");App.Panel.UserList=Ext.extend(App.Panel,{constructor:function UserList(a){this.html_id="user_list";this.tab_id=a;this.define=C.panels.panel_user_list;this.the_panel_user_data;this.usersTableId="table_user";this.deleteUsers=function(){var c=this.usersTable.getSelectedRows();if(c.length==0){return}if(!window.confirm("Are you sure?")){return}var b=0;App.mainBox=App.progressMsg("Users","Deleting users...");App.API.Users.removeUsers(c,function(){App.mainBox.progress(100);App.mainBox.done()})};this.loaded_html=function(){console.log("Panel[Users]::loaded_html()");$("#"+this.html_id).show();var b=this.tab_id,c=this;this.usersTable=new App.Widget.UsersTable({id:this.usersTableId});this.constructor.superclass.loaded_html.call(this)};this.initialLoad=function(){var b=this;this.updateButtonAble();this.usersTable.showLoadingMask();this.usersTable.on("loaded",function(){console.info("[USERS] Table loaded");this.usersTable.initHeader()},this);this.usersTable.load(App.API.Users.getUsers())};this.updateButtonAble=function(){var b=this};this.addUser=function(){this.the_panel_user_data=new panel_user_data(this.tab_id,-1);this.the_panel_user_data.show()};this.userDetails=function(b){this.the_panel_user_data=new panel_user_data(this.tab_id,b);this.the_panel_user_data.show()};this.update=function(){};App.Panel.UserList.superclass.constructor.apply(this,arguments)}});var panel_user_list=App.Panel.UserList;Ext.ns("App.API");App.API.Plugins={getPlugins:function(){return this.plugins||(this.plugins=this.data.plugins.job.map(function(a){return new App.Model.Plugin(a)},this))},getPluginData:function(d,b,c){console.log("[Plugins::getPluginData():] "+d);console.dir(this.getPlugin(d));if(!App.Model.isModel(plugin=this.getPlugin(d))){throw new Error("[App.API.Plugins] Plugin Id:'"+d+"' not found.")}if(plugin.data){return plugin.data}function a(f){plugin.data=[];Ext.apply(plugin,f);var e="default";return f.configurations.map(function(h){var g=h.properties;console.log(g);if(!Ext.isString(g)){throw new TypeError("id of property of "+h.name+" is not String")}h.properties=plugin.properties.find(function(j){return j.id==g}).properties;return new App.Model.PluginData(h)})}this.api.plugin$getData(plugin.id,function(e){if(e.status==croupier.ResponseStatus.SUCCESS){plugin.data=a(e.value);b.call(c,plugin.data)}else{throw new Error("Plugins","Error loading configuration of plugin: "+plugin.id+";<br/> Status: "+e.status+"; message: "+e.value)}});return},getPlugin:function(a){return this.getPlugins().find(function(b){return b.id===a},this)}};App.API.Plugins=$.extend(croupier,App.API.Plugins);App.Model.EditableProperty={$fields:["id","name"],$className:"EditableProperty",selected:false,constructor:function EditableProperty(b){if(!b.id){throw new Error("[App.Model.EditableProperty] Malformed property: "+b)}App.Model.EditableProperty.superclass.constructor.apply(this,arguments);if(this.$className=="EditableProperty"){throw new Error("EditableProperty is an abstract class. No direct instances.")}if(this.validator){Ext.apply(this,this.validator)}if(Array.isArray(this.values)){this.$className+="_values"}if(this.restrict=="1"){this.$className+="_restrict"}if(this.ui){Ext.applyIf(this,this.ui)}if(!this.label){this.label=this.name}if(!this.description){this.nodesc="display:none"}if(!this.ui){this.noui="display:none"}this.__defineGetter__("$input",function(){return $(this.getInput())});this.__defineGetter__("$div",function(){return $("#prop_"+this.id)});var a=this;this.$input.on("change",function(){a.$input.popover("destroy")})},toRowModelArray:function(){return[this.required=="1"?App.Widget.renderTemplate("propRequired",this):App.Widget.renderTemplate("checkButton",{label:"Edit"}),this.ui?App.Widget.renderTemplate("propertyUI",{label:this.ui.label||"",description:this.ui.description||"",nodesc:!this.description?"display:none":""}):"<b>"+this.name+"</b>",App.Widget.renderTemplate("property_"+this.$className,this),this.group||"default"]},getValue:function(){return this.$input.val()},setValue:function(a){this.$input.val(a)},showError:function(b){try{this.$div.popover("destroy")}catch(a){}this.$div.attr("data-toggle","popover").attr("data-placement","right").attr("title","Invalid value").attr("data-content",b).addClass("error").popover({trigger:"manual"});this.$div.popover.defer(300,this.$div,["show"])},validate:function(){return true},initPropertyView:function(){if(Array.isArray(this.values)){this._buildValuesList();if(this.restrict=="1"){this.$widget=this.$input.chosen({search_contains:true,include_group_label_in_selected:true,inherit_select_classes:true,multiple:false,width:"174px"});this.$widget.trigger("chosen:updated")}else{console.warn(this.name)}}},_buildValuesList:function(){this.values.forEach(function(b){var a=$("<option>").attr("value",b).attr("id",b).attr("name",b).text(b);if(b==this.value){a.attr("selected","selected")}if(Array.isArray(this.values)&&!(this.restrict=="1")){$("#prop_"+this.id+"_list").append(a)}else{this.$input.append(a)}},this)},getInput:function(){return document.getElementById("prop_"+this.id+"_input")}};App.Model.EditableProperty=Ext.extend(App.Model.Abstract,App.Model.EditableProperty);App.Model.EditableProperty.isPropertyClass=function(a){return typeof a==="function"&&typeof a.superclass=="object"&&typeof a.superclass.constructor=="function"&&(a.superclass.constructor==App.Model.EditableProperty||a.superclass.constructor==App.Model.EditableProperty.Array)};Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.String={$className:"String",constructor:function String(a){App.Model.EditableProperty.String.superclass.constructor.apply(this,arguments);if(this.multiline=="1"){this.$className+="_multiline"}},validate:function(){if(this.getValue().length==0){this.showError("Please enter a value o press Edit button to disable this option (if not required)");return false}if(this.pattern){var a=new RegExp(this.pattern);if(!a.test(this.getValue())){this.showError("Value should match the pattern: "+this.pattern);return false}}if(this.regex=="1"){try{new RegExp(this.getValue())}catch(b){this.showError("Value is not a valid regular expression");return false}}return true}};App.Model.EditableProperty.String=Ext.extend(App.Model.EditableProperty,App.Model.EditableProperty.String);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.Boolean={$className:"Boolean",constructor:function(){App.Model.EditableProperty.Boolean.superclass.constructor.apply(this,arguments)}};App.Model.EditableProperty.Boolean=Ext.extend(App.Model.EditableProperty,App.Model.EditableProperty.Boolean);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.Integer={$className:"Number",constructor:function Integer(){App.Model.EditableProperty.Integer.superclass.constructor.apply(this,arguments)},validate:function(){var a=true;if(this.min&&this.$input.val()<this.min){a=false;this.showError("Value must be equal o greeter than "+this.min)}if(this.max&&this.$input.val()>this.max){a=false;this.showError("Value must be equal o less than "+this.max)}return a}};App.Model.EditableProperty.Integer=Ext.extend(App.Model.EditableProperty,App.Model.EditableProperty.Integer);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.Long={$className:"Number",constructor:function Long(){App.Model.EditableProperty.Long.superclass.constructor.apply(this,arguments)},validate:function(){var a=true;if(this.min&&this.$input.val()<this.min){a=false;this.showError("Value must be equal o greeter than "+this.min)}if(this.max&&this.$input.val()>this.max){a=false;this.showError("Value must be equal o less than "+this.max)}return a}};App.Model.EditableProperty.Long=Ext.extend(App.Model.EditableProperty,App.Model.EditableProperty.Long);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.Double={$className:"Number",constructor:function(){App.Model.EditableProperty.Double.superclass.constructor.apply(this,arguments)},validate:function(){var a=true;if(this.min&&this.$input.val()<this.min){a=false;this.showError("Value must be equal o greeter than "+this.min)}if(this.max&&this.$input.val()>this.max){a=false;this.showError("Value must be equal o less than "+this.max)}return a}};App.Model.EditableProperty.Double=Ext.extend(App.Model.EditableProperty,App.Model.EditableProperty.Double);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.Group={$className:"Group",constructor:function(a){App.Model.EditableProperty.Group.superclass.constructor.apply(this,arguments)},initPropertyView:function(){this.propData=new App.Model.PluginData({id:"prop_"+this.id+"_data",name:"group_"+this.id,properties:this.properties});console.dir(this.propData);this.propTable=new App.Widget.PropertiesTable({id:"prop_"+this.id,dom:"t",cssClass:"widget datatable propertiesTable nested",nested:true});this.propTable.on("rowadded",function(b,a){a.originalName=this.originalName+"."+a.originalName},this);this.propTable.load(this.propData.getProperties())},toRowModelArray:function(){return[App.Widget.renderTemplate("checkButton",{_class:"editGroup",label:"<h4 class='modal-title'>Edit "+this.name+"</h4>"}),App.Widget.renderTemplate("property_Group",this),"",this.name]},getValue:function(){return this.propTable.toTypedProperties()},validate:function(){return this.propTable.isValid()}};App.Model.EditableProperty.Group=Ext.extend(App.Model.EditableProperty,App.Model.EditableProperty.Group);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.Path={$className:"Path",constructor:function Path(){App.Model.EditableProperty.Path.superclass.constructor.apply(this,arguments)},validate:function(){if(this.getValue().length==0){this.showError("Please enter a value o press Edit button to disable this option (if not required)");return false}return true}};App.Model.EditableProperty.Path=Ext.extend(App.Model.EditableProperty,App.Model.EditableProperty.Path);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.URI={$className:"String",constructor:function URI(){App.Model.EditableProperty.URI.superclass.constructor.apply(this,arguments)},validate:function(){try{new URL(this.getValue());return true}catch(a){this.showError("This option must be a valid URI");return false}}};App.Model.EditableProperty.URI=Ext.extend(App.Model.EditableProperty,App.Model.EditableProperty.URI);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.ExecOutputHandler={$className:"EOH",$fields:["progress","path","encoding","progressExclude","executed","executedExclude","warning","warningExclude","error","errorExclude"],$inputs:{},constructor:function ExecOutputHandler(){App.Model.EditableProperty.ExecOutputHandler.superclass.constructor.apply(this,arguments)},getValue:function(){var a={};this.$fields.forEach(function(b){if(this.getInput(b).val().length>0){a[b]=this.getInput(b).val()}},this);return a},getInput:function(a){return $("#prop_"+this.id+"_"+a+"_input")},setValue:function(a){this.$fields.forEach(function(b){if(a[b]){this[b]=a[b];this.getInput(b).val(a[b])}},this)},initPropertyView:function(){if($.isPlainObject(this.value)){this.setValue(this.value)}},validate:function(){if(res=!this.$fields.some(function(a){return this.getInput(a).val().length>0&&!RegExp.isRegExp(this.getInput(a).val())},this)){this.showError("Any set value should be a regular expression")}return res}};App.Model.EditableProperty.ExecOutputHandler=Ext.extend(App.Model.EditableProperty,App.Model.EditableProperty.ExecOutputHandler);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.Array={$className:"Array",inputType:"text",constructor:function Array(a){App.Model.EditableProperty.Array.superclass.constructor.apply(this,arguments)},setValue:function(a){this._loadValuesList(a,true)},initPropertyView:function(){var b=this;var a={placeholder_text_multiple:this.restrict=="1"?"Select value to add from the dropdown list":"Type a value, than press ENTER to add it.",no_results_text:"<font color='red'>Incorrect value</font>",max_selected_options:this.maxSize||Infinity,include_group_label_in_selected:true,inherit_select_classes:true,multiple:true,width:"250px"};this.$widget=this.restrict!="1"?this.$input.editableChosen(a):this.$input.chosen(a);var d=b.$input.attr("id")+"_chosen";if(Array.isArray(this.value)){this._loadValuesList(this.value,true)}if(Array.isArray(this.values)){this._loadValuesList(this.values,false);function c(){$("#"+d+" li.result-selected").removeClass("result-selected").addClass("active-result").each(function(e){$(e).attr("data-option-array-index",Math.round(Math.random()*10000000))})}this.$widget.on("chosen:showing_dropdown",c);$("#"+d+" input").on("keydown",function(){c.defer(50);c.defer(100);c.defer(300);c.defer(500);c.defer(1000);c.defer(2000)})}if(this.restrict!=="1"){this.$widget.on("chosen:no_results",function(){b.$widget.trigger("chosen:close")})}$("#"+d+" input").keydown(function(f){if(b.restrict=="1"){return}if(f.keyCode==13&&$(this).val().length>0){if(b.maxSize&&b.$input.val()!=null&&b.$input.val().length>=b.maxSize){b.showError("This value list can contain maximum "+b.maxSize+" elements");return}b._loadValuesList([$(this).val()],true);this.value="";b.$widget.trigger("chosen:updated");f.preventDefault();f.stopImmediatePropagation();return false}else{if(f.keyCode==8&&$(this).val().length==0){if(b.$input.options.length>0){b.$input.remove(b.$input.options.length-1);b.$widget.trigger("chosen:updated")}}}});$("#"+d+" input").on("focus",function(){b.$div.popover("destroy")});console.dir(this)},_loadValuesList:function(b,a){b.forEach(function(c){var d=$("<option>").attr("value",c).attr("name",c).attr("id",c);if(a){d.attr("selected","selected")}d.text(c).appendTo(this.$input)},this);this.$widget.trigger("chosen:updated")},validate:function(){if((this.minSize&&Array.isArray(this.$input.val())&&this.$input.val().length<this.minSize)||(this.minSize&&this.$input.val()==null)){this.showError("This value list must contain minimum "+this.minSize+" elements");return false}return true}};App.Model.EditableProperty.Array=Ext.extend(App.Model.EditableProperty,App.Model.EditableProperty.Array);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.ArrayString={constructor:function ArrayString(){App.Model.EditableProperty.ArrayString.superclass.constructor.apply(this,arguments)}};App.Model.EditableProperty.ArrayString=Ext.extend(App.Model.EditableProperty.Array,App.Model.EditableProperty.ArrayString);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.ArrayDouble={constructor:function ArrayDouble(){App.Model.EditableProperty.ArrayDouble.superclass.constructor.apply(this,arguments)}};App.Model.EditableProperty.ArrayDouble=Ext.extend(App.Model.EditableProperty.Array,App.Model.EditableProperty.ArrayDouble);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.ArrayInteger={$className:"String",constructor:function(){App.Model.EditableProperty.ArrayInteger.superclass.constructor.apply(this,arguments)}};App.Model.EditableProperty.ArrayInteger=Ext.extend(App.Model.EditableProperty.Array,App.Model.EditableProperty.ArrayInteger);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.ArrayLong={$className:"String",constructor:function(){App.Model.EditableProperty.ArrayLong.superclass.constructor.apply(this,arguments)}};App.Model.EditableProperty.ArrayLong=Ext.extend(App.Model.EditableProperty.Array,App.Model.EditableProperty.ArrayLong);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.ArrayPath={valType:"Path",constructor:function ArrayPath(){App.Model.EditableProperty.ArrayPath.superclass.constructor.apply(this,arguments)}};App.Model.EditableProperty.ArrayPath=Ext.extend(App.Model.EditableProperty.Array,App.Model.EditableProperty.ArrayPath);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.ArrayBoolean={$className:"String",constructor:function ArrayBoolean(){App.Model.EditableProperty.ArrayBoolean.superclass.constructor.apply(this,arguments)}};App.Model.EditableProperty.ArrayBoolean=Ext.extend(App.Model.EditableProperty.Array,App.Model.EditableProperty.ArrayBoolean);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.ArrayURI={valType:"URI",constructor:function ArrayURI(){App.Model.EditableProperty.ArrayURI.superclass.constructor.apply(this,arguments)}};App.Model.EditableProperty.ArrayURI=Ext.extend(App.Model.EditableProperty.Array,App.Model.EditableProperty.ArrayURI);Ext.ns("App.Model.EditableProperty");App.Model.EditableProperty.ArrayExecOutputHandler={$className:"String",constructor:function(){App.Model.EditableProperty.ArrayExecOutputHandler.superclass.constructor.apply(this,arguments)}};App.Model.EditableProperty.ArrayExecOutputHandler=Ext.extend(App.Model.EditableProperty.Array,App.Model.EditableProperty.ArrayExecOutputHandler);Ext.ns("App.Widget");App.Widget.PluginConfigurator={cssClass:"pluginEditor",isShown:false,constructor:function(a){Ext.applyIf(a,{template:"pluginConfig",pluginName:"",pluginConfig:"",propTableId:"propTable"});this.addEvents("shown","hidden","close");App.Widget.PluginConfigurator.superclass.constructor.call(this,a);this.propTable=new App.Widget.PropertiesTable({id:this.propTableId,selectable:false});if(this.pluginProperties){this.loadProperties(this.pluginProperties)}var b=this;$("#btnApplyProp").click(function(){b.apply()})},show:function(){$("#"+this.id).modal({backdrop:"static"}).fadeIn();this.isShown=true;this.fireEvent("shown",this.id)},hide:function(){$("#"+this.id).fadeOut();this.isShown=false;this.fireEvent("hidden",this.id)},close:function(){$("#"+this.id).modal("hide").fadeOut();$("#"+this.id).remove();this.fireEvent("close",this.id);delete this},apply:function(){if(!this.propTable.isValid()){App.errorMsg("Plugin Properties","Some properties has incorrect values, please fix them.");return}this.fireEvent("apply",this.propTable.toTypedProperties());this.hide()},loadProperties:function(a){console.info("Loading properties");console.dir(a);this.propTable.load(a)}};App.Widget.PluginConfigurator=Ext.extend(App.Widget,App.Widget.PluginConfigurator);Ext.ns("App.Widget");App.Widget.PropertiesTable=Ext.extend(App.Widget.Table,{cssClass:"widget datatable propertiesTable",constructor:function(a){Ext.applyIf(a,{rowClass:App.Model.EditableProperty,dom:"lftpr",columnDefs:[{orderable:false,className:"prop-select",targets:0},{targets:1,className:"prop-name",orderable:true},{targets:2,className:"prop-value",orderable:false},{visible:false,targets:3}],select:{style:"multi",selector:"td:first-child > div"},orderMulti:true,order:[[1,"desc"],[0,"asc"]],scrollY:900,scrollCollapse:true,paging:false});App.Widget.PropertiesTable.superclass.constructor.call(this,a);var b=this;this.on("rowselected",function(c){console.info("selected:"+c.name);c.selected=true;if(c.$className=="Group"){c.propTable.adjust()}},this);this.on("rowunselected",function(c){console.info("unselected:"+c.name);if(c.required==1){App.errorMsg("Plugin properties","Property "+c.name+" is required.");return false}else{c.selected=false;return true}},this);this.on("rowadded",function(d,c){if(c.required=="1"){this.$dt.rows(d).select();c.selected=true}if(c.$className=="Group"){$(this.$dt.rows(d).nodes()).children(".prop-name").attr("colspan","2")}},this);$("#"+this.id+"_checkall").parents("div").first().click(function(){b.$dt.rows("*")[$(this).children("label").hasClass("active")?"select":"deselect"]()});var b=this;this.$dt.on("draw.dt",function(){b.initHeader();console.info("[propTable]: redraw")})},initHeader:function(){$(".ico-info").mouseenter(function(){$(this).popover("show")}).mouseleave(function(){$(this).popover("hide")})},addRow:function(){if(property=this.constructor.superclass.addRow.apply(this,arguments)){property.initPropertyView()}},loadFromTypedProperties:function(a){this.rows.forEach(function(b){if(value=a[b.originalName]){this.$dt.rows(this.getRowIndex(b)).select();b.setValue(value)}},this)},toTypedProperties:function(){var a={};this.rows.forEach(function(b){if(!b.selected){return}console.info(b);if(b.$className=="Group"){Ext.apply(a,b.getValue())}else{a[b.originalName]=b.getValue()}});return a},isValid:function(){return !this.rows.filter(function(a){return a.selected}).map(function(b){res=b.validate();if(!res){var a=this.getRowIndex(b);$(this.$dt.row(a).node()).addClass("with-error");(function(){$(this.$dt.row(a).node()).removeClass("with-error")}).defer(10000,this)}console.info("["+b.name+" validate()]: "+res);return !res},this).some(function(a){return a})}});App.Model.PluginData={$fields:["id","name"],propClasses:{s:App.Model.EditableProperty.String,i:App.Model.EditableProperty.Integer,l:App.Model.EditableProperty.Long,d:App.Model.EditableProperty.Double,b:App.Model.EditableProperty.Boolean,eoh:App.Model.EditableProperty.ExecOutputHandler,path:App.Model.EditableProperty.Path,uri:App.Model.EditableProperty.URI,"s[]":App.Model.EditableProperty.ArrayString,"i[]":App.Model.EditableProperty.ArrayInteger,"l[]":App.Model.EditableProperty.ArrayLong,"d[]":App.Model.EditableProperty.ArrayDouble,"b[]":App.Model.EditableProperty.ArrayBoolean,"eoh[]":App.Model.EditableProperty.ArrayExecOutputHandler,"path[]":App.Model.EditableProperty.ArrayPath,"uri[]":App.Model.EditableProperty.ArrayURI,group:App.Model.EditableProperty.Group},constructor:function PluginData(c){var b=this;function a(d,e){$.each(d,function(f,g){if(f.indexOf("-")===-1){Ext.apply(g,g.properties);a(g.properties,e)}else{var h=b.getPropertyInfo(f);h.data=g;Ext.applyIf(h,g);b.properties.push(h)}})}if(c.name){c.id=c.name}else{throw this}App.Model.PluginData.superclass.constructor.apply(this,arguments);var b=this;this.props=this.properties;this.properties=[];$.each(this.props,function(d,e){var f=b.getPropertyInfo(d);f.data=e;Ext.applyIf(f,e);b.properties.push(f)})},getProperties:function(){return this.properties.filter(function(a){return App.Model.EditableProperty.isPropertyClass(a.$class)}).map(function(a){return new a.$class(a)})},getPropertyInfo:function(c){var a=c.split("-")[0],b=c.split("-")[1];return{id:a,group:b?"default":a,name:a,originalName:c,$class:this.propClasses[b||"group"]}}};App.Model.PluginData=Ext.extend(App.Model.Abstract,App.Model.PluginData);